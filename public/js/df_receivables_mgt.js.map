{"version":3,"sources":["df_receivables_mgt.js"],"names":["$","btnAdd","btnUpdate","btnRemove","btnExport","dataBtnOk","dataBody","iDrayage","iForklift","monthChoiceGrp","monthChoice","ldata","local_data","selectedIdx","action","selectedMonth","setHtmlElementDisabled","ForceNumericOnly","opts","getDateTimePickerOptions","showIt","enabled","title","act","row","initElements","val","getStrValue","drayage","forklift","month","modal","backdrop","keyboard","prop","resetTable","empty","length","each","idx","append","format","tr_click","find","e","index","minViewMode","datetimepicker","on","date","startOf","get","data","result","jQuery","parseJSON","ok","bootbox","alert","html","filename","date2Str","Date","tableToExcel","parseFloat","ajaxRequestHandle","i","remove","push"],"mappings":"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","file":"df_receivables_mgt.js","sourcesContent":["/**\r\n * Created by ezefjia on 2015/7/6.\r\n */\r\n\r\n$(function () {\r\n  \"use strict\";\r\n\r\n  var btnAdd = $('#data-add');\r\n  var btnUpdate = $('#data-modify');\r\n  var btnRemove = $('#data-delete');\r\n  var btnExport = $('#data-export');\r\n\r\n  var dataBtnOk = $('#data-btn-ok');\r\n  var dataBody = $('#data-tbody');\r\n  var iDrayage = $('#i-drayage');\r\n  var iForklift = $('#i-forklift');\r\n  var monthChoiceGrp = $('#month-choice-grp');\r\n  var monthChoice = $('#month-choice');\r\n\r\n  var ldata = local_data;\r\n  var selectedIdx = -1;\r\n  var action = 'unknown';\r\n  var selectedMonth = '';\r\n\r\n  setHtmlElementDisabled(btnUpdate, true);\r\n  setHtmlElementDisabled(btnRemove, true);\r\n  iDrayage.ForceNumericOnly();\r\n  iForklift.ForceNumericOnly();\r\n\r\n  var opts = getDateTimePickerOptions();\r\n  opts.minViewMode = 'months';\r\n  opts.format = 'YYYY-MM';\r\n  monthChoiceGrp.datetimepicker(opts).on('dp.change', function(e) {\r\n    selectedMonth = e.date.startOf('month').format(\"YYYY-MM\");\r\n    setHtmlElementDisabled(dataBtnOk, false);\r\n    getOneData('month');\r\n  });\r\n\r\n  resetTable();\r\n\r\n  btnAdd.on('click', function() {\r\n    initElements(false);\r\n\r\n    selectedMonth = '';\r\n    monthChoice.val('');\r\n    setHtmlElementDisabled(monthChoice, false);\r\n    setHtmlElementDisabled(monthChoiceGrp, false);\r\n\r\n    action = 'add';\r\n    $('#i-title').val('短驳叉车应收款输入');\r\n    $('#data-dialog').modal({ backdrop: 'static', keyboard: false}).modal('show');\r\n  });\r\n\r\n  btnUpdate.on('click', function() {\r\n    showIt(false, '短驳叉车应收款更新', 'update');\r\n  });\r\n\r\n  btnRemove.on('click', function() {\r\n    showIt(true, '短驳叉车应收款删除', 'delete');\r\n  });\r\n\r\n  btnExport.on('click', function() {\r\n    var html = $('#data-table').html();\r\n    var filename = \"download\";\r\n    filename += date2Str(new Date()) + \".xls\";\r\n    tableToExcel(html, 'data', filename);\r\n  });\r\n\r\n  dataBtnOk.on('click', function() {\r\n    if (selectedMonth) {\r\n      var data = {\r\n        month: selectedMonth,\r\n        drayage: iDrayage.val() ? parseFloat(iDrayage.val()) : 0,\r\n        forklift: iForklift.val() ? parseFloat(iForklift.val()) : 0\r\n      };\r\n\r\n      if (action === 'delete') {\r\n        ajaxRequestHandle('/delete_df_data', 'POST', data, '数据删除', function() {\r\n          $('#data-dialog').modal('hide');\r\n          for (var i = 0; i < ldata.length; ++i) {\r\n            if (ldata[i].month === selectedMonth) {\r\n              ldata.remove(i);\r\n              break;\r\n            }\r\n          }\r\n\r\n          resetTable();\r\n        });\r\n      } else {\r\n        ajaxRequestHandle('/one_df_receivables', 'POST', data, '数据保存', function () {\r\n          $('#data-dialog').modal('hide');\r\n          if (action === 'add') {\r\n            ldata.push(data);\r\n          } else if (action === 'update') {\r\n            for (var i = 0; i < ldata.length; ++i) {\r\n              if (ldata[i].month === selectedMonth) {\r\n                ldata[i].drayage = data.drayage;\r\n                ldata[i].forklift = data.forklift;\r\n              }\r\n            }\r\n          }\r\n\r\n          resetTable();\r\n        });\r\n      }\r\n    } else {\r\n      bootbox.alert('请选择月份');\r\n    }\r\n  });\r\n\r\n\r\n  function tableBodyEventHandler() {\r\n    tr_click(dataBody.find('tr'), function (e, index) {\r\n      selectedIdx = index;\r\n      if (index >= 0) {\r\n        setHtmlElementDisabled(btnUpdate, false);\r\n        setHtmlElementDisabled(btnRemove, false);\r\n      } else {\r\n        setHtmlElementDisabled(btnUpdate, true);\r\n        setHtmlElementDisabled(btnRemove, true);\r\n      }\r\n    });\r\n  }\r\n\r\n  function showIt(enabled, title, act) {\r\n    if (selectedIdx >= 0) {\r\n      var row = ldata[selectedIdx];\r\n      initElements(enabled);\r\n      iDrayage.val(getStrValue(row.drayage));\r\n      iForklift.val(getStrValue(row.forklift));\r\n\r\n      selectedMonth = row.month;\r\n      monthChoice.val(row.month);\r\n      setHtmlElementDisabled(monthChoice, true);\r\n      setHtmlElementDisabled(monthChoiceGrp, true);\r\n\r\n      action = act;\r\n      setHtmlElementDisabled(dataBtnOk, false);\r\n      $('#i-title').val(title);\r\n      $('#data-dialog').modal({ backdrop: 'static', keyboard: false}).modal('show');\r\n    }\r\n  }\r\n\r\n  function initElements(enabled) {\r\n    iDrayage.val('');\r\n    iForklift.val('');\r\n    iDrayage.prop('disabled', enabled);\r\n    iForklift.prop('disabled', enabled);\r\n  }\r\n\r\n  function resetTable() {\r\n    dataBody.empty();\r\n    if (ldata.length > 0) {\r\n      var str = '<tr><td>{0}</td><td>{1}</td><td>{2}</td></tr>';\r\n      $.each(ldata, function (idx, row) {\r\n        dataBody.append(str.format(row.month, row.drayage, row.forklift));\r\n      });\r\n\r\n      tableBodyEventHandler();\r\n    }\r\n  }\r\n\r\n  function getOneData() {\r\n    if (selectedMonth) {\r\n      $.get('/get_one_df_data', {month: selectedMonth}, function (data) {\r\n        var result = jQuery.parseJSON(data);\r\n        if (result.ok) {\r\n          bootbox.alert('不能增加, 记录已存在！月份:' + selectedMonth);\r\n          selectedMonth = '';\r\n          monthChoice.val('');\r\n        }\r\n      });\r\n    } else {\r\n      initElements(false);\r\n    }\r\n  }\r\n});"]}