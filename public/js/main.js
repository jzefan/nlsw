var left_side_width=180;function fix_sidebar(){$("body").hasClass("fixed")&&$(".sidebar").slimscroll({height:$(window).height()-$(".header").height()+"px",color:"rgba(0,0,0,0.2)"})}$(function(){"use strict";function e(){var e=$(window).height()-$("body > .header").height()-$("body > .footer").height();$(".wrapper").css("min-height",e+"px");var t=$(".wrapper").height();e<t?$(".left-side, html, body").css("min-height",t+"px"):$(".left-side, html, body").css("min-height",e+"px")}$("[data-toggle='offcanvas']").click(function(e){e.preventDefault(),$(window).width()<=992?($(".row-offcanvas").toggleClass("active"),$(".left-side").removeClass("collapse-left"),$(".right-side").removeClass("strech"),$(".row-offcanvas").toggleClass("relative")):($(".left-side").toggleClass("collapse-left"),$(".right-side").toggleClass("strech"))}),$(".btn").bind("touchstart",function(){$(this).addClass("hover")}).bind("touchend",function(){$(this).removeClass("hover")}),$("[data-toggle='tooltip']").tooltip(),$("[data-widget='collapse']").click(function(){var e=$(this).parents(".box").first(),t=e.find(".box-body, .box-footer");e.hasClass("collapsed-box")?(e.removeClass("collapsed-box"),t.slideDown()):(e.addClass("collapsed-box"),t.slideUp())}),$(".navbar .menu").slimscroll({height:"200px",alwaysVisible:!1,size:"3px"}).css("width","100%"),$('.btn-group[data-toggle="btn-toggle"]').each(function(){var t=$(this);$(this).find(".btn").click(function(e){t.find(".btn.active").removeClass("active"),$(this).addClass("active"),e.preventDefault()})}),$("[data-widget='remove']").click(function(){$(this).parents(".box").first().slideUp()}),$(".sidebar .treeview").tree(),e(),$(".wrapper").resize(function(){e(),fix_sidebar()}),fix_sidebar(),$("input[type='checkbox'], input[type='radio']").iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"}),$("#openExeclfile").change(function(){var e=$(this).val().replace(/C:\\fakepath\\/gi,"");$("#fileName").text(e),$("#filepath").text($(this).val())})}),function(t){"use strict";t.fn.boxRefresh=function(e){var i=t.extend({trigger:".refresh-btn",source:"",onLoadStart:function(e){},onLoadDone:function(e){}},e),l=t('<div class="overlay"></div><div class="loading-img"></div>');return this.each(function(){if(""!==i.source){var n=t(this);n.find(i.trigger).first().click(function(e){var t;e.preventDefault(),(t=n).append(l),i.onLoadStart.call(t),n.find(".box-body").load(i.source,function(){var e;(e=n).find(l).remove(),i.onLoadDone.call(e)})})}else console&&console.log("Please specify a source first - boxRefresh()")})}}(jQuery),function(l){"use strict";l.fn.tree=function(){return this.each(function(){var t=l(this).children("a").first(),n=l(this).children(".treeview-menu").first(),i=l(this).hasClass("active");i&&(n.show(),t.children(".fa-angle-left").first().removeClass("fa-angle-left").addClass("fa-angle-down")),t.click(function(e){e.preventDefault(),i?(n.slideUp(),i=!1,t.children(".fa-angle-down").first().removeClass("fa-angle-down").addClass("fa-angle-left"),t.parent("li").removeClass("active")):(n.slideDown(),i=!0,t.children(".fa-angle-left").first().removeClass("fa-angle-left").addClass("fa-angle-down"),t.parent("li").addClass("active"))}),n.find("li > a").each(function(){var e=parseInt(l(this).css("margin-left"))+10;l(this).css({"margin-left":e+"px"})})})}}(jQuery),function(t){"use strict";jQuery.fn.center=function(e){return e=e?this.parent():window,this.css({position:"absolute",top:(t(e).height()-this.outerHeight())/2+t(e).scrollTop()+"px",left:(t(e).width()-this.outerWidth())/2+t(e).scrollLeft()+"px"}),this}}(jQuery);var nlApp,datatable_tabletools={sSwfPath:"js/plugins/datatables/TableTools/swf/copy_csv_xls_pdf.swf",aButtons:[{sExtends:"copy",sButtonText:"拷贝"},{sExtends:"csv",sButtonText:"保存Excel/csv"}]},lang={sProcessing:"处理中...",sLengthMenu:"显示 _MENU_ 项结果",sZeroRecords:"没有匹配结果",sInfo:"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",sInfoEmpty:"显示第 0 至 0 项结果，共 0 项",sInfoFiltered:"(由 _MAX_ 项结果过滤)",sInfoPostFix:"",sSearch:"搜索:",sUrl:"",sEmptyTable:"表中数据为空",sLoadingRecords:"载入中...",sInfoThousands:",",oPaginate:{sFirst:"首页",sPrevious:"上页",sNext:"下页",sLast:"末页"},oAria:{sSortAscending:": 以升序排列此列",sSortDescending:": 以降序排列此列"}};function getDataTableParams(e,t){var n={aaSorting:[[0,"asc"]],iDisplayLength:10,aLengthMenu:[[10,20,50,100,-1],[10,20,50,100,"All"]],sPaginationType:"full_numbers",sScrollX:"100%",sScrollXInner:t,language:lang,sDom:'T<"clear">lfrtip'};return e&&(n.oTableTools=datatable_tabletools),n}function parseFloatHTML(e){return parseFloat(e.replace(/[^\d\.\-]+/g,""))||0}function addZero(e){return e<10&&(e="0"+e),e}function date2Str(e,t){if(e){if("[object Date]"===Object.prototype.toString.call(e)||"string"==typeof e){var n=moment(e);return t?n.format("YYYY-MM-DD"):n.format("YYYY-MM-DD HH:mm")}if(moment.isMoment(e))return t?e.format("YYYY-MM-DD"):e.format("YYYY-MM-DD HH:mm");n=moment(e);return t?n.format("YYYY-MM-DD"):n.format("YYYY-MM-DD HH:mm")}return""}function getDateTimePickerOptions(){return{autoclose:!0,useCurrent:!1,todayBtn:!0,language:"zh-cn",collapse:!1,pickTime:!1}}function leftPad(e,t){for(var n=""+e;n.length<t;)n="0"+n;return n}function getOrder(e,t){return e+"-"+leftPad(t,3)}function sort_pinyin(e){return e.sort(function(e,t){return e.localeCompare(t)})}function isEmpty(e){return void 0===e||!e||0===e.length}function isExist(e){return void 0!==e&&null!=e}function elementEventRegister(e,t,n){e.length&&e.on(t,n)}function select2Setup(e,t,n){e.select2({minimumInputLength:t.inputLength,placeholder:t.placeholder,initSelection:function(e,t){},ajax:{url:t.url,dataType:"json",quietMillis:100,data:function(e,t){return{q:e,limit:-1}},results:function(e,t){return n&&n(e),{results:e.targetData}}},formatResult:function(e){return"<div class='select2-user-result'>"+e.text+"</div>"},formatSelection:function(e){return e.text}})}function getAJAXRequest(e,t,n){return $.ajax({url:e,type:t,data:JSON.stringify(n),dataType:"json",contentType:"application/json"})}function ajaxRequestHandle(e,t,n,i,l){var a=getAJAXRequest(e,t,n);a.done(function(e){e.ok?"no_message"===i?isExist(l)&&l():bootbox.alert(i+"成功",function(){isExist(l)&&l()}):bootbox.alert(i+"失败:"+e.response)}),a.fail(function(e,t){bootbox.alert(i+"失败: "+t)})}function unselected(e){e.length&&e.prop("selectedIndex",-1)}function getRowChildren(e,t){return e.find("tr:eq("+t+")")}function getTableCellChildren(e,t){return e.find("td:eq("+t+")")}function tr_click(n,i){0<n.length&&(n.off("click"),n.on("click",function(e){var t=$(this);n.removeClass("invoice-highlighted"),t.addClass("invoice-highlighted"),i(e,t.index())}))}function setHtmlElementDisabled(e,t){if(0<e.length){var n=e[0].nodeName.toLowerCase();"input"===n||"select"===n||"textarea"===n?e.prop("disabled",t):t?e.addClass("disabled"):e.removeClass("disabled")}}function showHtmlElement(e,t){0<e.length&&(t?e.show():e.hide())}function setElementValue(e,t){if(0<e.length){var n=e[0].nodeName.toLowerCase();"input"===n||"select"===n||"textarea"===n?e.val(t):e.text(t)}}function getElementValue(e){if(0<e.length){var t=e[0].nodeName.toLowerCase();return"input"===t||"select"===t||"textarea"===t?e.val():e.text()}return""}function isJqueryElementEmpty(e){return 0===e.length}function isNumeric(e){return!jQuery.isArray(e)&&0<=e-parseFloat(e)}function numberIntValider(e,t,n){var i=e.val().replace(/[^0-9]/g,"");return i=parseInt(i),isNaN(i)||i<t?(i=t,e.val(t)):(n<i&&(i=n),e.val(i)),i}function numberFloatValider(e,t,n,i){var l=e.val(),a=l;return isEmpty(l)?(e.val(""),n):(isNumeric(l)?(l<n&&(l=n),i&&i<l&&(l=i)):l=t,a!=l&&e.val(l),Number(l))}function getStrValue(e){return isFinite(e)?"number"==typeof e?Math.floor(e)===e?e.toString():toFixedStr(e,3).replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1"):e:""}function sameBill(e,t){return e.bill_no===t.bill_no&&getOrder(e.order_no,e.order_item_no)===getOrder(t.order_no,t.order_item_no)}function sortByKey(e,l,a){return e.sort(function(e,t){var n=e[l],i=t[l];return"ASC"===a?n<i?-1:i<n?1:0:n<i?1:i<n?-1:0})}function toFixedStr(e,t){return Math.abs(e)<1e-5?"0":(+(Math.round(+(e+"e"+t))+"e"+-t)).toFixed(t)}function toFixedNumber(e,t){return Math.abs(e)<1e-5?0:+(+(Math.round(+(e+"e"+t))+"e"+-t)).toFixed(t)}function initSelect(t,e,n,i){t.empty(),e.length?(n&&t.append("<option>无-取消选择</option>"),e.forEach(function(e){t.append('<option value="'+e+'">'+e+"</option>")}),i?e.indexOf(i)<0?t.append('<option value="'+i+'" selected>'+i+"</option>"):t.val(i):unselected(t)):i&&(t.append("<option>无-取消选择</option>"),t.append('<option value="'+i+'" selected>'+i+"</option>"))}function getSelectValue(e){var t=e.val();return"无-取消选择"===t&&(unselected(e),t=""),t}$(function(){$(".input-group.date").find("input").each(function(){this.value=""}),$("input:radio").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"}),$("input:checkbox").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"});var e=$("#show_search_data");0<e.length&&e.dataTable(getDataTableParams(!0,"150%")),$('[data-toggle="tooltip"]').tooltip({trigger:"hover",html:!0}),$('[data-toggle="popover"]').popover({trigger:"hover",html:!0});var i=$("#blog-content");if(0<i.length){i.html(local_html_data);var l=CKEDITOR.replace("editor1",{toolbar:[{name:"clipboard",groups:["clipboard","undo"],items:["Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo"]},{name:"basicstyles",groups:["basicstyles","cleanup"],items:["Bold","Italic","Underline","Strike","Subscript","Superscript","-","RemoveFormat"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"],items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","BidiLtr","BidiRtl","Language"]},{name:"links",items:["Link","Unlink"]},{name:"insert",items:["Image","Table","HorizontalRule","Smiley","SpecialChar","PageBreak"]},{name:"styles",items:["Styles","Format","Font","FontSize"]},{name:"colors",items:["TextColor","BGColor"]},{name:"tools",items:["Maximize","ShowBlocks"]}]}),a=$("#post-submit");function o(t){bootbox.confirm("您确定要删除? 删除后不能恢复!",function(e){e&&(t.remove(),$(".post-remove").hide(),ajaxRequestHandle("/post_update","POST",{html:i.html()},"删除"),$(".post-remove").show())})}$("#post-edit").on("click",function(){$(".post-remove").hide(),showHtmlElement($("#editor-box"),!0),setHtmlElementDisabled(a,!1)}),a.on("click",function(){var e=$("#post-title").val();if(0!==e.length){var t=l.document.getBody().getHtml();if(0!==t.length){var n='<div class="blog-post"><button class="btn btn-danger btn-sm pull-right post-remove" style="display:none;"><i class="fa fa-times"></i></button><h2 class="blog-post-title">'+e+'</h2><p class="blog-post-meta">作者:<a href="">'+local_user.userid+"</a> 日期:"+(new Date).yyyymmdd_cn()+"</p>"+t+"</div>";ajaxRequestHandle("/post_submit","POST",{html:n},"发布",function(){i.prepend(n),$(".post-remove").hide(),showHtmlElement($("#editor-box"),!1),$(".post-remove").on("click",function(){o($(this).parent())}),setHtmlElementDisabled(a,!0)})}else bootbox.alert("没有内容可以发布,请输入!")}else bootbox.alert("请输入发布的标题!")}),$("#post-delete").on("click",function(){$(".post-remove").toggle()}),$(".post-remove").on("click",function(){o($(this).parent())})}}),Date.prototype.yyyymmdd_cn=function(e){var t=this.getFullYear().toString(),n=(this.getMonth()+1).toString(),i=this.getDate().toString();if(e)return t+"-"+(2===n.length?n:"0"+n[0])+"-"+(2===i.length?i:"0"+i[0]);var l=addZero(this.getMinutes()),a=addZero(this.getHours());return t+"-"+(2===n.length?n:"0"+n[0])+"-"+(2===i.length?i:"0"+i[0])+" "+a+":"+l},Array.prototype.remove=function(e,t){var n=this.slice((t||e)+1||this.length);return this.length=e<0?this.length+e:e,this.push.apply(this,n)},String.prototype.format||(String.prototype.format=function(){var n=arguments;return this.replace(/{(\d+)}/g,function(e,t){return void 0!==n[t]?n[t]:e})}),jQuery.fn.ForceNumericOnly=function(){return this.each(function(){$(this).keydown(function(e){var t=e.charCode||e.keyCode||0;return 8==t||9==t||13==t||46==t||110==t||190==t||35<=t&&t<=40||48<=t&&t<=57||96<=t&&t<=105})})},nlApp=nlApp||function(){var t=$('<div class="modal fade" id="pleaseWaitDiv" role="dialog" style="display:none"><div class="modal-dialog" data-backdrop="static" data-keyboard="false"><div class="modal-content"><div class="modal-header"><h4 class="modal-title"><i class="fa fa-clock-o"></i>处理中...</h4></div><div class="modal-body center-block"><div class="progress progress-striped active"><div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;"></div></div></div></div></div>');return{showPleaseWait:function(){$("body").css({cursor:"wait"}),t.modal({backdrop:"static",keyboard:!1}).modal("show")},hidePleaseWait:function(){$("body").css({cursor:"default"}),t.modal("hide")},setTitle:function(e){t=$('<div class="modal fade" id="pleaseWaitDiv" role="dialog" style="display:none"><div class="modal-dialog" data-backdrop="static" data-keyboard="false"><div class="modal-content"><div class="modal-header"><h4 class="modal-title"><i class="fa fa-clock-o"></i>'+e+'</h4></div><div class="modal-body center-block"><div class="progress progress-striped active"><div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;"></div></div></div></div></div>')}}}();var tableToExcel=function(e,t,n){var i,l,a={worksheet:t||"Worksheet",table:e};window.location.href="data:application/vnd.ms-excel;base64,"+(l=a,i='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<meta http-equiv="content-type" content="text/plain; charset=utf-8"/></head><body><table>{table}</table></body></html>'.replace(/{(\w+)}/g,function(e,t){return l[t]}),window.btoa(unescape(encodeURIComponent(i))))};function saveToExcel(e,t){if(0<e.length){var n=[];n.push("<tr><th>状态</th><th>提单号</th><th>订单号</th><th>订单项次号</th><th>牌号</th><th>开单名称</th><th>销售部门</th><th>厚度</th><th>宽度</th><th>长度</th><th>尺寸类型</th><th>客户价格</th><th>车船价格</th><th>代收代付价格</th><th>单重</th><th>块数</th><th>总重量</th><th>发货仓库</th><th>合同号</th><th>创建日期</th><th>发货日期</th><th>创建人</th><th>发货人员</th></tr>");for(var i="<tr>",l=0;l<23;++l)i+="<td>{"+l+"}</td>";i+="</tr>",e.forEach(function(e){var t=getInvoicePriceInfo(e);n.push(i.format(e.status,e.bill_no,e.order_no,e.order_item_no,e.brand_no?e.brand_no:"",e.billing_name?e.billing_name:"",e.sales_dep?e.sales_dep:"",getStrValue(e.thickness),getStrValue(e.width),getStrValue(e.len),e.size_type?e.size_type:"",getStrValue(t.totalCustomerPrice),getStrValue(t.totalVehPrice),getStrValue(e.collection_price),getStrValue(e.weight),getStrValue(e.block_num),getStrValue(e.total_weight),e.ship_warehouse?e.ship_warehouse:"",e.contract_no?e.contract_no:"",date2Str(e.create_date),date2Str(e.shipping_date),e.creater?e.creater:"",e.shipper?e.shipper:""))}),tableToExcel(n.join("\n"),t)}else bootbox.alert("无数据可导出!")}function getStrByStatus(e,t){return"已结算"===t?'<code style="color:#9564ad">'+e+"</code>":"已开票"===t?'<code style="color:blue">'+e+"</code>":"已回款"===t?'<code style="color:green">'+e+"</code>":"已配发"===t?'<code style="color:#dc143c">'+e+"</code>":"不需要结算"===t?'<code style="color:darkgray">'+e+"</code>":"未结算"===t?'<code style="color:red">'+e+"</code>":"待配发"===t?'<code style="color:#000000">'+e+"</code>":'<code style="color:darkgray">'+e+"</code>"}function getInvoicePriceInfo(n){function i(e,t){return 0<e?getStrByStatus(getStrValue(e),t):'<code style="color:grey">无</code>'}var l=0,a=0,o="",s="",r=0,c='<div>{0}, <code style="color:black">{1}</code>, {2}</div>';return n.invoices.forEach(function(e){if(e.veh_ves_name){r+=e.num;var t=0<n.block_num?e.num*n.weight:e.weight;if(l+=e.price*t,o+=c.format(e.veh_ves_name,getStrValue(t),i(e.price,n.status)),a+=e.veh_ves_price*t,s+=c.format(e.veh_ves_name,getStrValue(t),i(e.veh_ves_price,n.status)),e.vehicles.length){e.vehicles.forEach(function(e){t=0<n.block_num?e.send_num*n.weight:e.send_weight,s+='<div>--\x3e{0}, <code style="color:black">{1}</code>, {2}</div>'.format(e.veh_name,getStrValue(t),i(e.veh_price,n.status)),0<e.veh_price&&(a+=e.veh_price*t)})}}}),n.customer_price=l,{customerPriceHtml:o,vehPriceHtml:s,totalCustomerPrice:l,totalVehPrice:a,totalNumber:r}}function getAllList(e,t,n,i){var l,a,o=[];if(e)if(i&&i.length)for(l=0,a=t.length;l<a;++l){t[l][n].forEach(function(e){var t=e[i];t&&o.indexOf(t)<0&&o.push(t)})}else for(l=0,a=t.length;l<a;++l){var s=t[l][n];s&&o.indexOf(s)<0&&o.push(s)}else if(i&&i.length)for(l=0,a=t.length;l<a;++l){t[l][n].forEach(function(e){e[i]&&o.push(e[i])})}else for(l=0,a=t.length;l<a;++l)t[l][n]&&o.push(t[l][n]);return o}function makeOption(e){return'<option value="'+e+'">'+e+"</option>"}function operationEN2CN(e){return"contain"==e?"包含":"eq"==e?"等于":"neq"==e?"不等于":"gt"==e?"大于":"lt"==e?"小于":"gte"==e?"大于等于":"lte"==e?"小于等于":"in"==e?"区间":void 0}var SearchHandlerD=function(e){this.uiElems={sField:$("#all_search_fields"),sOperation:$("#field_oper"),bApply:$("#field_apply"),iFieldValue:$("#field_val"),sFieldValue:$("#field-val"),iFieldValueDate:$("#field-val-date"),iFieldValueDateGrp:$("#field-val-date-group"),iFieldValue2:$("#field_val2"),sFieldValue2:$("#field-val2"),iFieldValueDate2:$("#field-val-date2"),iFieldValueDateGrp2:$("#field-val-date-group2"),fieldValGrp2:$("#field_val_grp2"),tree:$("#search_condition_tree"),bAnd:$("#search_and"),bOr:$("#search_or"),bDelete:$("#search_del"),bExec:$("#search_exec"),bOK:$("#search_ok"),table:$("#search_table"),thead:$("#search_thead"),tbody:$("#search_tbody"),div_result_show:$("#search_result"),result_show:$("#search_result_show")},this.runOngoing=!1,"invoice"===(this.type=e)?(this.data={fields:[{name_cn:"运单号",name_en:"waybill_no",operations:["contain","eq","neq"]},{name_cn:"车船号",name_en:"vehicle_vessel_name",operations:["contain","eq","neq"]},{name_cn:"开单名称",name_en:"ship_name",operations:["contain","eq","neq"]},{name_cn:"发货单位",name_en:"ship_customer",operations:["contain","eq","neq"]},{name_cn:"发货日期",name_en:"ship_date",operations:["eq","neq","gt","lt","gte","lte","in"]},{name_cn:"发货目的地",name_en:"ship_to",operations:["contain","eq","neq"]},{name_cn:"发货仓库",name_en:"ship_warehouse",operations:["contain","eq","neq"]},{name_cn:"发运总重",name_en:"total_weight",operations:["eq","neq","gt","lt","gte","lte","in"]},{name_cn:"发货人",name_en:"shipper",operations:["contain","eq","neq"]},{name_cn:"运单创建人",name_en:"username",operations:["contain","eq","neq"]},{name_cn:"运单状态",name_en:"state",operations:["contain","eq","neq"]}]},showHtmlElement(this.uiElems.table,!0),showHtmlElement(this.uiElems.div_result_show,!1)):"bill"===e?(this.data={fields:[{name_cn:"提单号",name_en:"bill_no",operations:["contain","eq","neq"]},{name_cn:"订单号",name_en:"order_no",operations:["contain","eq","neq"]},{name_cn:"项次号",name_en:"order_item_no",operations:[],noOperation:!0},{name_cn:"牌号",name_en:"brand_no",operations:["contain","eq","neq"]},{name_cn:"开单名称",name_en:"billing_name",operations:["contain","eq","neq"]},{name_cn:"长",name_en:"len",operations:["eq","neq","gt","lt","gte","lte","in"]},{name_cn:"宽",name_en:"width",operations:["eq","neq","gt","lt","gte","lte","in"]},{name_cn:"厚",name_en:"thickness",operations:["eq","neq","gt","lt","gte","lte","in"]},{name_cn:"尺寸",name_en:"size_type",operations:["eq","neq"]},{name_cn:"单块重",name_en:"weight",operations:["eq","neq","gt","lt","gte","lte","in"]},{name_cn:"实际块数",name_en:"block_num",operations:["eq","neq","gt","lt","gte","lte","in"]},{name_cn:"总重量",name_en:"total_weight",operations:["eq","neq","gt","lt","gte","lte","in"]},{name_cn:"剩余块数或重量",name_en:"left_num",operations:["eq","neq","gt","lt","gte","lte","in"]},{name_cn:"存放仓库",name_en:"warehouse",operations:["contain","eq","neq"]},{name_cn:"发货仓库",name_en:"ship_warehouse",operations:["contain","eq","neq"]},{name_cn:"合同号",name_en:"contract_no",operations:["contain","eq","neq"]},{name_cn:"销售部门",name_en:"sales_dep",operations:["contain","eq","neq"]},{name_cn:"收货地址",name_en:"shipping_address",operations:["contain","eq","neq"]},{name_cn:"创建日期",name_en:"create_date",operations:["eq","neq","gt","lt","gte","lte","in"]},{name_cn:"配发日期",name_en:"shipping_date",operations:["eq","neq","gt","lt","gte","lte","in"]},{name_cn:"创建人",name_en:"creater",operations:["contain","eq","neq"]},{name_cn:"发货人",name_en:"shipper",operations:["contain","eq","neq"]},{name_cn:"状态",name_en:"status",operations:["eq","neq"]}]},showHtmlElement(this.uiElems.table,!1),showHtmlElement(this.uiElems.div_result_show,!0)):"invoice_bill"===e&&(this.data={fields:[{name_cn:"车船号",name_en:"vehicle_vessel_name",operations:["contain","eq","neq"]},{name_cn:"开单名称",name_en:"ship_name",operations:["contain","eq","neq"]},{name_cn:"发货目的地",name_en:"ship_to",operations:["contain","eq","neq"]},{name_cn:"发货日期",name_en:"ship_date",operations:["eq","neq","gt","lt","gte","lte","in"]},{name_cn:"提单号",name_en:"bill_no",operations:["contain","eq","neq"]},{name_cn:"订单号",name_en:"order_no",operations:["contain","eq","neq"]}]});var t={};this.data.fields.forEach(function(e){t[e.name_cn]=e.name_en}),this.fields=t,this.selectOne=void 0,this.result={}};function createTreeNode(e,t){var n=e.get_selected();if(!n.length)return n=e.create_node("#",t),e.select_node(n,!0),e.open_node(n,!0),!0;var i=e.get_text(n);if(i==t.text)return!1;if(0<=i.indexOf("AND")||0<=i.indexOf("OR"))n=n[0],n=e.create_node(n,t);else{if(!(n=e.get_parent(n)).length)return!1;if((i=e.get_text(n))==t.text)return!1;n=e.create_node(n,t)}return e.deselect_all(!0),e.select_node(n,!0),!0}SearchHandlerD.prototype.initial=function(t){var a=this,n="<tr>";a.uiElems.sField.empty(),this.data.fields.forEach(function(e){if(!e.noOperation){var t='<option value="{0}">{1}</option>'.format(e.name_en,e.name_cn);a.uiElems.sField.append(t)}n+="<th>"+e.name_cn+"</th>"}),"invoice_bill"!=a.type&&(a.uiElems.thead.empty(),a.uiElems.thead.append(n+"</tr>"),a.uiElems.tbody.empty()),a.uiElems.bApply.addClass("disabled"),a.uiElems.bOK.addClass("disabled"),unselected(a.uiElems.sOperation),a.uiElems.iFieldValue.val(""),a.uiElems.sFieldValue.val(""),a.uiElems.iFieldValueDate.val(""),a.uiElems.iFieldValue2.val(""),a.uiElems.sFieldValue2.val(""),a.uiElems.iFieldValueDate2.val(""),a.uiElems.iFieldValueDateGrp.datetimepicker(getDateTimePickerOptions()).on("dp.change",function(){var e=a.uiElems.sOperation.val(),t=a.uiElems.iFieldValueDate.val();e&&"in"!=e&&setHtmlElementDisabled(a.uiElems.bApply,!t)}),a.uiElems.iFieldValueDateGrp2.datetimepicker(getDateTimePickerOptions()).on("dp.change",function(){var e=a.uiElems.iFieldValueDate.val();setHtmlElementDisabled(a.uiElems.bApply,!e)}),a.uiElems.tree.jstree({core:{animation:0,check_callback:!0,data:{text:"AND (并且)",state:{opened:!0,selected:!0}}}}),a.uiElems.tree.jstree("reflesh"),a.runOngoing=!1,a.uiElems.sField.on("change",function(){var e=this.value;if(e){a.uiElems.iFieldValue.val(""),a.uiElems.sFieldValue.val(""),a.uiElems.iFieldValueDate.val(""),a.uiElems.iFieldValue2.val(""),a.uiElems.sFieldValue2.val(""),a.uiElems.iFieldValueDate2.val(""),a.uiElems.iFieldValue.prop("disabled",!0),a.uiElems.iFieldValue2.prop("disabled",!0),a.uiElems.fieldValGrp2.hide(),a.uiElems.bApply.addClass("disabled"),a.uiElems.sOperation.empty();for(var t=0;t<a.data.fields.length;++t){var n=a.data.fields[t];if(n.name_en==e){n.operations.forEach(function(e){var t='<option value="{0}">{1}</option>'.format(e,operationEN2CN(e));a.uiElems.sOperation.append(t)}),0<=e.indexOf("date")?(showHtmlElement(a.uiElems.iFieldValueDateGrp,!0),showHtmlElement(a.uiElems.iFieldValue,!1),showHtmlElement(a.uiElems.sFieldValue,!1)):"status"==e||"size_type"==e?(showHtmlElement(a.uiElems.sFieldValue,!0),showHtmlElement(a.uiElems.iFieldValue,!1),showHtmlElement(a.uiElems.iFieldValueDateGrp,!1),a.uiElems.sFieldValue.empty(),"status"==e?(a.uiElems.sFieldValue.append("<option>新建</option>"),a.uiElems.sFieldValue.append("<option>已配发</option>"),a.uiElems.sFieldValue.append("<option>已结算</option>")):(a.uiElems.sFieldValue.append("<option>定尺</option>"),a.uiElems.sFieldValue.append("<option>单定</option>")),unselected(a.uiElems.sFieldValue)):(showHtmlElement(a.uiElems.iFieldValue,!0),showHtmlElement(a.uiElems.iFieldValueDateGrp,!1),showHtmlElement(a.uiElems.sFieldValue,!1));break}}unselected(a.uiElems.sOperation)}}),a.uiElems.sOperation.on("change",function(){var e=this.value;a.uiElems.iFieldValue.prop("disabled",!e),a.uiElems.sFieldValue.prop("disabled",!e),a.uiElems.iFieldValueDate.prop("disabled",!e),a.uiElems.iFieldValue2.prop("disabled",!e),a.uiElems.sFieldValue2.prop("disabled",!e),a.uiElems.iFieldValueDate2.prop("disabled",!e);var t=a.uiElems.sField.val();"in"==e?(showHtmlElement(a.uiElems.fieldValGrp2,!0),0<=t.indexOf("date")?(showHtmlElement(a.uiElems.iFieldValueDateGrp2,!0),showHtmlElement(a.uiElems.iFieldValue2,!1)):(showHtmlElement(a.uiElems.iFieldValueDateGrp2,!1),showHtmlElement(a.uiElems.iFieldValue2,!0))):(showHtmlElement(a.uiElems.fieldValGrp2,!1),showHtmlElement(a.uiElems.iFieldValueDateGrp2,!1),showHtmlElement(a.uiElems.iFieldValue2,!0))}),a.uiElems.iFieldValue.on("keyup paste",function(e){e.stopImmediatePropagation();var t=a.uiElems.sOperation.val();t&&"in"!=t&&setHtmlElementDisabled(a.uiElems.bApply,!this.value)}),a.uiElems.sFieldValue.on("change",function(e){e.stopImmediatePropagation();var t=a.uiElems.sOperation.val();t&&"in"!=t&&setHtmlElementDisabled(a.uiElems.bApply,!this.value)}),a.uiElems.iFieldValue2.on("keyup paste",function(e){e.stopImmediatePropagation(),setHtmlElementDisabled(a.uiElems.bApply,!this.value)}),a.uiElems.bApply.on("click",function(){var e=a.uiElems.sField.find("option:selected").text(),t=a.uiElems.sOperation.find("option:selected").text(),n=a.uiElems.iFieldValue.val(),i=!1;if(0<=e.indexOf("日期")&&(n=a.uiElems.iFieldValueDate.val(),i=!0),"区间"==t){var l=a.uiElems.iFieldValue2.val();i&&(l=a.uiElems.iFieldValueDate2.val()),a.createNode({text:e+" "+t+" "+n+" "+l})}else"状态"!=e&&"尺寸"!=e||(n=a.uiElems.sFieldValue.val()),a.createNode({text:e+" "+t+" "+n})}),a.uiElems.bAnd.on("click",function(){a.createNode({text:"AND (并且)"})}),a.uiElems.bOr.on("click",function(){a.createNode({text:"OR (或者)"})}),a.uiElems.bDelete.on("click",function(){var e=a.uiElems.tree.jstree(!0);if(e){var t=e.get_selected();if(!t.length)return!1;var n=e.get_parent(t);n&&"#"!=n&&(e.delete_node(t),e.select_node(n,!0))}}),a.uiElems.bExec.on("click",function(){if(!a.runOngoing){var e=a.uiElems.tree.jstree(!0).get_json("#");a.runOngoing=!0,$.get(t,{q:JSON.stringify(e[0]),isNeedAnalysis:!0,field:a.fields},function(e){var t=JSON.parse(e);console.log(t.ok),t.ok?(a.result=t,a.selectOne=-1,a._setDataAndShow(),500<t.number&&bootbox.alert("当前查询结果 = "+t.number+", 数量太多（超过500个），请进一步限定条件！")):bootbox.alert("错误的条件!"),a.runOngoing=!1})}})},SearchHandlerD.prototype.okEventHandler=function(e){var t=this;this.uiElems.bOK.on("click",function(){"invoice"==t.type?null!=t.selectOne&&0<=t.selectOne&&e(t.result,t.selectOne):e(t.result)})},SearchHandlerD.prototype._setDataAndShow=function(){var l=this;if(l.uiElems.tbody.empty(),"invoice"==l.type){$.each(l.result.invoices,function(e,t){var n='<span class="label label-success">新建</span>';"已结算"===t.state?n='<span class="label label-default">已结算</span>':"已配发"===t.state&&(n='<span class="label label-info">已配发</span>');var i="<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td><td>{6}</td><td>{7}</td><td>{8}</td><td>{9}</td><td>{10}</td></tr>".format(t.waybill_no,t.vehicle_vessel_name?t.vehicle_vessel_name:"",t.ship_name?t.ship_name:"",t.ship_customer?t.ship_customer:"",t.ship_date?date2Str(t.ship_date):"",t.ship_to?t.ship_to:"",t.ship_warehouse?t.ship_warehouse:"",getStrValue(t.total_weight),t.shipper?t.shipper:"",t.username?t.username:"",n);l.uiElems.tbody.append(i)}),tr_click(l.uiElems.tbody.find("tr"),function(e,t){0<=t&&(l.uiElems.bOK.removeClass("disabled"),l.selectOne=t)})}else l.result.bills.length?(setHtmlElementDisabled(l.uiElems.bOK,!1),l.uiElems.result_show.text("共查询出提单记录数:"+l.result.bills.length)):(setHtmlElementDisabled(l.uiElems.bOK,!0),l.uiElems.result_show.text("没有找到数据, 请检查查询条件!"))},SearchHandlerD.prototype.createNode=function(e){var t=this.uiElems.tree.jstree(!0);if(!t)return!1;createTreeNode(t,e)};var FilterElementD=function(e,t,n,i,l){this.elem=e,this.options=t.slice(),this.visibleOptions=t.slice(),this.selected=[],initSelect(this.elem,this.options,!1);var a=this,o={buttonWidth:"100%",maxHeight:300,dropRight:n,enableFiltering:!0,filterPlaceholder:"查询",buttonText:function(e,t){if(0===e.length)return"未选择...";if(1<e.length)return"选择了"+e.length+"个";var n=[];return e.each(function(){void 0!==$(this).attr("label")?n.push($(this).attr("label")):n.push($(this).html())}),n.join(", ")},onChange:function(e,t){var n="select-all-value";if(e&&(n=e.val()),!0===t)"select-all-value"===n?a.selected=a.visibleOptions.slice():a.selected.indexOf(n)<0&&a.selected.push(n);else if(!1===t)if("select-all-value"===n)a.selected=[];else for(var i=a.selected.length-1;0<=i;--i)if(a.selected[i]===n){a.selected.remove(i);break}l&&l(a.selected)}};i&&(o.includeSelectAllOption=!0,o.selectAllText="选择全部",o.selectAllValue="select-all-value"),this.elem.multiselect(o)};FilterElementD.prototype.rebuild=function(e,t){this.visibleOptions=e.slice(),initSelect(this.elem,e,!1),this.elem.multiselect("rebuild"),t&&this.elem.multiselect("select",t)},FilterElementD.prototype.selectAll=function(){this.elem.multiselect("selectAll",!1),this.elem.multiselect("updateButtonText")},FilterElementD.prototype.selectNone=function(){return 0===this.selected.length},FilterElementD.prototype.rebuildAndSelectAll=function(e){var t=this;t.visibleOptions=e.slice(0),initSelect(t.elem,e,!1),t.elem.multiselect("rebuild"),t.elem.multiselect("selectAll",!1),t.elem.multiselect("updateButtonText"),t.selected=e.slice(0)},FilterElementD.prototype.disabled=function(e){e?this.elem.multiselect("disable"):this.elem.multiselect("enable")};
//# sourceMappingURL=main.js.map
