$(function(){var o,e=$("#data-add"),d=$("#data-modify"),n=$("#data-delete"),l=$("#data-btn-ok"),m=$("#data-tbody"),c=-1,s=-1,i=$("#need-more"),r=$("#address-group"),h=$("#veh-input"),p=$("#dict_name"),u=$("#veh-category"),v=$("#address"),f=$("#contact"),_=$("#phone"),g="车",a=$("#data-search"),y="";"undefined"!=typeof local_data&&null!=local_data&&(o=local_data,y=local_operObject,a.append(makeOption("所有记录")),$.each(o,function(e,t){a.append(makeOption(t.name))}),a.select2(),a.select2("val",""),a.on("change",function(){D(this.value)})),setHtmlElementDisabled(d,!0),setHtmlElementDisabled(n,!0),O();var b="";function t(e,t,a){if(0<=s){var d=o[s];V(e),setElementValue(p,d.name),p.prop("disabled",!0),"brand"===y||"sale_dep"===y?showHtmlElement(i,!1):(showHtmlElement(i,!0),"company"===y?(showHtmlElement($("#customer-group"),!0),$("#customers").val(d.customers)):showHtmlElement($("#customer-group"),!1),"vehicle"===y?(showHtmlElement(r,!1),showHtmlElement(h,!0),d.veh_category?setElementValue(u,d.veh_category):unselected(u),"车"===d.veh_type?$("#che").iCheck("check"):"船"===d.veh_type?$("#chuan").iCheck("check"):($("#che").iCheck("uncheck"),$("#chuan").iCheck("uncheck"))):(showHtmlElement(r,!0),showHtmlElement(h,!1),setElementValue(v,d.address)),setElementValue(f,d.contact_name),setElementValue(_,d.phone)),b=a,setHtmlElementDisabled(l,!1),E(t),$("#data-dialog").modal({backdrop:"static",keyboard:!1}).modal("show")}}function E(e){"company"==y?($("#lbl-name").text("开单名称"),$("#dialog-title").text(e+"开单名称")):"vehicle"==y?($("#lbl-name").text("车船号"),$("#dialog-title").text(e+"车船号")):"destination"==y?($("#lbl-name").text("目的地"),$("#dialog-title").text(e+"目的地")):"warehouse"==y?($("#lbl-name").text("仓库"),$("#dialog-title").text(e+"仓库")):"brand"==y?($("#lbl-name").text("牌号"),$("#dialog-title").text(e+"牌号")):"sale_dep"===y&&($("#lbl-name").text("销售部门"),$("#dialog-title").text(e+"销售部门"))}function w(e,t,a){ajaxRequestHandle(e,"POST",t,a,function(){o.remove(s),s=c=-1,D(null),$("#data-dialog").modal("hide")})}function H(){if("brand"===y||"sale_dep"===y)return{name:p.val()};if("vehicle"===y)return{name:p.val(),veh_type:g,veh_category:u.val(),contact_name:f.val(),phone:_.val()};if("company"!==y)return{name:p.val(),contact_name:f.val(),phone:_.val(),address:v.val()};var e=[],t=$("#customers").val();return isEmpty(t)||(e=t.split(/[,，\r\n]/)),{name:p.val(),customers:e,contact_name:f.val(),phone:_.val(),address:v.val()}}function x(e,t){var a=H();ajaxRequestHandle(e,"POST",a,t,function(){o&&(o.push(a),D(null)),$("#data-dialog").modal("hide")})}function k(e,t){var a=H();ajaxRequestHandle(e,"POST",a,t,function(){if(o&&0<=s){o[s].contact_name=a.contact_name,o[s].phone=a.phone;var e="<td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td>".format(s+1,a.name,a.contact_name,a.phone);e="vehicle"===y?(o[s].veh_type=a.veh_type,o[s].veh_category=a.veh_category,"<td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td>".format(s+1,a.name,a.veh_type,a.veh_category,a.contact_name,a.phone)):"company"===y?(o[s].customers=a.customers,o[s].address=a.address,"<td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td>".format(s+1,a.name,a.customers,a.address,a.contact_name,a.phone)):(o[s].address=a.address,"<td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td>".format(s+1,a.name,a.address,a.contact_name,a.phone)),m.find("tr").eq(c).html(e)}$("#data-dialog").modal("hide")})}function D(a){if(m.empty(),0<o.length){var d="<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td></tr>";"brand"===y||"sale_dep"===y?(d="<tr><td>{0}</td><td>{1}</td></tr>",$.each(o,function(e,t){(!a||"所有记录"===a||0<=t.name.indexOf(a))&&m.append(d.format(e+1,t.name))})):"company"===y?(d="<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td></tr>",$.each(o,function(e,t){(!a||"所有记录"===a||0<=t.name.indexOf(a))&&m.append(d.format(e+1,t.name,t.customers,t.address?t.address:"",t.contact_name?t.contact_name:"",t.phone?t.phone:""))})):"vehicle"===y?(d="<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td></tr>",$.each(o,function(e,t){(!a||"所有记录"===a||0<=t.name.indexOf(a))&&m.append(d.format(e+1,t.name,t.veh_type?t.veh_type:"",t.veh_category?t.veh_category:"",t.contact_name?t.contact_name:"",t.phone?t.phone:""))})):(d="<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td></tr>",$.each(o,function(e,t){(!a||"所有记录"===a||0<=t.name.indexOf(a))&&m.append(d.format(e+1,t.name,t.address?t.address:"",t.contact_name?t.contact_name:"",t.phone?t.phone:""))})),O()}}function O(){tr_click(m.find("tr"),function(e,t){c=t;var a=$(e.currentTarget);s=parseInt(getTableCellChildren(a,0).text())-1,0<=c?(setHtmlElementDisabled(d,!1),setHtmlElementDisabled(n,!1)):(setHtmlElementDisabled(d,!0),setHtmlElementDisabled(n,!0))})}function V(e){var t=$("#data-input"),a=t.find("input"),d=t.find("textarea");a.val(""),a.prop("disabled",e),d.val(""),d.prop("disabled",e)}e.on("click",function(){V(!1),"brand"!=y&&"sale_dep"!=y?("company"===y?showHtmlElement($("#customer-group"),!0):showHtmlElement($("#customer-group"),!1),showHtmlElement(i,!0),"vehicle"===y?(showHtmlElement(r,!1),showHtmlElement(h,!0)):(showHtmlElement(r,!0),showHtmlElement(h,!1))):showHtmlElement(i,!1),b="add",E("增加"),$("#data-dialog").modal({backdrop:"static",keyboard:!1}).modal("show")}),d.on("click",function(){t(!1,"修改","modify")}),n.on("click",function(){t(!0,"删除","delete")}),$("#data-export").on("click",function(){var e=$("#data-table").html(),t="download";"company"==y?t="开单名称":"vehicle"==y?t="车船号":"destination"==y?t="目的地":"warehouse"==y?t="仓库":"brand"==y?t="牌号":"sale_dep"===y&&(t="销售部门"),t+=date2Str(new Date)+".xls",tableToExcel(e,"data",t)}),$("#che").on("ifChecked",function(){g="车"}).on("ifUnchecked",function(){g="船"}),p.on("keyup paste blur",function(){!function(e){var t=$("#same-name");t.text("");var a=e.val();if(a&&(setHtmlElementDisabled(l,!1),o))for(var d=0;d<o.length;++d)if(a===o[d].name){t.text("名称已存在!"),setHtmlElementDisabled(l,!0);break}}(p)}),l.on("click",function(){if("add"==b)"company"==y?x("/datamgt/company_add","添加开单名称"):"vehicle"==y?x("/datamgt/vehicle_add","添加车船号"):"warehouse"==y?x("/datamgt/warehouse_add","添加仓库"):"destination"==y?x("/datamgt/destination_add","添加目的地"):"brand"==y?x("/datamgt/brand_add","添加牌号"):"sale_dep"==y&&x("/datamgt/sale_dep_add","添加销售部门");else if("modify"==b){var e=o[s];if("brand"===y||"sale_dep"===y);else{var t=getElementValue(f),a=getElementValue(_);if("vehicle"===y){var d=getElementValue(u);t==e.contact_name&&a==e.phone&&g==e.veh_type&&d==e.veh_category||k("/datamgt/vehicle_modify","修改车船号")}else{var n=getElementValue(v);"company"==y?k("/datamgt/company_modify","修改开单名称"):n==e.address&&t==e.contact_name&&a==e.phone||("warehouse"==y?k("/datamgt/warehouse_modify","修改仓库"):"destination"==y&&k("/datamgt/destination_modify","修改目的地"))}}}else if("delete"===b){var l=o[s].name;"company"===y?w("/datamgt/company_delete",{name:l},"删除开单名称"):"vehicle"===y?w("/datamgt/vehicle_delete",{name:l},"删除车船号"):"warehouse"===y?w("/datamgt/warehouse_delete",{name:l},"删除仓库"):"destination"===y?w("/datamgt/destination_delete",{name:l},"删除目的地"):"brand"===y?w("/datamgt/brand_delete",{name:l},"删除牌号"):"sale_dep"===y&&w("/datamgt/sale_dep_delete",{name:l},"删除销售部门")}})});
//# sourceMappingURL=data_dict_mgt.js.map
