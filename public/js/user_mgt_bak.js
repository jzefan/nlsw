$(function(){function e(e){if("11111111"===e)return"管理";if(e){var i="";return"1"===e[0]&&(i="业务"),"1"===e[1]&&(i?i+=",统计":i="统计"),"1"===e[2]&&(i?i+=",会计":i="会计"),"1"===e[4]&&(i?i+=",客户营业额":i="客户营业额"),"1"===e[5]&&(i?i+=",车船营业额":i="车船营业额"),i}return""}function i(e){var i=d.val(),c=h.val(),t=l.val(),n=k.val();e?setHtmlElementDisabled(u,isEmpty(i)||isEmpty(t)||isEmpty(c)||isEmpty(n)||!C&&!g&&!y&&!b&&!E&&!x):setHtmlElementDisabled(u,isEmpty(i)||isEmpty(t)||!C&&!g&&!y&&!b&&!E&&!x)}function c(e){C=!0,e&&r.iCheck("check"),g&&(g=!1,f.iCheck("uncheck")),y&&(y=!1,s.iCheck("uncheck")),b&&(b=!1,m.iCheck("uncheck")),E&&(E=!1,v.iCheck("uncheck")),x&&(x=!1,p.iCheck("uncheck"))}function t(){C&&(C=!1,r.iCheck("uncheck"))}function n(){d.val(""),h.val(""),k.val(""),l.prop("selectedIndex",0),r.iCheck("uncheck"),f.iCheck("uncheck"),s.iCheck("uncheck"),m.iCheck("uncheck"),v.iCheck("uncheck"),p.iCheck("uncheck")}function a(){H.empty();var i="<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td></tr>";w.forEach(function(c){H.append(i.format(c.userid,c.name,c.title?c.title:"",e(c.privilege),c.phone))}),H.find("tr").on("click",function(){H.find("tr").removeClass("invoice-highlighted");var e=$(this),i=w[e.index()];o&&i.userid===o.userid?o=void 0:(o=i,e.addClass("invoice-highlighted"))})}var o,d=$("#u-name"),h=$("#u-real-name"),l=$("#employee-title"),k=$("#u-phone"),u=$("#data-btn-ok"),r=$("#p-admin"),f=$("#p-operator"),s=$("#p-account"),m=$("#p-statistics"),p=$("#p-vessel-revenue"),v=$("#p-cust-revenue"),C=!1,g=!1,y=!1,b=!1,E=!1,x=!1,H=$("#data-tbody"),w=local_data,U="",D=["ceo","mgr","operator","account","statistician"],O=["董事长","经理","业务员","会计","统计员"];a(),n(),r.on("ifChecked",function(){c(!1),i(!1)}),r.on("ifUnchecked",function(){C=!1,i(!1)}),f.on("ifChecked",function(){g=!0,t(),i(!1)}),f.on("ifUnchecked",function(){g=!1,i(!1)}),s.on("ifChecked",function(){y=!0,t(),i(!1)}),s.on("ifUnchecked",function(){y=!1,i(!1)}),m.on("ifChecked",function(){b=!0,t(),i(!1)}),m.on("ifUnchecked",function(){b=!1,i(!1)}),v.on("ifChecked",function(){E=!0,t(),i(!1)}),v.on("ifUnchecked",function(){E=!1,i(!1)}),p.on("ifChecked",function(){x=!0,t(),i(!1)}),p.on("ifUnchecked",function(){x=!1,i(!1)});var T=$("#same-name");d.on("keyup paste",function(){var e=!1,c=d.val();if(!isEmpty(c))for(var t=0;t<w.length;++t)if(c===w[t].userid){T.text("此用户名已注册!"),e=!0;break}e||(i(!1),T.text(""))}),l.on("change",function(){var e=l.val();"ceo"===e||"mgr"===e?c(!0):(t(),"operator"===e?(g=!0,f.iCheck("check"),s.iCheck("uncheck"),m.iCheck("uncheck")):"account"===e?(y=!0,f.iCheck("uncheck"),s.iCheck("check"),m.iCheck("uncheck")):"statistician"===e&&(b=!0,f.iCheck("uncheck"),s.iCheck("uncheck"),m.iCheck("check"))),i(!1)}),h.on("keyup paste",function(){"modify"===U&&i(!0)}),k.on("keyup paste",function(){"modify"===U&&i(!0)}),$("#data-add").on("click",function(){U="add",n(),$("#dialog-title").text("新建用户"),showHtmlElement($("#pwd-hint"),!0),setHtmlElementDisabled(d,!1),$("#data-dialog").modal({backdrop:"static",keyboard:!1}).modal("show")}),$("#data-delete").on("click",function(){o?ajaxRequestHandle("/user_mgr","POST",{act:"delete",userid:o.userid},"删除用户",function(){for(var e=0;e<w.length;++e)if(w[e].userid===o.userid){w.remove(e),o=void 0;break}a(),$("#data-dialog").modal("hide")}):bootbox.alert("请选择某一用户")}),$("#data-modify").on("click",function(){if(o){U="modify",d.val(o.userid),h.val(o.name?o.name:""),k.val(o.phone?o.phone:""),"11111111"===o.privilege?c(!0):o.privilege&&(t(),"1"===o.privilege[0]&&(f.iCheck("check"),g=!0),"1"===o.privilege[1]&&(m.iCheck("check"),b=!0),"1"===o.privilege[2]&&(s.iCheck("check"),y=!0),"1"===o.privilege[4]&&(v.iCheck("check"),E=!0),"1"===o.privilege[5]&&(p.iCheck("check"),x=!0));var e=O.indexOf(o.title);l.val(e>=0?D[e]:""),$("#dialog-title").text("修改用户"),showHtmlElement($("#pwd-hint"),!1),setHtmlElementDisabled(d,!0),$("#data-dialog").modal({backdrop:"static",keyboard:!1}).modal("show")}else bootbox.alert("请选择某一用户")}),u.on("click",function(){var e=d.val(),i=h.val(),c=l.val(),t=k.val(),n="";C?n="11111111":(n+=g?"1":"0",n+=b?"1":"0",n+=y?"1":"0",n+=E&&x?"1":"0",n+=E?"1":"0",n+=x?"1":"0",n+="00");var o=D.indexOf(c);c=o>=0?O[o]:"";var u={userid:e,name:isEmpty(i)?"":i,title:c,phone:isEmpty(t)?"":t,privilege:n};ajaxRequestHandle("/user_mgr","POST",{act:U,data:u},"新建用户",function(){if(w){if("add"===U)w.push(u);else for(var i=0;i<w.length;++i)if(e===w[i].userid){w[i].name=u.name,w[i].title=c,w[i].phone=t,w[i].privilege=n;break}a()}$("#data-dialog").modal("hide")})}),$("#data-export").on("click",function(){var e=$("#data-table").html();tableToExcel(e,"data","")})});
//# sourceMappingURL=user_mgt.js.map
