{"version":3,"sources":["settle_mgt.js"],"names":["$","tableBody","btnCustomer","btnCollection","btnFilter","btnExport","singlePriceInput","batchPriceInput","btnSettle","btnNonSettle","dbBills","curr_bills","selected_bills","curr_show_bills","action","CUSTOMER_SETTLE_FLAG","COLLECTION_SETTLE_FLAG","qFilter","QueryFilterD","local_data","local_data_2","needUpdateDbData","emptyDbData","css","cursor","obj","getQueryParams","get","data","result","jQuery","parseJSON","ok","sortByKey","bills","updateOptions","showHintText","getNonSettleParamObj","res","forEach","b","inv_settle_flag","price","push","bid","_id","inv_no","collection_price","settle_flag","html","enableButtons","showHtmlElement","elementEventRegister","removeClass","addClass","reset","length","bill","id","msg","str","bill_no","order","format","getStrValue","veh_ves_name","ship_from","ship_to","bootbox","dialog","message","title","buttons","cancel","label","className","main","callback","updated","getPriceValue","ajaxRequestHandle","act","numOfRow","find","i","tr","getRowChildren","getTableCellChildren","text","o","no","getOrder","order_no","order_item_no","updatePriceColumn","buildPriceDialog","alert","buildBatchInputForCollection","buildPriceBatchInputDialog","checkBox","prop","slice","showSelectedTotalValue","allName","shipToList","indexOf","billing_name","settleObj","totPrice","send_weight","num","send_num","weight","bname","ship_customer","setHtmlElementDisabled","settle_type","billName","shipTo","join","resetTableRow","hasPrice","bothNotSettle","local_user","privilege","confirm","nonSettleObj","showNonSettle","showHideNotSettle","getPriceText","eq","getState","each","idx","this","idata","isExist","vv2dest","name","hasOwnProperty","item","temp","split","replace","idxList","index","jqId","val","value","parseFloatHTML","isNaN","empty","html_text","makeTableBodyTr","append","on","selectRow","e","stopImmediatePropagation","closest","me","needUpdateCheckbox","found","sameBill","remove","selectedTotalNumber","selectedTotalWeight","sb","setElementValue","statusStr","isEmpty","getStrByStatus","status","statusText","trHtml","priceText","remark","width","len","ship_warehouse","date2Str","inv_ship_date","inv_shipper","iCheck","tableToExcel","showFilter","acquireVehicles","totalNumber","totalWeight","toggle","JSON","parse","setAllVehicles","vehicles","options","options_2","filter","currSelected","self","uiElems","sBfOrder","FilterElementD","isAllEmpty","sBfBillName","sBfDest","sBfVehicle","startDateGrp","endDateGrp","iStartDate","iEndDate","sBfVehType","sBfBillNo","selectedVeh","selectedDest","veh_list","allVehicles","veh_type","initSelect","nameList","vehList","destList","select2","eDate","moment","sDate","subtract","startGrp","datetimepicker","getDateTimePickerOptions","endGrp","setDate","_selectFliterFunc","which","_dateFilterFunc","isStart","isEnd","d1","d2","t","vs","preventDefault","date","startOf","setMinDate","endOf","setMaxDate","prototype","fName","fVeh","fDest","fOrder","fBno","fDate1","toISOString","fDate2","fType","selected","bno","getSelectValue","billNo","nOptions","orderList","billNoList","visibleBills","sort_pinyin","vehs","ds","b1","b2","b3","b4","b6","sort","rebuild"],"mappings":"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","file":"settle_mgt.js","sourcesContent":["/**\r\n * Created by ezefjia on 12/4/2014.\r\n */\r\n\r\n$(function () {\r\n  \"use strict\";\r\n\r\n  var tableBody        = $('#table-tbody');\r\n  var btnCustomer      = $('#customer-btn');\r\n  var btnCollection    = $('#collection-btn');\r\n  var btnFilter        = $('#filter');\r\n  var btnExport        = $('#search-export');\r\n  var singlePriceInput = $('#single-price-input');\r\n  var batchPriceInput  = $('#batch-price-input');\r\n  var btnSettle        = $('#settle-bill');\r\n  var btnNonSettle     = $('#non-settle-bill');\r\n\r\n  var dbBills = [];\r\n  var curr_bills = []; // 存放查询得到的所有提单\r\n  var selected_bills = [];\r\n  var curr_show_bills = [];\r\n\r\n  var action = \"CUSTOMER\";\r\n\r\n  var CUSTOMER_SETTLE_FLAG   = 1; // 0001\r\n  var COLLECTION_SETTLE_FLAG = 2; // 0010\r\n\r\n  var qFilter = new QueryFilterD(local_data, local_data_2, action, filterData);\r\n\r\n  $('#first-th').html('<input id=\"select-all\" type=\"checkbox\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"选择所有记录\" />');\r\n  enableButtons();\r\n  showHtmlElement($('#lb-selected-group'), false);\r\n\r\n  elementEventRegister(btnCustomer, 'click', function() {\r\n    if (action != \"CUSTOMER\") {\r\n      action = \"CUSTOMER\";\r\n      btnCustomer.removeClass(\"btn-default\");\r\n      btnCustomer.addClass(\"btn-primary\");\r\n      btnCollection.removeClass(\"btn-primary\");\r\n      btnCollection.addClass(\"btn-default\");\r\n      qFilter.reset(action);\r\n      showHintText();\r\n    }\r\n  });\r\n\r\n  elementEventRegister(btnCollection, 'click', function() {\r\n    if (action != \"COLLECTION\") {\r\n      action = \"COLLECTION\";\r\n      btnCollection.removeClass(\"btn-default\");\r\n      btnCollection.addClass(\"btn-primary\");\r\n      btnCustomer.removeClass(\"btn-primary\");\r\n      btnCustomer.addClass(\"btn-default\");\r\n      qFilter.reset(action);\r\n      showHintText();\r\n    }\r\n  });\r\n\r\n  elementEventRegister(singlePriceInput, 'click', function() {\r\n    if (selected_bills.length === 1) {\r\n      buildPriceDialog(selected_bills[0]);\r\n    } else if (selected_bills.length > 1) {\r\n      bootbox.alert(\"您选择了多行，请使用批量输入！\");\r\n    } else {\r\n      bootbox.alert(\"请先选定某一行才能输入价格\");\r\n    }\r\n  });\r\n\r\n  elementEventRegister(batchPriceInput, 'click', function() {\r\n    if (selected_bills.length) {\r\n      if (action === 'COLLECTION') {\r\n        buildBatchInputForCollection(selected_bills);\r\n      } else {\r\n        buildPriceBatchInputDialog(selected_bills);\r\n      }\r\n    } else {\r\n      if (action === 'COLLECTION') {\r\n        buildBatchInputForCollection(curr_show_bills);\r\n      } else {\r\n        buildPriceBatchInputDialog(curr_show_bills);\r\n      }\r\n    }\r\n  });\r\n\r\n  elementEventRegister($('#select-all'), 'click', function() {\r\n    if (curr_show_bills.length > 0) {\r\n      var checkBox = $('.select-bill');\r\n      if (selected_bills.length === curr_show_bills.length) { // 之前已经选择\r\n        checkBox.prop(\"checked\", false);\r\n        selected_bills = [];\r\n        tableBody.find(\"tr\").removeClass('invoice-highlighted');\r\n      } else {\r\n        checkBox.prop(\"checked\", true);\r\n        selected_bills = curr_show_bills.slice(0);\r\n        tableBody.find(\"tr\").addClass('invoice-highlighted');\r\n      }\r\n      enableButtons();\r\n      showSelectedTotalValue();\r\n    }\r\n  });\r\n\r\n  elementEventRegister(btnSettle, 'click', function() {\r\n    if (selected_bills.length) {\r\n      var allName = [];\r\n      var shipToList = [];\r\n      for (var i = 0; i < selected_bills.length; ++i) {\r\n        var b = selected_bills[i];\r\n        if (allName.indexOf(b.billing_name) < 0) {\r\n          allName.push(b.billing_name);\r\n          if (allName.length > 1) {\r\n            bootbox.alert(\"您选择的提单中存在多个开单名称, 一次只能结算一个开单名称的提单\");\r\n            return;\r\n          }\r\n        }\r\n\r\n        if (shipToList.indexOf(b.ship_to) < 0) {\r\n          shipToList.push(b.ship_to);\r\n        }\r\n\r\n        if (action === \"COLLECTION\") {\r\n          if (b.collection_price === -1) {\r\n            bootbox.alert(\"您选择的提单:\" + b.bill_no + \"_\" + b.order + \" 已经确定为不需要结算!\");\r\n            return;\r\n          } else if (b.collection_price === 0) {\r\n            bootbox.alert(\"您选择的提单:\" + b.bill_no + \"_\" + b.order + \" 还没有完全输入价格,不能结算\");\r\n            return;\r\n          }\r\n        } else {\r\n          if (b.price === -1) {\r\n            bootbox.alert(\"您选择的提单:\" + b.bill_no + \"_\" + b.order + \" 已经确定为不需要结算!\");\r\n            return;\r\n          } else if (b.price === 0) {\r\n            bootbox.alert(\"您选择的提单:\" + b.bill_no + \"_\" + b.order + \" 还没有完全输入价格,不能结算\");\r\n            return;\r\n          }\r\n        }\r\n      }\r\n\r\n      var settleObj = [];\r\n      var totPrice = 0;\r\n      selected_bills.forEach(function(b) {\r\n        if (action === \"COLLECTION\") {\r\n          totPrice += b.collection_price * b.send_weight;\r\n          b.inv_settle_flag |= COLLECTION_SETTLE_FLAG;\r\n          b.settle_flag |= COLLECTION_SETTLE_FLAG;\r\n        } else {\r\n          totPrice += b.price * b.send_weight;\r\n          b.inv_settle_flag |= CUSTOMER_SETTLE_FLAG;\r\n        }\r\n\r\n        settleObj.push({\r\n          bid: b._id,\r\n          inv_no: b.inv_no,\r\n          num: b.send_num,\r\n          weight: b.send_weight,\r\n          settle_flag: b.inv_settle_flag // (action === \"COLLECTION\") ? b.settle_flag : b.inv_settle_flag\r\n        });\r\n      });\r\n\r\n      var bname = (selected_bills[0].ship_customer ? (selected_bills[0].billing_name + \"/\" + selected_bills[0].ship_customer) : selected_bills[0].billing_name);\r\n      setHtmlElementDisabled(btnSettle, true);\r\n      ajaxRequestHandle('/settle_bill', 'POST',\r\n        { settleObj: settleObj,\r\n          price: totPrice,\r\n          settle_type: action,\r\n          billName: bname,\r\n          shipTo: shipToList.join(\",\")\r\n        }, '结算', function () {\r\n          resetTableRow();\r\n          setHtmlElementDisabled(btnSettle, false);\r\n        });\r\n    } else {\r\n      bootbox.alert(\"请先选择您要结算的提单\");\r\n    }\r\n  });\r\n\r\n  function getNonSettleParamObj() {\r\n    var res = [];\r\n    if (action === \"CUSTOMER\") {\r\n      selected_bills.forEach(function (b) {\r\n        b.inv_settle_flag &= ~CUSTOMER_SETTLE_FLAG;\r\n        b.price = -1;\r\n        res.push({ bid: b._id, inv_no: b.inv_no });\r\n      });\r\n    } else {\r\n      selected_bills.forEach(function (b) {\r\n        b.inv_settle_flag &= ~COLLECTION_SETTLE_FLAG;\r\n        b.collection_price = -1;\r\n        res.push({ bid: b._id, inv_no: b.inv_no, settle_flag: b.inv_settle_flag });\r\n      });\r\n    }\r\n\r\n    return res;\r\n  }\r\n\r\n  elementEventRegister(btnNonSettle, 'click', function() {\r\n    if (selected_bills.length) {\r\n      var hasPrice = false;\r\n      var bothNotSettle = false;\r\n      selected_bills.forEach(function(b) {\r\n        if (action === \"CUSTOMER\") {\r\n          if (b.price > 0) hasPrice = true;\r\n\r\n          if (b.collection_price < 0) {\r\n            bothNotSettle = true;\r\n          }\r\n        } else {\r\n          if (b.collection_price > 0) hasPrice = true;\r\n\r\n          if (b.price < 0) {\r\n            bothNotSettle = true;\r\n          }\r\n        }\r\n      });\r\n\r\n      if (bothNotSettle) {\r\n        if (local_user.privilege !== '11111111') {\r\n          bootbox.alert('点击此不需要结算后，存在客户和代收代付都不需要结算的情况，你并没有相应权限，请联系管理员！');\r\n        } else {\r\n          bootbox.confirm('点击此不需要结算后，存在客户和代收代付都不需要结算的情况，确定不需要结算？', function() {\r\n            var nonSettleObj = [];\r\n            if (hasPrice) {\r\n              bootbox.confirm(\"您选择的提单中已经输入过价格, 不结算后这些价格都会清除为0, 确认吗?\", function(result) {\r\n                if (result) {\r\n                  nonSettleObj = getNonSettleParamObj();\r\n                  ajaxRequestHandle('/collection_not_require_settle', 'POST',\r\n                    { nonSettleObj: nonSettleObj, settle_type: action }, '不需结算', function () {\r\n                      resetTableRow();\r\n                    });\r\n                }\r\n              })\r\n            } else {\r\n              nonSettleObj = getNonSettleParamObj();\r\n              ajaxRequestHandle('/collection_not_require_settle', 'POST',\r\n                { nonSettleObj: nonSettleObj, settle_type: action }, '不需结算', function () {\r\n                  resetTableRow();\r\n                });\r\n            }\r\n          });\r\n        }\r\n      } else {\r\n        var nonSettleObj = [];\r\n        if (hasPrice) {\r\n          bootbox.confirm(\"您选择的提单中已经输入过价格, 不结算后这些价格都会清除为0, 确认吗?\", function (result) {\r\n            if (result) {\r\n              nonSettleObj = getNonSettleParamObj();\r\n              ajaxRequestHandle('/collection_not_require_settle', 'POST',\r\n                {nonSettleObj: nonSettleObj, settle_type: action}, '不需结算', function () {\r\n                  resetTableRow();\r\n                });\r\n            }\r\n          })\r\n        } else {\r\n          nonSettleObj = getNonSettleParamObj();\r\n          ajaxRequestHandle('/collection_not_require_settle', 'POST',\r\n            {nonSettleObj: nonSettleObj, settle_type: action}, '不需结算', function () {\r\n              resetTableRow();\r\n            });\r\n        }\r\n      }\r\n\r\n    } else {\r\n      bootbox.alert(\"请先选择您不打算进行结算的提单\");\r\n    }\r\n  });\r\n\r\n  elementEventRegister($('#update-bill'), 'click', function() {\r\n    ajaxRequestHandle('/initial_settle_flag', 'POST', {}, '初始化数据', function () { });\r\n  });\r\n\r\n  var showNonSettle = false;\r\n  var showHideNotSettle = $('#show-hide-non-settle');\r\n  showHideNotSettle.iCheck('uncheck');\r\n  showHideNotSettle.on('ifChecked', function() {\r\n    showNonSettle = true;\r\n    showHintText();\r\n  });\r\n  showHideNotSettle.on('ifUnchecked', function() {\r\n    showNonSettle = false;\r\n    showHintText();\r\n  });\r\n\r\n  ////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n  /// Function list\r\n  ////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n  function enableButtons() {\r\n    if (curr_show_bills.length) {\r\n      setHtmlElementDisabled(btnExport, false);\r\n      setHtmlElementDisabled(batchPriceInput, false);\r\n    } else {\r\n      setHtmlElementDisabled(btnExport, true);\r\n      setHtmlElementDisabled(batchPriceInput, true);\r\n    }\r\n\r\n    if (selected_bills.length) {\r\n      if (selected_bills.length === 1) {\r\n        setHtmlElementDisabled(singlePriceInput, false);\r\n      } else {\r\n        setHtmlElementDisabled(singlePriceInput, true);\r\n      }\r\n\r\n      setHtmlElementDisabled(btnSettle, false);\r\n      setHtmlElementDisabled(btnNonSettle, false);\r\n    } else {\r\n      setHtmlElementDisabled(btnSettle, true);\r\n      setHtmlElementDisabled(btnNonSettle, true);\r\n      setHtmlElementDisabled(singlePriceInput, true);\r\n    }\r\n  }\r\n\r\n  function getPriceText(price) {\r\n    var priceText = \"\";\r\n    if (price > 0) {\r\n      priceText = '<code style=\"color:green\">' + getStrValue(price) + '</code>';\r\n    } else if (price < 0) {\r\n      priceText = '<code style=\"color:blue\">不需要结算</code>';\r\n    } else {\r\n      priceText = '<code style=\"color:red\">0</code>';\r\n    }\r\n\r\n    return priceText;\r\n  }\r\n\r\n  function updatePriceColumn(tr, bill) {\r\n    tr.find(\"td\").eq(1).html(getState(bill));\r\n    tr.find(\"td\").eq(7).html(getPriceText(action === \"CUSTOMER\" ? bill.price : bill.collection_price));\r\n    //tr.popover('hide').attr('data-content', getBillTooltip(bill));\r\n  }\r\n\r\n  function buildPriceDialog(bill) {\r\n    var id = \"\";\r\n    var msg = '<div class=\"row form-horizontal\"><div class=\"col-md-10\">';\r\n    var str = '<div class=\"form-group\"><label for=\"{0}\" class=\"control-label col-sm-4\">{1}</label><div class=\"input-group col-sm-8\"><input id=\"{2}\" type=\"text\" name=\"{3}\" class=\"form-control\" value=\"{4}\"><span style=\"font-size: 11px\">始发: {5}, 目的地: {6}</span></div></div>';\r\n    if (action === 'COLLECTION') {\r\n      id = bill.bill_no + '_' + bill.order;\r\n      msg += str.format(id, '代收代付价格', id, id, getStrValue(bill.collection_price, \"\", \"\"));\r\n    } else {\r\n      if (bill.veh_ves_name) { // 正常有运单一定有运单车船，需要再检查？\r\n        id = bill.inv_no;\r\n        msg += str.format(id, bill.veh_ves_name, id, id, getStrValue(bill.price), bill.ship_from, bill.ship_to);\r\n      }\r\n    }\r\n    msg += '</div>';\r\n\r\n    bootbox.dialog({\r\n      message: msg,\r\n      title: \"单行价格输入\",\r\n      buttons: {\r\n        cancel: { label: \"取消\", className: \"btn-default\" },\r\n        main:   { label: \"确定\", className: \"btn-primary\", callback: ok }\r\n      }\r\n    });\r\n\r\n    function ok() {\r\n      var obj = {\r\n        bid : bill._id,\r\n        inv_no: bill.inv_no,\r\n        price: 0\r\n      };\r\n      var updated = false;\r\n      var price = -1;\r\n      if (action === 'COLLECTION') {\r\n        price = getPriceValue(bill.bill_no + '_' + bill.order);\r\n        if ((price >= 0 || price === -1) && bill.collection_price != price) {\r\n          bill.collection_price = price;\r\n          obj.price = price;\r\n          updated = true;\r\n        }\r\n      } else {\r\n        if (bill.veh_ves_name) {\r\n          id = bill.inv_no;\r\n          price = getPriceValue(id);\r\n          if ((price >= 0 || price === -1) && bill.price != price) {\r\n            bill.price = price;\r\n            obj.price = price;\r\n            updated = true;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (updated) {\r\n        ajaxRequestHandle('/price_input', 'POST', { data: [ obj ], act: action }, 'no_message', function() {\r\n          var numOfRow = tableBody.find(\"tr\").length;\r\n          for (var i = 0; i < numOfRow; ++i) {\r\n            var tr = getRowChildren(tableBody, i);\r\n            var b = getTableCellChildren(tr, 3).text();\r\n            var o = getTableCellChildren(tr, 2).text();\r\n            var no = getTableCellChildren(tr, 13).text();\r\n            if (bill.bill_no === b && getOrder(bill.order_no, bill.order_item_no) === o && bill.inv_no === no) {\r\n              updatePriceColumn(tr, bill);\r\n              break;\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  function buildBatchInputForCollection(bills) {\r\n    bootbox.dialog({\r\n      message: '<div class=\"row form-horizontal\"><div class=\"col-md-10\"><div class=\"form-group\"><label for=\"collection_00001\" class=\"control-label col-sm-4\">批量输入代收代付价格</label><div class=\"input-group col-sm-8\"><input id=\"collection_00001\" type=\"text\" name=\"collection_00001\" class=\"form-control\"></div></div></div></div>',\r\n      title: \"批量价格输入\",\r\n      buttons: {\r\n        cancel: { label: \"取消\", className: \"btn-default\" },\r\n        main:   { label: \"确定\", className: \"btn-primary\", callback: function() {\r\n          var price = getPriceValue(\"collection_00001\");\r\n          if (price >= 0 || price === -1) {\r\n            var obj = [];\r\n            bills.forEach(function(b) {\r\n              b.collection_price = price;\r\n              obj.push({\r\n                bid : b._id,\r\n                inv_no: b.inv_no,\r\n                price: price\r\n              })\r\n            });\r\n            ajaxRequestHandle('/price_input', 'POST', { data: obj, act: action }, 'no_message', function() {\r\n              tableBody.find('tr').each(function(idx) {\r\n              //$('#table-tbody tr').each(function(idx) {\r\n                updatePriceColumn($(this), curr_show_bills[idx]);\r\n              });\r\n            });\r\n          }\r\n        } }\r\n      }\r\n    });\r\n  }\r\n\r\n  function buildPriceBatchInputDialog(bills) {\r\n    var idata = {}; // { billname : { veh_ves_name: [] }  }\r\n    bills.forEach(function(bill) {\r\n      if (!isExist(idata[bill.billing_name])) {\r\n        idata[bill.billing_name] = [];\r\n      }\r\n\r\n      if (bill.veh_ves_name && bill.ship_to) {\r\n        var vv2dest = bill.veh_ves_name + '-' + bill.ship_to;\r\n        if (idata[bill.billing_name].indexOf(vv2dest) < 0) {\r\n          idata[bill.billing_name].push(vv2dest);\r\n        }\r\n      }\r\n    });\r\n\r\n    var msg = '<div class=\"row form-horizontal\">';\r\n    var str = '<div class=\"form-group\"><label for=\"{0}\" class=\"control-label col-sm-4\">{1}</label><div class=\"input-group col-sm-8\"><input id=\"{2}\" type=\"text\" name=\"{3}\" class=\"form-control\"><span style=\"font-size: 11px\">目的地: {4}</span></div></div>';\r\n    var id = \"\";\r\n    for (var name in idata) {\r\n      if (idata.hasOwnProperty(name) && idata[name].length) {\r\n        var html = '<div class=\"col-md-10\"><label>' + name + '</label>';\r\n        idata[name].forEach(function(item) {\r\n          var temp = item.split('-');\r\n          id = name.replace(/[\\s\\(\\)#]+/g, '') + '__' + item.replace(/[\\s\\(\\)#]+/g, \"999\");\r\n          html += str.format(id, temp[0], id, id, temp[1]);\r\n        });\r\n        msg += html + '</div>';\r\n      }\r\n    }\r\n    msg += '</div>';\r\n\r\n    bootbox.dialog({\r\n      message: msg,\r\n      title: \"批量输入价格\",\r\n      buttons: {\r\n        cancel: { label: \"取消\", className: \"btn-default\", callback: function() { }},\r\n        main:   { label: \"确定\", className: \"btn-primary\", callback: ok }\r\n      }\r\n    });\r\n\r\n    function ok() {\r\n      var id = \"\";\r\n      var idxList = [];\r\n      for (var name in idata) {\r\n        if (idata.hasOwnProperty(name)) {\r\n          idata[name].forEach(function (item) {\r\n            var temp = item.split('-');\r\n            id = name.replace(/[\\s\\(\\)#]+/g, '') + '__' + item.replace(/[\\s\\(\\)#]+/g, \"999\");\r\n            var price = getPriceValue(id);\r\n            if (price >= 0 || price === -1) {\r\n              $.each(bills, function (index, b) {\r\n                if (b.billing_name === name && b.veh_ves_name === temp[0] && b.ship_to === temp[1]) {\r\n                  b.price = price;\r\n                  if (idxList.indexOf(index) < 0) {\r\n                    idxList.push(index);\r\n                  }\r\n                }\r\n              });\r\n            }\r\n          });\r\n        }\r\n      }\r\n\r\n      if (idxList.length) {\r\n        var obj = [];\r\n        idxList.forEach(function(idx) {\r\n          obj.push({\r\n            bid : bills[idx]._id,\r\n            inv_no: bills[idx].inv_no,\r\n            price: bills[idx].price\r\n          });\r\n        });\r\n        ajaxRequestHandle('/price_input', 'POST', { data: obj, act: action }, 'no_message', function() {\r\n          tableBody.find('tr').each(function(idx) {\r\n          //$('#table-tbody tr').each(function(idx) {\r\n            updatePriceColumn($(this), curr_show_bills[idx]);\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  function getPriceValue(id) {\r\n    var jqId = '#' + id;\r\n    var v = $(jqId).val();\r\n    if (v) {\r\n      var value = parseFloatHTML($(jqId).val());\r\n      if (isNaN(value) || value == 0) {\r\n        return 0;\r\n      } else {\r\n        return value;\r\n      }\r\n    } else {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  function resetTableRow() {\r\n    tableBody.empty();\r\n    selected_bills = [];\r\n    curr_show_bills = [];\r\n    var html_text = [];\r\n    curr_bills.forEach(function (bill) {\r\n      if (action === 'CUSTOMER') {\r\n        if (showNonSettle) {\r\n          if (bill.price === -1) {\r\n            html_text.push(makeTableBodyTr(bill));\r\n            curr_show_bills.push(bill);\r\n          }\r\n        }\r\n        else {\r\n          if ((bill.inv_settle_flag & CUSTOMER_SETTLE_FLAG) != CUSTOMER_SETTLE_FLAG && bill.price >= 0) {\r\n            html_text.push(makeTableBodyTr(bill));\r\n            curr_show_bills.push(bill);\r\n          }\r\n        }\r\n      } else if (action === \"COLLECTION\") {\r\n        if (showNonSettle) {\r\n          if (bill.collection_price === -1) {\r\n            html_text.push(makeTableBodyTr(bill));\r\n            curr_show_bills.push(bill);\r\n          }\r\n        }\r\n        else {\r\n          if ((bill.inv_settle_flag & COLLECTION_SETTLE_FLAG) != COLLECTION_SETTLE_FLAG && bill.collection_price >= 0) {\r\n            html_text.push(makeTableBodyTr(bill));\r\n            curr_show_bills.push(bill);\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    tableBody.append(html_text.join('\\n'));\r\n\r\n    //$('#lb-total-weight').text(getStrValue(totalWeight));\r\n    //$('#lb-total-num').text(getStrValue(totalNumber));\r\n    //$('#curr-bills-number').text(tableBody.find(\"tr\").length);\r\n\r\n    $('#select-all').prop(\"checked\", false);\r\n    enableButtons();\r\n\r\n    tableBody.find('tr').on('click', function () {\r\n      selectRow($(this), true);\r\n    });\r\n\r\n    $('.select-bill').on('click', function(e) {\r\n      e.stopImmediatePropagation();\r\n      selectRow($(this).closest('tr'), false);\r\n    });\r\n\r\n//    $('[data-toggle=\"popover\"]').popover({ trigger: \"hover\", html: true, placement: \"bottom\" });\r\n  }\r\n\r\n  function selectRow(me, needUpdateCheckbox) {\r\n    var b = curr_show_bills[me.index()];\r\n    var found = false;\r\n    for (var i = 0; i < selected_bills.length; ++i) {\r\n      if (sameBill(selected_bills[i], b) && b.inv_no === selected_bills[i].inv_no && b.veh_ves_name === selected_bills[i].veh_ves_name) {\r\n        selected_bills.remove(i);\r\n        found = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (found) {\r\n      me.removeClass('invoice-highlighted');\r\n    } else {\r\n      selected_bills.push(b);\r\n      me.addClass('invoice-highlighted');\r\n    }\r\n\r\n    if (needUpdateCheckbox) {\r\n      me.find('input[type=\"checkbox\"]').prop(\"checked\", !found);\r\n    }\r\n\r\n    $('#select-all').prop(\"checked\", selected_bills.length === tableBody.find(\"tr\").length);\r\n    enableButtons();\r\n    showSelectedTotalValue();\r\n  }\r\n\r\n  function showSelectedTotalValue() {\r\n    var selectedTotalNumber = 0;\r\n    var selectedTotalWeight = 0;\r\n    selected_bills.forEach(function (sb) {\r\n      selectedTotalNumber += sb.send_num; // priceInfoObj.totalNumber;\r\n      selectedTotalWeight += sb.send_weight; // bill.total_weight;\r\n    });\r\n\r\n    if (selectedTotalNumber > 0) {\r\n      showHtmlElement($('#lb-selected-group'), true);\r\n      setElementValue($('#lb-selected-total-num'), getStrValue(selectedTotalNumber));\r\n      setElementValue($('#lb-selected-total-weight'), getStrValue(selectedTotalWeight));\r\n    } else {\r\n      showHtmlElement($('#lb-selected-group'), false);\r\n    }\r\n  }\r\n\r\n  function getState(bill) {\r\n    var statusStr = \"\";\r\n    if (isEmpty(bill.inv_settle_flag) || bill.inv_settle_flag === 0) {\r\n      if (bill.price === -1 && bill.collection_price === -1) {\r\n        statusStr = getStrByStatus(\"客户,代收不需结算\", bill.status);\r\n      } else if (bill.price === -1) {\r\n        statusStr = getStrByStatus(\"客户不需结算\", bill.status);\r\n      } else if (bill.collection_price === -1) {\r\n        statusStr = getStrByStatus(\"代收不需结算\", bill.status);\r\n      } else {\r\n        statusStr = getStrByStatus(\"未结算\", bill.status);\r\n      }\r\n    } else {\r\n      var statusText = [];\r\n      if ((bill.inv_settle_flag & CUSTOMER_SETTLE_FLAG) === CUSTOMER_SETTLE_FLAG) {\r\n        statusText.push(\"客户\");\r\n      }\r\n      if ((bill.inv_settle_flag & COLLECTION_SETTLE_FLAG) === COLLECTION_SETTLE_FLAG) {\r\n        statusText.push(\"代收付\");\r\n      }\r\n      statusStr = getStrByStatus(statusText.join(',') + '已结算', bill.status);\r\n    }\r\n\r\n    return statusStr;\r\n  }\r\n\r\n  function makeTableBodyTr(bill) {\r\n    var trHtml = '<tr><td align=\"center\"><input class=\"select-bill\" type=\"checkbox\"></td>';\r\n\r\n    //totalNumber += bill.send_num; // priceInfoObj.totalNumber;\r\n    //totalWeight += bill.send_weight; // bill.total_weight;\r\n\r\n    var priceText = getPriceText(action === \"CUSTOMER\" ? bill.price : bill.collection_price);\r\n    var name = (bill.ship_customer ? (bill.billing_name + \"/\" + bill.ship_customer) : bill.billing_name);\r\n\r\n    var remark = '';\r\n    if (bill.width < 3000 && bill.len < 13500) {\r\n      remark = '正常';\r\n    } else if ((bill.width >= 3000 && bill.width < 3300) || (bill.len >= 13500 && bill.len < 16500)) {\r\n      remark = '超长宽';\r\n    } else if (bill.width >= 3300 || bill.len >= 16500) {\r\n      remark = '特长宽';\r\n    }\r\n\r\n    trHtml += '<td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td><td>{6}</td><td>{7}</td><td>{8}</td><td>{9}</td><td>{10}</td><td>{11}</td><td>{12}</td><td>{13}</td></tr>';\r\n    return trHtml.format(getState(bill), getOrder(bill.order_no, bill.order_item_no), bill.bill_no,\r\n      name, bill.veh_ves_name, bill.ship_to, priceText,\r\n      bill.send_num > 0 ? bill.send_num : '', getStrValue(bill.send_weight),\r\n      bill.ship_warehouse ? bill.ship_warehouse : '', date2Str(bill.inv_ship_date), bill.inv_shipper ? bill.inv_shipper : '', bill.inv_no, remark);\r\n  }\r\n\r\n  elementEventRegister(btnExport, 'click', function() {\r\n    var html_text = [];\r\n    curr_show_bills.forEach(function (bill) {\r\n      var priceText = getPriceText(action === \"CUSTOMER\" ? bill.price : bill.collection_price);\r\n      var name = (bill.ship_customer ? (bill.billing_name + \"/\" + bill.ship_customer) : bill.billing_name);\r\n\r\n      var remark = '';\r\n      if (bill.width < 3000 && bill.len < 13500) {\r\n        remark = '正常';\r\n      } else if ((bill.width >= 3000 && bill.width < 3300) || (bill.len >= 13500 && bill.len < 16500)) {\r\n        remark = '超长宽';\r\n      } else if (bill.width >= 3300 || bill.len >= 16500) {\r\n        remark = '特长宽';\r\n      }\r\n\r\n      var trHtml = '<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td><td>{6}</td><td>{7}</td><td>{8}</td><td>{9}</td><td>{10}</td><td>{11}</td><td>{12}</td><td>{13}</td></tr>';\r\n      trHtml.format(getState(bill), getOrder(bill.order_no, bill.order_item_no), bill.bill_no,\r\n        name, bill.veh_ves_name, bill.ship_to, priceText,\r\n        bill.send_num > 0 ? bill.send_num : '', getStrValue(bill.send_weight),\r\n        bill.ship_warehouse ? bill.ship_warehouse : '', date2Str(bill.inv_ship_date), bill.inv_shipper ? bill.inv_shipper : '', bill.inv_no, remark);\r\n\r\n      html_text.push(trHtml);\r\n    });\r\n\r\n    tableToExcel(html_text.join('\\n'), \"data\");\r\n  });\r\n\r\n  var showFilter = false;\r\n  var acquireVehicles = false;\r\n  elementEventRegister(btnFilter, 'click', function() {\r\n    $('#filter-ui').toggle();\r\n    showFilter = !showFilter;\r\n    if (showFilter && !acquireVehicles) {\r\n      $.get('/settle_vehicle_list', { }, function (data) {\r\n        var result = JSON.parse(data);\r\n        qFilter.setAllVehicles(result.vehicles);\r\n        acquireVehicles = true;\r\n      })\r\n    }\r\n  });\r\n\r\n  elementEventRegister($('#show-data'), 'click', function() {\r\n    resetTableRow();\r\n    showHtmlElement($('#lb-selected-group'), false);\r\n  });\r\n\r\n  function filterData(needUpdateDbData, emptyDbData) {\r\n    if (needUpdateDbData) {\r\n      $('body').css({'cursor':'wait'});\r\n      var obj = qFilter.getQueryParams();\r\n      $.get('/get_invoices_bill', obj, function (data) {\r\n        var result = jQuery.parseJSON(data);\r\n        dbBills = [];\r\n        if (result.ok) {\r\n          dbBills = sortByKey(result.bills, \"inv_ship_date\", \"DSC\");\r\n        }\r\n        curr_bills = qFilter.updateOptions(dbBills, false);\r\n        showHintText();\r\n        $('body').css({'cursor':'default'});\r\n      });\r\n    } else {\r\n      if (emptyDbData) {\r\n        dbBills = [];\r\n      }\r\n      curr_bills = qFilter.updateOptions(dbBills, emptyDbData);\r\n      showHintText();\r\n    }\r\n  }\r\n\r\n  function showHintText() {\r\n    tableBody.empty();\r\n    selected_bills = [];\r\n    curr_show_bills = [];\r\n    var totalNumber = 0;\r\n    var totalWeight = 0;\r\n    var num = 0;\r\n    var price = 0;\r\n    if (action === 'CUSTOMER') {\r\n      curr_bills.forEach(function (bill) {\r\n        if (showNonSettle) {\r\n          if (bill.price === -1) {\r\n            totalNumber += bill.send_num;\r\n            totalWeight += bill.send_weight;\r\n            ++num;\r\n          }\r\n        }\r\n        else {\r\n          //console.log(bill);\r\n          if ((bill.inv_settle_flag & CUSTOMER_SETTLE_FLAG) != CUSTOMER_SETTLE_FLAG && bill.price >= 0) {\r\n            totalNumber += bill.send_num;\r\n            totalWeight += bill.send_weight;\r\n            ++num;\r\n            price += bill.price * bill.send_weight;\r\n          }\r\n        }\r\n      });\r\n    } else if (action === \"COLLECTION\") {\r\n      curr_bills.forEach(function (bill) {\r\n        if (showNonSettle) {\r\n          if (bill.collection_price === -1) {\r\n            totalNumber += bill.send_num;\r\n            totalWeight += bill.send_weight;\r\n            ++num;\r\n          }\r\n        }\r\n        else {\r\n          if ((bill.inv_settle_flag & COLLECTION_SETTLE_FLAG) != COLLECTION_SETTLE_FLAG && bill.collection_price >= 0) {\r\n            totalNumber += bill.send_num;\r\n            totalWeight += bill.send_weight;\r\n            ++num;\r\n            price += bill.collection_price * bill.send_weight;\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    $('#lb-total-amount').text(getStrValue(price));\r\n    $('#lb-total-weight').text(getStrValue(totalWeight));\r\n    $('#lb-total-num').text(getStrValue(totalNumber));\r\n    $('#curr-bills-number').text(num);\r\n  }\r\n});\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n///////////////////////////////////////////////////////////////////////////////\r\nvar QueryFilterD = function(options, options_2, action, filter) {\r\n  this.currSelected = 0;\r\n  var self = this;\r\n\r\n  this.uiElems = {\r\n    sBfOrder : new FilterElementD($('#bf-order-no'), [], false, true, function() {\r\n      self.currSelected = 2;\r\n      filter(false, self.isAllEmpty());\r\n    }),\r\n\r\n    sBfBillName :  $('#bf-bill-name'),\r\n    sBfDest :      $('#bf-destination'),\r\n    sBfVehicle :   $('#bf-vehicle'),\r\n    startDateGrp : $('#start-date-grp'),\r\n    endDateGrp :   $('#end-date-grp'),\r\n    iStartDate :   $('#start-date'),\r\n    iEndDate :     $('#end-date'),\r\n    sBfVehType :   $('#bf-vehtype'),\r\n\r\n    sBfBillNo: new FilterElementD($('#bf-bill-no'), [], false, true, function() {\r\n      self.currSelected = 6;\r\n      filter(false, self.isAllEmpty());\r\n    })\r\n  };\r\n\r\n  this.options = options;\r\n  this.options_2 = options_2;\r\n  this.action = action;\r\n  this.selectedVeh = [];\r\n  this.selectedDest = [];\r\n  this.veh_list = null;\r\n  this.allVehicles = null;\r\n  this.veh_type = 0; // 0: both, 1: che, 2: chuan\r\n\r\n  if (action === \"CUSTOMER\") {\r\n    initSelect(this.uiElems.sBfBillName, options.nameList, true);\r\n    initSelect(this.uiElems.sBfVehicle, options.vehList, false);\r\n    initSelect(this.uiElems.sBfDest, options.destList, false);\r\n    this.veh_list = options.vehList;\r\n  }\r\n  else if (action === \"COLLECTION\") {\r\n    initSelect(this.uiElems.sBfBillName, options_2.nameList, true);\r\n    initSelect(this.uiElems.sBfVehicle, options_2.vehList, false);\r\n    initSelect(this.uiElems.sBfDest, options_2.destList, false);\r\n    this.veh_list = options_2.vehList;\r\n  }\r\n\r\n  this.uiElems.sBfBillName.select2();\r\n  this.uiElems.sBfVehicle.select2();\r\n  this.uiElems.sBfDest.select2();\r\n\r\n  this.eDate = moment();\r\n  this.sDate = moment().subtract(1, 'months');\r\n  var startGrp = self.uiElems.startDateGrp.datetimepicker(getDateTimePickerOptions());\r\n  var endGrp = self.uiElems.endDateGrp.datetimepicker(getDateTimePickerOptions());\r\n  this.uiElems.endDateGrp.data(\"DateTimePicker\").setDate(this.eDate);\r\n  this.uiElems.startDateGrp.data(\"DateTimePicker\").setDate(this.sDate);\r\n\r\n  this._selectFliterFunc = function(which, filter) {\r\n    this.currSelected = which;\r\n    if (this.isAllEmpty()) {\r\n      filter(false, true);       // return to initial state\r\n    }\r\n    else {\r\n      filter(true, false);\r\n    }\r\n  };\r\n\r\n  this._dateFilterFunc = function(isStart, isEnd, filter) {\r\n    var d1 = this.uiElems.iStartDate.val();\r\n    var d2 = this.uiElems.iEndDate.val();\r\n    var b = false;\r\n    if (isStart && isEnd) {\r\n      b = !isEmpty(d1) && !isEmpty(d2);\r\n    } else if (isStart) {\r\n      b = isEmpty(this.uiElems.iStartDate.val());\r\n    } else if (isEnd) {\r\n      b = isEmpty(this.uiElems.iEndDate.val());\r\n    }\r\n\r\n    if (b) {\r\n      this.currSelected = 5;\r\n      filter(true, false);\r\n    }\r\n  };\r\n\r\n  self.uiElems.sBfBillName.on('change', function() { self._selectFliterFunc(1, filter); });\r\n\r\n  self.uiElems.sBfVehicle.on('change', function(e) {\r\n    self.selectedVeh = this.value;\r\n    self._selectFliterFunc(3, filter);\r\n  });\r\n\r\n  self.uiElems.sBfDest.on('change', function(e) {\r\n    self.selectedDest = this.value;\r\n    self._selectFliterFunc(4, filter);\r\n  });\r\n\r\n  self.uiElems.sBfVehType.on('change', function(e) {\r\n    var t = this.value;\r\n    if (t === '车') {\r\n      self.veh_type = 1;\r\n    } else if (t === '船') {\r\n      self.veh_type = 2;\r\n    } else {\r\n      self.veh_type = 0;\r\n    }\r\n\r\n    if (self.veh_type == 1) {\r\n      var vehList = [];\r\n      self.allVehicles.forEach(function(vs) {\r\n        for (var i = 0; i < self.veh_list.length; ++i) {\r\n          if (self.veh_list[i] === vs.name && vs.veh_type === '车') {\r\n            vehList.push(self.veh_list[i]);\r\n            break;\r\n          }\r\n        }\r\n      })\r\n      initSelect(self.uiElems.sBfVehicle, vehList, false);\r\n    } else if (self.veh_type === 2) {\r\n      var vehList = [];\r\n      self.allVehicles.forEach(function(vs) {\r\n        for (var i = 0; i < self.veh_list.length; ++i) {\r\n          if (self.veh_list[i] === vs.name && vs.veh_type === '船') {\r\n            vehList.push(self.veh_list[i]);\r\n            break;\r\n          }\r\n        }\r\n      });\r\n      initSelect(self.uiElems.sBfVehicle, vehList, false);\r\n    } else {\r\n      initSelect(self.uiElems.sBfVehicle, self.veh_list, false);\r\n    }\r\n  });\r\n\r\n  startGrp.on('dp.change', function(e) {\r\n    e.preventDefault();\r\n    e.stopImmediatePropagation();\r\n    self.sDate = e.date.startOf('day');\r\n    self.uiElems.endDateGrp.data(\"DateTimePicker\").setMinDate(e.date);\r\n    self._dateFilterFunc(true, true, filter);\r\n  });\r\n  endGrp.on('dp.change', function(e) {\r\n    e.preventDefault();\r\n    e.stopImmediatePropagation();\r\n    self.eDate = e.date.endOf('day');\r\n    self.uiElems.startDateGrp.data(\"DateTimePicker\").setMaxDate(e.date);\r\n    self._dateFilterFunc(true, true, filter);\r\n  });\r\n  self.uiElems.iStartDate.on('change', function(e) {\r\n    e.stopImmediatePropagation();\r\n    self._dateFilterFunc(true, false, filter);\r\n  });\r\n  self.uiElems.iEndDate.on('change', function(e) {\r\n    e.stopImmediatePropagation();\r\n    self._dateFilterFunc(false, true, filter);\r\n  });\r\n\r\n};\r\n\r\nQueryFilterD.prototype.setAllVehicles = function(vehicles) {\r\n  this.allVehicles = vehicles;\r\n};\r\n\r\nQueryFilterD.prototype.getQueryParams = function() {\r\n  var name = this.uiElems.sBfBillName.val();\r\n  var d1 = this.uiElems.iStartDate.val();\r\n  var d2 = this.uiElems.iEndDate.val();\r\n  var b = !isEmpty(d1) && !isEmpty(d2);\r\n\r\n  return {\r\n    fName: name ? [ name ] : null,\r\n    fVeh: this.selectedVeh,\r\n    fDest: this.selectedDest,\r\n    fOrder: null, fBno: null,\r\n    fDate1: b ? this.sDate.toISOString() : null,\r\n    fDate2: b ? this.eDate.toISOString() : null,\r\n    fType: \"invoice-first\"\r\n  };\r\n};\r\n\r\nQueryFilterD.prototype.isAllEmpty = function() {\r\n  var order = this.uiElems.sBfOrder.selected;\r\n  var bno = this.uiElems.sBfBillNo.selected;\r\n  var name = getSelectValue(this.uiElems.sBfBillName);\r\n  var d1 = this.uiElems.iStartDate.val();\r\n  var d2 = this.uiElems.iEndDate.val();\r\n\r\n  return order.length === 0 && bno.length === 0 && this.selectedVeh.length === 0 && this.selectedDest.length === 0 &&\r\n    isEmpty(name) && isEmpty(d1) && isEmpty(d2);\r\n};\r\n\r\nQueryFilterD.prototype.updateOptions = function(bills, reset) {\r\n  var order = this.uiElems.sBfOrder.selected;\r\n  var billNo = this.uiElems.sBfBillNo.selected;\r\n  var name = getSelectValue(this.uiElems.sBfBillName);\r\n  var nOptions = { orderList: [], vehList: [], destList: [], billNoList: [] };\r\n  var visibleBills = [];\r\n  if (reset) {\r\n    if (this.action === \"CUSTOMER\") {\r\n      nOptions = this.options;\r\n    } else {\r\n      nOptions = this.options_2;\r\n    }\r\n    visibleBills = bills;\r\n    bills.forEach(function (bill) {\r\n      if (bill.ship_to && nOptions.destList.indexOf(bill.ship_to) < 0) {\r\n        nOptions.destList.push(bill.ship_to);\r\n      }\r\n    });\r\n    nOptions.destList = sort_pinyin(nOptions.destList);\r\n  }\r\n  else {\r\n    var vehs = this.selectedVeh;\r\n    var ds = this.selectedDest;\r\n    var act = this.action;\r\n\r\n    bills.forEach(function (bill) {\r\n      var b1 = !order.length || (order.indexOf(bill.order_no) >= 0);\r\n      var b2 = vehs.length === 0 || (vehs.indexOf(bill.veh_ves_name) >= 0);\r\n      var b3 = ds.length === 0 || (ds.indexOf(bill.ship_to) >= 0);\r\n      var b4 = !name || name === bill.billing_name;\r\n      var b6 = !billNo.length || (billNo.indexOf(bill.bill_no) >= 0);\r\n\r\n      if (b2 && b3 && b4) {\r\n        if (act === 'CUSTOMER') {\r\n          if ((bill.inv_settle_flag & 1) !== 1) {\r\n            if (nOptions.orderList.indexOf(bill.order_no) < 0) {\r\n              nOptions.orderList.push(bill.order_no);\r\n            }\r\n            if (nOptions.billNoList.indexOf(bill.bill_no) < 0) {\r\n              nOptions.billNoList.push(bill.bill_no);\r\n            }\r\n          }\r\n        } else {\r\n          if ((bill.inv_settle_flag & 2) !== 2) {\r\n            if (nOptions.orderList.indexOf(bill.order_no) < 0) {\r\n              nOptions.orderList.push(bill.order_no);\r\n            }\r\n            if (nOptions.billNoList.indexOf(bill.bill_no) < 0) {\r\n              nOptions.billNoList.push(bill.bill_no);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (b1 && b6) {\r\n          if (bill.veh_ves_name && nOptions.vehList.indexOf(bill.veh_ves_name) < 0) {\r\n            nOptions.vehList.push(bill.veh_ves_name);\r\n          }\r\n          if (bill.ship_to && nOptions.destList.indexOf(bill.ship_to) < 0) {\r\n            nOptions.destList.push(bill.ship_to);\r\n          }\r\n          visibleBills.push(bill);\r\n        }\r\n      }\r\n    });\r\n\r\n    nOptions.destList = sort_pinyin(nOptions.destList);\r\n    nOptions.orderList.sort();\r\n    nOptions.billNoList = sort_pinyin(nOptions.billNoList);\r\n    nOptions.vehList = sort_pinyin(nOptions.vehList);\r\n  }\r\n\r\n  vehList = nOptions.vehList;\r\n  /*\r\n  var vehList = [];\r\n  if (this.veh_type == 1) {\r\n    this.allVehicles.forEach(function(vs) {\r\n      for (var i = 0; i < nOptions.vehList.length; ++i) {\r\n        if (nOptions.vehList[i] === vs.name && vs.veh_type === '车') {\r\n          vehList.push(nOptions.vehList[i]);\r\n          break;\r\n        }\r\n      }\r\n    })\r\n  } else if (this.veh_type === 2) {\r\n    this.allVehicles.forEach(function(vs) {\r\n      for (var i = 0; i < nOptions.vehList.length; ++i) {\r\n        if (nOptions.vehList[i] === vs.name && vs.veh_type === '船') {\r\n          vehList.push(nOptions.vehList[i]);\r\n          break;\r\n        }\r\n      }\r\n    })\r\n  } else {\r\n    vehList = nOptions.vehList;\r\n  }\r\n  */\r\n\r\n  if (this.currSelected === 2) {\r\n    this.uiElems.sBfBillNo.rebuild(nOptions.billNoList.sort(), billNo);\r\n    initSelect(this.uiElems.sBfVehicle, vehList, false);\r\n    this.uiElems.sBfVehicle.select2('val', this.selectedVeh);\r\n    initSelect(this.uiElems.sBfDest, nOptions.destList, false);\r\n    this.uiElems.sBfDest.select2('val', this.selectedDest);\r\n  }\r\n  else if (this.currSelected === 3) {\r\n    this.uiElems.sBfOrder.rebuild(nOptions.orderList.sort(), order);\r\n    this.uiElems.sBfBillNo.rebuild(nOptions.billNoList.sort(), billNo);\r\n    initSelect(this.uiElems.sBfDest, nOptions.destList, false);\r\n    this.uiElems.sBfDest.select2('val', this.selectedDest);\r\n  }\r\n  else if (this.currSelected === 4) {\r\n    this.uiElems.sBfOrder.rebuild(nOptions.orderList.sort(), order);\r\n    this.uiElems.sBfBillNo.rebuild(nOptions.billNoList.sort(), billNo);\r\n\r\n    initSelect(this.uiElems.sBfVehicle, vehList, false);\r\n    this.uiElems.sBfVehicle.select2('val', this.selectedVeh);\r\n  }\r\n  else if (this.currSelected === 6) {\r\n    initSelect(this.uiElems.sBfVehicle, vehList, false);\r\n    this.uiElems.sBfVehicle.select2('val', this.selectedVeh);\r\n    initSelect(this.uiElems.sBfDest, nOptions.destList, false);\r\n    this.uiElems.sBfDest.select2('val', this.selectedDest);\r\n    this.uiElems.sBfOrder.rebuild(nOptions.orderList.sort(), order);\r\n  }\r\n  else {\r\n    this.uiElems.sBfBillNo.rebuild(nOptions.billNoList.sort(), billNo);\r\n    this.uiElems.sBfOrder.rebuild(nOptions.orderList.sort(), order);\r\n    initSelect(this.uiElems.sBfVehicle, vehList, false);\r\n    this.uiElems.sBfVehicle.select2('val', this.selectedVeh);\r\n    initSelect(this.uiElems.sBfDest, nOptions.destList, false);\r\n    this.uiElems.sBfDest.select2('val', this.selectedDest);\r\n  }\r\n\r\n  return visibleBills;\r\n};\r\n\r\nQueryFilterD.prototype.reset = function(action) {\r\n  var name = getSelectValue(this.uiElems.sBfBillName);\r\n\r\n  if (action === \"CUSTOMER\") {\r\n    initSelect(this.uiElems.sBfBillName, this.options.nameList, true, name);\r\n    initSelect(this.uiElems.sBfVehicle, this.options.vehList, false);\r\n    initSelect(this.uiElems.sBfDest, this.options.destList, false);\r\n  } else if (action === \"COLLECTION\") {\r\n    initSelect(this.uiElems.sBfBillName, this.options_2.nameList, true, name);\r\n    initSelect(this.uiElems.sBfVehicle, this.options_2.vehList, false);\r\n    initSelect(this.uiElems.sBfDest, this.options_2.destList, false);\r\n  }\r\n\r\n  this.action = action;\r\n  this.uiElems.sBfBillName.select2(\"val\", name);\r\n  this.uiElems.sBfVehicle.select2(\"val\", this.selectedVeh);\r\n  this.uiElems.sBfDest.select2(\"val\", this.selectedDest);\r\n};"]}