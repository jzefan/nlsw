{"version":3,"sources":["user_mgt.js"],"names":["$","selectedUser","uname","uRealName","uTitle","uPhone","dataOk","pAdmin","pOperator","pAccount","pStatistics","pVesselRevenue","pCustRevenue","isAdmin","isOperator","isAccount","isStatistics","isCustRevenue","isVesselRevenue","tbody","dbUsers","local_data","action","title_name","title_name_cn","resetTable","val","prop","iCheck","on","adminCheck","okEnabled","adminUncheck","same_name","ext","name","realName","title","phone","setHtmlElementDisabled","isEmpty","needed","empty","forEach","u","append","format","userid","privilege","pri","getPrivlege","find","removeClass","me","this","user","index","undefined","addClass","same","i","length","text","v","ajaxRequestHandle","bootbox","alert","act","remove","modal","idx","indexOf","showHtmlElement","backdrop","keyboard","data","push","html","tableToExcel"],"mappings":"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","file":"user_mgt.js","sourcesContent":["/**\r\n * Created by ezefjia on 2015/4/27.\r\n */\r\n\r\n$(function () {\r\n  var uname = $('#u-name');\r\n  var uRealName = $('#u-real-name');\r\n  var uTitle = $('#employee-title');\r\n  var uPhone = $('#u-phone');\r\n  var dataOk = $('#data-btn-ok');\r\n\r\n  var pAdmin = $('#p-admin');\r\n  var pOperator = $('#p-operator');\r\n  var pAccount = $('#p-account');\r\n  var pStatistics = $('#p-statistics');\r\n  var pVesselRevenue = $('#p-vessel-revenue');\r\n  var pCustRevenue = $('#p-cust-revenue');\r\n  var isAdmin = false, isOperator = false, isAccount = false, isStatistics = false, isRevenue = false;\r\n  var isCustRevenue = false, isVesselRevenue = false;\r\n\r\n  var tbody = $('#data-tbody');\r\n  var dbUsers = local_data;\r\n  var action = '';\r\n  var selectedUser;\r\n  var title_name = [ 'ceo', 'mgr', 'operator', 'account', 'statistician'];\r\n  var title_name_cn = [ '董事长', '经理', '业务员', '会计', '统计员'];\r\n\r\n  resetTable();\r\n  dialogInit();\r\n\r\n  pAdmin.on('ifChecked', function() {\r\n    adminCheck(false);\r\n    okEnabled(false);\r\n  });\r\n  pAdmin.on('ifUnchecked', function() {\r\n    isAdmin = false;\r\n    okEnabled(false);\r\n  });\r\n\r\n  pOperator.on('ifChecked', function() {\r\n    isOperator = true;\r\n    adminUncheck();\r\n    okEnabled(false);\r\n  });\r\n  pOperator.on('ifUnchecked', function() {\r\n    isOperator = false;\r\n    okEnabled(false);\r\n  });\r\n\r\n  pAccount.on('ifChecked', function() {\r\n    isAccount = true;\r\n    adminUncheck();\r\n    okEnabled(false);\r\n  });\r\n  pAccount.on('ifUnchecked', function() {\r\n    isAccount = false;\r\n    okEnabled(false);\r\n  });\r\n\r\n  pStatistics.on('ifChecked', function() {\r\n    isStatistics = true;\r\n    adminUncheck();\r\n    okEnabled(false);\r\n  });\r\n  pStatistics.on('ifUnchecked', function() {\r\n    isStatistics = false;\r\n    okEnabled(false);\r\n  });\r\n\r\n  pCustRevenue.on('ifChecked', function() { isCustRevenue = true; adminUncheck(); okEnabled(false); });\r\n  pCustRevenue.on('ifUnchecked', function() { isCustRevenue = false; okEnabled(false); });\r\n\r\n  pVesselRevenue.on('ifChecked', function() { isVesselRevenue = true; adminUncheck(); okEnabled(false); });\r\n  pVesselRevenue.on('ifUnchecked', function() { isVesselRevenue = false; okEnabled(false); });\r\n\r\n  var same_name = $('#same-name');\r\n  uname.on('keyup paste', function() {\r\n    var same = false;\r\n    var name = uname.val();\r\n    if (!isEmpty(name)) {\r\n      for (var i = 0; i < dbUsers.length; ++i) {\r\n        if (name === dbUsers[i].userid) {\r\n          same_name.text('此用户名已注册!');\r\n          same = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!same) {\r\n      okEnabled(false);\r\n      same_name.text('');\r\n    }\r\n  });\r\n\r\n  uTitle.on('change', function() {\r\n    var v = uTitle.val();\r\n    if (v === 'ceo' || v === 'mgr') {\r\n      adminCheck(true);\r\n    } else {\r\n      adminUncheck();\r\n\r\n      if (v === 'operator') {\r\n        isOperator = true;\r\n        pOperator.iCheck('check');\r\n        pAccount.iCheck('uncheck');\r\n        pStatistics.iCheck('uncheck');\r\n      } else if (v === 'account') {\r\n        isAccount = true;\r\n        pOperator.iCheck('uncheck');\r\n        pAccount.iCheck('check');\r\n        pStatistics.iCheck('uncheck');\r\n      } else if (v === 'statistician') {\r\n        isStatistics = true;\r\n        pOperator.iCheck('uncheck');\r\n        pAccount.iCheck('uncheck');\r\n        pStatistics.iCheck('check');\r\n      }\r\n    }\r\n\r\n    okEnabled(false);\r\n  });\r\n\r\n  uRealName.on('keyup paste', function() {\r\n    if (action === 'modify') {\r\n      okEnabled(true);\r\n    }\r\n  });\r\n\r\n  uPhone.on('keyup paste', function() {\r\n    if (action === 'modify') {\r\n      okEnabled(true);\r\n    }\r\n  });\r\n\r\n  function getPrivlege(privilege) {\r\n    if (privilege === '11111111') {\r\n      return '管理';\r\n    } else if (privilege) {\r\n      var pri = '';\r\n      if (privilege[0] === '1') {\r\n        pri = '业务';\r\n      }\r\n      if (privilege[1] === '1') {\r\n        if (pri) {\r\n          pri += ',统计';\r\n        } else {\r\n          pri = '统计';\r\n        }\r\n      }\r\n      if (privilege[2] === '1') {\r\n        if (pri) {\r\n          pri += ',会计';\r\n        } else {\r\n          pri = '会计';\r\n        }\r\n      }\r\n      if (privilege[4] === '1') {\r\n        if (pri) {\r\n          pri += ',客户营业额';\r\n        } else {\r\n          pri = '客户营业额';\r\n        }\r\n      }\r\n      if (privilege[5] === '1') {\r\n        if (pri) {\r\n          pri += ',车船营业额';\r\n        } else {\r\n          pri = '车船营业额';\r\n        }\r\n      }\r\n\r\n      return pri;\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  function okEnabled(ext) {\r\n    var name = uname.val();\r\n    var realName = uRealName.val();\r\n    var title = uTitle.val();\r\n    var phone = uPhone.val();\r\n    if (ext) {\r\n      setHtmlElementDisabled(dataOk, (isEmpty(name) || isEmpty(title) || isEmpty(realName) || isEmpty(phone) || (!isAdmin && !isOperator && !isAccount && !isStatistics && !isCustRevenue && !isVesselRevenue)));\r\n    } else {\r\n      setHtmlElementDisabled(dataOk, (isEmpty(name) || isEmpty(title) || (!isAdmin && !isOperator && !isAccount && !isStatistics && !isCustRevenue && !isVesselRevenue)));\r\n    }\r\n  }\r\n\r\n  function adminCheck(needed) {\r\n    isAdmin = true;\r\n    if (needed) {\r\n      pAdmin.iCheck('check');\r\n    }\r\n\r\n    if (isOperator) {\r\n      isOperator = false;\r\n      pOperator.iCheck('uncheck');\r\n    }\r\n    if (isAccount) {\r\n      isAccount = false;\r\n      pAccount.iCheck('uncheck');\r\n    }\r\n    if (isStatistics) {\r\n      isStatistics = false;\r\n      pStatistics.iCheck('uncheck');\r\n    }\r\n    if (isCustRevenue) {\r\n      isCustRevenue = false;\r\n      pCustRevenue.iCheck('uncheck');\r\n    }\r\n    if (isVesselRevenue) {\r\n      isVesselRevenue = false;\r\n      pVesselRevenue.iCheck('uncheck');\r\n    }\r\n  }\r\n\r\n  function adminUncheck() {\r\n    if (isAdmin) {\r\n      isAdmin = false;\r\n      pAdmin.iCheck('uncheck');\r\n    }\r\n  }\r\n\r\n  function dialogInit() {\r\n    uname.val('');\r\n    uRealName.val('');\r\n    uPhone.val('');\r\n    uTitle.prop('selectedIndex', 0);\r\n    pAdmin.iCheck('uncheck');\r\n    pOperator.iCheck('uncheck');\r\n    pAccount.iCheck('uncheck');\r\n    pStatistics.iCheck('uncheck');\r\n    pCustRevenue.iCheck('uncheck');\r\n    pVesselRevenue.iCheck('uncheck');\r\n  }\r\n\r\n  function resetTable() {\r\n    tbody.empty();\r\n    var s = '<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td></tr>';\r\n    dbUsers.forEach(function(u) {\r\n      tbody.append(s.format(u.userid, u.name, u.title ? u.title : '', getPrivlege(u.privilege), u.phone));\r\n    });\r\n\r\n    tbody.find('tr').on('click', function () {\r\n      tbody.find('tr').removeClass('invoice-highlighted');\r\n      var me = $(this);\r\n      var user = dbUsers[me.index()];\r\n      if (selectedUser && user.userid === selectedUser.userid) {\r\n        selectedUser = undefined;\r\n      } else {\r\n        selectedUser = user;\r\n        me.addClass('invoice-highlighted');\r\n      }\r\n    });\r\n  }\r\n\r\n  $('#data-add').on('click', function() {\r\n    ajaxRequestHandle('/initial_settle_flag', 'POST', {}, 'update', function() {\r\n      bootbox.alert(\"OK\");\r\n    })\r\n    /*\r\n    action = 'add';\r\n    dialogInit();\r\n    $('#dialog-title').text('新建用户');\r\n    showHtmlElement($('#pwd-hint'), true);\r\n    setHtmlElementDisabled(uname, false);\r\n    $('#data-dialog').modal({ backdrop: 'static', keyboard: false}).modal('show');\r\n    */\r\n  });\r\n\r\n  $('#data-delete').on('click', function() {\r\n    if (selectedUser) {\r\n      ajaxRequestHandle('/user_mgr', 'POST', {act: 'delete', userid: selectedUser.userid}, '删除用户', function() {\r\n        for (var i = 0; i < dbUsers.length; ++i) {\r\n          if (dbUsers[i].userid === selectedUser.userid) {\r\n            dbUsers.remove(i);\r\n            selectedUser = undefined;\r\n            break;\r\n          }\r\n        }\r\n\r\n        resetTable();\r\n        $('#data-dialog').modal('hide');\r\n      });\r\n    } else {\r\n      bootbox.alert('请选择某一用户');\r\n    }\r\n  });\r\n\r\n  $('#data-modify').on('click', function() {\r\n    if (selectedUser) {\r\n      action = 'modify';\r\n      uname.val(selectedUser.userid);\r\n      uRealName.val(selectedUser.name? selectedUser.name : '');\r\n      uPhone.val(selectedUser.phone ? selectedUser.phone : '');\r\n\r\n      if (selectedUser.privilege === '11111111') {\r\n        adminCheck(true);\r\n      } else if (selectedUser.privilege) {\r\n        adminUncheck();\r\n\r\n        if (selectedUser.privilege[0] === '1') {\r\n          pOperator.iCheck('check');\r\n          isOperator = true;\r\n        }\r\n        if (selectedUser.privilege[1] === '1') {\r\n          pStatistics.iCheck('check');\r\n          isStatistics = true;\r\n        }\r\n        if (selectedUser.privilege[2] === '1') {\r\n          pAccount.iCheck('check');\r\n          isAccount = true;\r\n        }\r\n        //if (selectedUser.privilege[3] === '1') {\r\n        //  pRevenue.iCheck('check');\r\n        //  isRevenue = true;\r\n        //}\r\n        if (selectedUser.privilege[4] === '1') {\r\n          pCustRevenue.iCheck('check');\r\n          isCustRevenue = true;\r\n        }\r\n        if (selectedUser.privilege[5] === '1') {\r\n          pVesselRevenue.iCheck('check');\r\n          isVesselRevenue = true;\r\n        }\r\n      }\r\n\r\n      var idx = title_name_cn.indexOf(selectedUser.title);\r\n      uTitle.val( (idx>=0) ? title_name[idx] : '');\r\n\r\n      $('#dialog-title').text('修改用户');\r\n      showHtmlElement($('#pwd-hint'), false);\r\n      setHtmlElementDisabled(uname, true);\r\n      $('#data-dialog').modal({ backdrop: 'static', keyboard: false}).modal('show');\r\n    } else {\r\n      bootbox.alert('请选择某一用户');\r\n    }\r\n  });\r\n\r\n  dataOk.on('click', function() {\r\n    var name = uname.val();\r\n    var realName = uRealName.val();\r\n    var title = uTitle.val();\r\n    var phone = uPhone.val();\r\n    var privilege = '';\r\n\r\n    if (isAdmin) {\r\n      privilege = '11111111';\r\n    } else {\r\n      privilege += isOperator ? '1' : '0';\r\n      privilege += isStatistics ? '1' : '0';\r\n      privilege += isAccount ? '1' : '0';\r\n      privilege += isCustRevenue && isVesselRevenue ? '1' : '0';\r\n      privilege += isCustRevenue ? '1' : '0';\r\n      privilege += isVesselRevenue ? '1' : '0';\r\n      privilege += '00';\r\n    }\r\n\r\n    var idx = title_name.indexOf(title);\r\n    title = (idx >= 0) ? title_name_cn[idx] : '';\r\n\r\n    var data = {\r\n      userid: name,\r\n      name: isEmpty(realName) ? '' : realName,\r\n      title: title,\r\n      phone: isEmpty(phone) ? '' : phone,\r\n      privilege: privilege\r\n    };\r\n\r\n    ajaxRequestHandle('/user_mgr', 'POST', {act: action, data: data}, '新建用户', function() {\r\n      if (dbUsers) {\r\n        if (action === 'add') {\r\n          dbUsers.push(data);\r\n        } else {\r\n          for (var i = 0; i < dbUsers.length; ++i) {\r\n            if (name === dbUsers[i].userid) {\r\n              dbUsers[i].name = data.name;\r\n              dbUsers[i].title = title;\r\n              dbUsers[i].phone = phone;\r\n              dbUsers[i].privilege = privilege;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n        resetTable();\r\n      }\r\n\r\n      $('#data-dialog').modal('hide');\r\n    });\r\n  });\r\n\r\n  $('#data-export').on('click', function() {\r\n    var html = $('#data-table').html();\r\n    tableToExcel(html, 'data', '');\r\n  });\r\n});"]}