$(function(){var c,d=$("#u-name"),h=$("#u-real-name"),l=$("#employee-title"),u=$("#u-phone"),a=$("#data-btn-ok"),i=$("#p-admin"),n=$("#p-operator"),t=$("#p-account"),o=$("#p-statistics"),k=$("#p-vessel-revenue"),r=$("#p-cust-revenue"),f=!1,s=!1,p=!1,v=!1,m=!1,C=!1,g=$("#data-tbody"),y=local_data,b="",x=["ceo","mgr","operator","account","statistician"],E=["董事长","经理","业务员","会计","统计员"];T(),d.val(""),h.val(""),u.val(""),l.prop("selectedIndex",0),i.iCheck("uncheck"),n.iCheck("uncheck"),t.iCheck("uncheck"),o.iCheck("uncheck"),r.iCheck("uncheck"),k.iCheck("uncheck"),i.on("ifChecked",function(){U(!1),O(!1)}),i.on("ifUnchecked",function(){O(f=!1)}),n.on("ifChecked",function(){s=!0,_(),O(!1)}),n.on("ifUnchecked",function(){O(s=!1)}),t.on("ifChecked",function(){p=!0,_(),O(!1)}),t.on("ifUnchecked",function(){O(p=!1)}),o.on("ifChecked",function(){v=!0,_(),O(!1)}),o.on("ifUnchecked",function(){O(v=!1)}),r.on("ifChecked",function(){m=!0,_(),O(!1)}),r.on("ifUnchecked",function(){O(m=!1)}),k.on("ifChecked",function(){C=!0,_(),O(!1)}),k.on("ifUnchecked",function(){O(C=!1)});var H=$("#same-name");function O(e){var i=d.val(),c=h.val(),n=l.val(),t=u.val();e?setHtmlElementDisabled(a,isEmpty(i)||isEmpty(n)||isEmpty(c)||isEmpty(t)||!f&&!s&&!p&&!v&&!m&&!C):setHtmlElementDisabled(a,isEmpty(i)||isEmpty(n)||!f&&!s&&!p&&!v&&!m&&!C)}function U(e){f=!0,e&&i.iCheck("check"),s&&(s=!1,n.iCheck("uncheck")),p&&(p=!1,t.iCheck("uncheck")),v&&(v=!1,o.iCheck("uncheck")),m&&(m=!1,r.iCheck("uncheck")),C&&(C=!1,k.iCheck("uncheck"))}function _(){f&&(f=!1,i.iCheck("uncheck"))}function T(){g.empty();y.forEach(function(e){g.append("<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td></tr>".format(e.userid,e.name,e.title?e.title:"",function(e){if("11111111"===e)return"管理";if(e){var i="";return"1"===e[0]&&(i="业务"),"1"===e[1]&&(i?i+=",统计":i="统计"),"1"===e[2]&&(i?i+=",会计":i="会计"),"1"===e[4]&&(i?i+=",客户营业额":i="客户营业额"),"1"===e[5]&&(i?i+=",车船营业额":i="车船营业额"),i}return""}(e.privilege),e.phone))}),g.find("tr").on("click",function(){g.find("tr").removeClass("invoice-highlighted");var e=$(this),i=y[e.index()];c&&i.userid===c.userid?c=void 0:(c=i,e.addClass("invoice-highlighted"))})}d.on("keyup paste",function(){var e=!1,i=d.val();if(!isEmpty(i))for(var c=0;c<y.length;++c)if(i===y[c].userid){H.text("此用户名已注册!"),e=!0;break}e||(O(!1),H.text(""))}),l.on("change",function(){var e=l.val();"ceo"===e||"mgr"===e?U(!0):(_(),"operator"===e?(s=!0,n.iCheck("check"),t.iCheck("uncheck"),o.iCheck("uncheck")):"account"===e?(p=!0,n.iCheck("uncheck"),t.iCheck("check"),o.iCheck("uncheck")):"statistician"===e&&(v=!0,n.iCheck("uncheck"),t.iCheck("uncheck"),o.iCheck("check"))),O(!1)}),h.on("keyup paste",function(){"modify"===b&&O(!0)}),u.on("keyup paste",function(){"modify"===b&&O(!0)}),$("#data-add").on("click",function(){ajaxRequestHandle("/initial_settle_flag","POST",{},"update",function(){bootbox.alert("OK")})}),$("#data-delete").on("click",function(){c?ajaxRequestHandle("/user_mgr","POST",{act:"delete",userid:c.userid},"删除用户",function(){for(var e=0;e<y.length;++e)if(y[e].userid===c.userid){y.remove(e),c=void 0;break}T(),$("#data-dialog").modal("hide")}):bootbox.alert("请选择某一用户")}),$("#data-modify").on("click",function(){if(c){b="modify",d.val(c.userid),h.val(c.name?c.name:""),u.val(c.phone?c.phone:""),"11111111"===c.privilege?U(!0):c.privilege&&(_(),"1"===c.privilege[0]&&(n.iCheck("check"),s=!0),"1"===c.privilege[1]&&(o.iCheck("check"),v=!0),"1"===c.privilege[2]&&(t.iCheck("check"),p=!0),"1"===c.privilege[4]&&(r.iCheck("check"),m=!0),"1"===c.privilege[5]&&(k.iCheck("check"),C=!0));var e=E.indexOf(c.title);l.val(0<=e?x[e]:""),$("#dialog-title").text("修改用户"),showHtmlElement($("#pwd-hint"),!1),setHtmlElementDisabled(d,!0),$("#data-dialog").modal({backdrop:"static",keyboard:!1}).modal("show")}else bootbox.alert("请选择某一用户")}),a.on("click",function(){var i=d.val(),e=h.val(),c=l.val(),n=u.val(),t="";f?t="11111111":(t+=s?"1":"0",t+=v?"1":"0",t+=p?"1":"0",t+=m&&C?"1":"0",t+=m?"1":"0",t+=C?"1":"0",t+="00");var a=x.indexOf(c);c=0<=a?E[a]:"";var o={userid:i,name:isEmpty(e)?"":e,title:c,phone:isEmpty(n)?"":n,privilege:t};ajaxRequestHandle("/user_mgr","POST",{act:b,data:o},"新建用户",function(){if(y){if("add"===b)y.push(o);else for(var e=0;e<y.length;++e)if(i===y[e].userid){y[e].name=o.name,y[e].title=c,y[e].phone=n,y[e].privilege=t;break}T()}$("#data-dialog").modal("hide")})}),$("#data-export").on("click",function(){var e=$("#data-table").html();tableToExcel(e,"data","")})});
//# sourceMappingURL=user_mgt.js.map
