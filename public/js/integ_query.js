$(function(){"use strict";var l,r,i,s,o=local_data,_=$("#bf-customer"),t=$("#start-date-grp"),n=$("#end-date-grp"),h=$("#start-date"),c=$("#end-date"),u=$("#bf-bill-no"),d=$("#bf-order-no"),m=$("#table-tbody"),f=$("#table-thead"),e=$("#search-export"),a=$("#to-ship-vessel"),g=$("#show-not-sent"),p=[],b=sort_pinyin(o.vehicles),S=sort_pinyin(o.destination),v=sort_pinyin(getAllList(!1,o.company,"name")),w=new FilterElementD($("#bf-bill-name"),v,!0,!1,function(e){var l=[];e.forEach(function(e){for(var t=0,n=o.company.length;t<n;++t){var a=o.company[t];if(a.name===e){l.push.apply(l,a.customers);break}}}),initSelect(_,sort_pinyin(l),!0)}),k=new FilterElementD($("#bf-vehicle"),b,!1,!0,null),V=new FilterElementD($("#bf-destination"),S,!1,!0,null);$.extend($.tablesorter.defaults,{theme:"blue"}),$("#query-table").tablesorter({widgets:["stickyHeaders"]}),elementEventRegister($("#filter"),"click",function(){$("#filter-ui").toggle()}),elementEventRegister(e,"click",function(){tableToExcel($("#query-table").html(),"查询结果","综合查询"+date2Str(new Date)+".xls")}),elementEventRegister($("#account-checking-export"),"click",function(){if(p.length){for(var n="<table><tr><th>状态</th><th>订单号</th><th>提单号</th><th>开单名称</th><th>车船号</th><th>目的地</th><th>发运块数</th><th>发运重量</th><th>总块数</th><th>总重量</th><th>发货日期</th><th>发货人</th><th>运单号</th><th>发货仓库</th><th>牌号</th><th>厚</th><th>宽</th><th>长</th><th>尺寸</th><th>合同号</th><th>销售部门</th><th>创建日期</th><th>创建人</th><th>结算状态</th></tr>",a="<tr>",e=0,t=["状态","订单号","提单号","开单名称","车船号","目的地","发运块数","发运重量","总块数","总重量","发货日期","发货人","运单号","发货仓库","牌号","厚","宽","长","尺寸","合同号","销售部门","创建日期","创建人","结算状态"].length;e<t;++e)a+="<td>{"+e+"}</td>";if(a+="</tr>",D)p.forEach(function(e){var t=0<e.block_num?e.left_num*e.weight:e.left_num;n+=a.format(getStrByStatus(e.status,e.status),getOrder(e.order_no,e.order_item_no),e.bill_no,e.billing_name,"","",0,getStrValue(t),"","","",e.ship_warehouse?e.ship_warehouse:"",e.brand_no?e.brand_no:"",getStrValue(e.thickness),getStrValue(e.width),getStrValue(e.len),e.size_type,e.block_num,getStrValue(e.total_weight),e.contract_no?e.contract_no:"",e.sales_dep?e.sales_dep:"",date2Str(e.create_date),e.creater?e.creater:"","")});else{var l=null,r=!1;for(e=0,t=p.length;e<t;++e){var i=p[e],s="";0===i.settle_flag?s="未结算":1===i.settle_flag?s="客户结算":2===i.settle_flag?s="代收付结算":3===i.settle_flag&&(s="客户,代收付结算");var o=i.ship_customer?i.billing_name+"/"+i.ship_customer:i.billing_name;if(!(r=!!l&&sameBill(l,i))&&l&&0<l.left_num){var _=0<l.block_num?l.left_num*l.weight:l.left_num;n+=a.format(getStrByStatus(l.status,l.status),getOrder(l.order_no,l.order_item_no),l.bill_no,o,"","","0","0",l.block_num,getStrValue(_),"","","",l.ship_warehouse?l.ship_warehouse:"",l.brand_no?l.brand_no:"",getStrValue(l.thickness),getStrValue(l.width),getStrValue(l.len),l.size_type,l.contract_no?l.contract_no:"",l.sales_dep?l.sales_dep:"",date2Str(l.create_date),l.creater?l.creater:"",s)}var h=0;r||(h=0<i.block_num?i.left_num!==i.block_num?(i.block_num-i.left_num)*i.weight:i.total_weight:i.left_num!==i.total_weight?i.total_weight-i.left_num:i.total_weight),n+=a.format(getStrByStatus(i.status,i.status),getOrder(i.order_no,i.order_item_no),i.bill_no,o,i.veh_ves_name,i.ship_to,i.send_num,getStrValue(i.send_weight),i.block_num,getStrValue(h),date2Str(i.inv_ship_date),i.inv_shipper?i.inv_shipper:"",i.inv_no?i.inv_no:"",i.ship_warehouse?i.ship_warehouse:"",i.brand_no?i.brand_no:"",getStrValue(i.thickness),getStrValue(i.width),getStrValue(i.len),i.size_type,i.contract_no?i.contract_no:"",i.sales_dep?i.sales_dep:"",date2Str(i.create_date),i.creater?i.creater:"",s),l=i}}tableToExcel(n,"对账数据",date2Str(new Date)+".xls")}}),t.datetimepicker(getDateTimePickerOptions()).on("dp.change",function(e){i=e.date.startOf("day"),n.data("DateTimePicker").setMinDate(e.date)}),n.datetimepicker(getDateTimePickerOptions()).on("dp.change",function(e){s=e.date.endOf("day"),t.data("DateTimePicker").setMaxDate(e.date)});var y=!1;a.iCheck("uncheck"),a.on("ifChecked",function(){y=!0}),a.on("ifUnchecked",function(){y=!1});var D=!1;function E(){k.disabled(D),V.disabled(D),D?(a.iCheck("disable"),setHtmlElementDisabled(h,!0),setHtmlElementDisabled(c,!0),setHtmlElementDisabled(_,!0),$("#head-weight").text("未配发重量"),showHtmlElement($("#lb-send-num"),!1)):(a.iCheck("enable"),setHtmlElementDisabled(h,!1),setHtmlElementDisabled(c,!0),setHtmlElementDisabled(_,!1),$("#head-weight").text("发运重量"),showHtmlElement($("#lb-send-num"),!0))}function O(e){m.empty(),r=l=0;for(var a="<tr>",t=f.find("th").length,n=0;n<t;++n)a+="<td>{"+n+"}</td>";a+="</tr>",D?e.forEach(function(e){var t=0<e.block_num?e.left_num*e.weight:e.left_num;m.append(a.format("",getStrByStatus(e.status,e.status),getOrder(e.order_no,e.order_item_no),e.bill_no,e.billing_name,"","",0,getStrValue(t),"","","","","",e.ship_warehouse?e.ship_warehouse:"",e.brand_no?e.brand_no:"",getStrValue(e.thickness),getStrValue(e.width),getStrValue(e.len),e.size_type,e.block_num,getStrValue(e.total_weight),e.contract_no?e.contract_no:"",e.sales_dep?e.sales_dep:"",date2Str(e.create_date),e.creater?e.creater:"")),r+=t}):(e.forEach(function(e){var t="";0===e.inv_settle_flag?t=e.collection_price<0&&e.price<0?"客户,代收都不需要结算":e.collection_price<0?"客户未结算,代收不需要结算":"客户,代收都未结算":1===e.inv_settle_flag?t=e.collection_price<0?"客户已结算,代收不需要结算 - "+e.status_2:"客户已结算,代收未结算 - "+e.status_2:2===e.inv_settle_flag?t=e.price<0?"客户不需要结算,代收已结算 - "+e.status_2:"代收已结算,客户未结算 - "+e.status_2:3===e.inv_settle_flag&&(t="客户,代收付都已结算 - "+e.status_2);var n=e.ship_customer?e.billing_name+"/"+e.ship_customer:e.billing_name;m.append(a.format(t,getStrByStatus(e.status,e.status),getOrder(e.order_no,e.order_item_no),e.bill_no,n,e.veh_ves_name,e.ship_to,e.send_num,getStrValue(e.send_weight),getStrValue(e.price),getStrValue(e.veh_ves_price),date2Str(e.inv_ship_date),e.inv_shipper?e.inv_shipper:"",e.inv_no?e.inv_no:"",e.ship_warehouse?e.ship_warehouse:"",e.brand_no?e.brand_no:"",getStrValue(e.thickness),getStrValue(e.width),getStrValue(e.len),e.size_type,e.block_num,getStrValue(e.total_weight),e.contract_no?e.contract_no:"",e.sales_dep?e.sales_dep:"",date2Str(e.create_date),e.creater?e.creater:"")),l+=e.send_num,r+=e.send_weight}),$("#lb-total-num").text(getStrValue(l))),$("#lb-total-weight").text(getStrValue(r)),$("#curr-number").text(m.find("tr").length),$("#query-table").trigger("update")}g.iCheck("uncheck"),g.on("ifChecked",function(){D=!0,E()}),g.on("ifUnchecked",function(){D=!1,E()}),$("#query-ok").on("click",function(){var e=h.val(),t=c.val(),n=!isEmpty(e)&&!isEmpty(t),a={fName:w.selected,fVeh:k.selected,fDest:V.selected,fDate1:n?i.toISOString():null,fDate2:n?s.toISOString():null,fBno:u.val(),fOrder:d.val(),fType:"bill-first",fShowDestForVessel:y?1:0,fCustomerName:_.val(),fShowUnsend:0};if(D)a.fVeh=[],a.fDest=[],a.fShowDestForVessel=0,a.fCustomerName=null,a.fShowUnsend=1,a.fDate1=null,a.fDate2=null;else if(w.selectNone()&&k.selectNone()&&V.selectNone()&&!n&&!a.fBno&&!a.fOrder)return void O(p=[]);nlApp.setTitle("获取数据..."),nlApp.showPleaseWait(),$.get("/get_invoices_bill",a,function(e){p=[];var t=jQuery.parseJSON(e);t.ok?p=t.bills:(k.rebuild(b,null),V.rebuild(S,null)),O(p),nlApp.hidePleaseWait()})}),$("#adjust-data").on("click",function(){ajaxRequestHandle("/initial_settle_flag","POST",{},"纠正数据",null)})});
//# sourceMappingURL=integ_query.js.map
