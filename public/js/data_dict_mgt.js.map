{"version":3,"sources":["data_dict_mgt.js"],"names":["$","ldata","btnAdd","btnModify","btnDelete","btnOk","dataBody","selectedIdx","currentIdx","more","addressGroup","vehInput","dictName","vehCategory","addressInput","contactInput","phoneInput","veh_type","el_data_search","oper_object","local_data","undefined","local_operObject","append","makeOption","each","idx","row","name","select2","on","resetTable","this","value","setHtmlElementDisabled","tableBodyEventHandler","action","showIt","enabled","title","act","initElements","setElementValue","prop","showHtmlElement","val","customers","veh_category","unselected","iCheck","address","contact_name","phone","updateLable","modal","backdrop","keyboard","text","deleteData","route","data","msg","ajaxRequestHandle","remove","getData","temp","isEmpty","split","addData","push","modifyData","str","format","find","eq","html","filter","empty","length","indexOf","tr_click","e","index","me","currentTarget","parseInt","getTableCellChildren","el_data_input","allInput","allTextArea","filename","date2Str","Date","tableToExcel","elem","el_same_name","i","nameChanged","getElementValue","category","n"],"mappings":"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","file":"data_dict_mgt.js","sourcesContent":["$(function () {\r\n  var btnAdd = $('#data-add');\r\n  var btnModify = $('#data-modify');\r\n  var btnDelete = $('#data-delete');\r\n  var btnOk = $('#data-btn-ok');\r\n  var dataBody = $('#data-tbody');\r\n  var selectedIdx = -1;\r\n  var currentIdx = -1;\r\n\r\n  var more = $('#need-more');\r\n  var addressGroup = $('#address-group');\r\n  var vehInput = $('#veh-input');\r\n  var dictName = $('#dict_name');\r\n\r\n  var vehCategory = $('#veh-category');\r\n  var addressInput = $('#address');\r\n  var contactInput = $('#contact');\r\n  var phoneInput = $('#phone');\r\n\r\n  var veh_type = '车';\r\n  var el_data_search = $('#data-search');\r\n\r\n  var ldata;\r\n  var oper_object = '';\r\n  if ((typeof local_data != 'undefined') && undefined != local_data) {\r\n    ldata = local_data;\r\n    oper_object = local_operObject;\r\n\r\n    el_data_search.append(makeOption('所有记录'));\r\n    $.each(ldata, function (idx, row) {\r\n      el_data_search.append(makeOption(row.name));\r\n    });\r\n\r\n    el_data_search.select2();\r\n    el_data_search.select2('val', '');\r\n\r\n    el_data_search.on('change', function() {\r\n      resetTable(this.value);\r\n    })\r\n  }\r\n\r\n  setHtmlElementDisabled(btnModify, true);\r\n  setHtmlElementDisabled(btnDelete, true);\r\n  tableBodyEventHandler();\r\n\r\n  var action = '';\r\n  btnAdd.on('click', function() {\r\n    initElements(false);\r\n    if (oper_object != 'brand' && oper_object != 'sale_dep') {\r\n      if (oper_object === 'company') {\r\n        showHtmlElement($('#customer-group'), true);\r\n      } else {\r\n        showHtmlElement($('#customer-group'), false);\r\n      }\r\n      showHtmlElement(more, true);\r\n      if (oper_object === 'vehicle') {\r\n        showHtmlElement(addressGroup, false);\r\n        showHtmlElement(vehInput, true);\r\n      } else {\r\n        showHtmlElement(addressGroup, true);\r\n        showHtmlElement(vehInput, false);\r\n      }\r\n    } else {\r\n      showHtmlElement(more, false);\r\n    }\r\n\r\n    action = 'add';\r\n    updateLable('增加');\r\n    $('#data-dialog').modal({ backdrop: 'static', keyboard: false}).modal('show');\r\n  });\r\n\r\n  btnModify.on('click', function() {\r\n    showIt(false, '修改', 'modify');\r\n  });\r\n\r\n  btnDelete.on('click', function() {\r\n    showIt(true, '删除', 'delete');\r\n  });\r\n\r\n  $('#data-export').on('click', function() {\r\n    var html = $('#data-table').html();\r\n    var filename = \"download\";\r\n    if (oper_object == 'company') {\r\n      filename = \"开单名称\";\r\n    } else if (oper_object == 'vehicle') {\r\n      filename = \"车船号\";\r\n    } else if (oper_object == 'destination') {\r\n      filename = \"目的地\";\r\n    } else if (oper_object == 'warehouse') {\r\n      filename = \"仓库\";\r\n    } else if (oper_object == 'brand') {\r\n      filename = \"牌号\";\r\n    } else if (oper_object === 'sale_dep') {\r\n      filename = \"销售部门\";\r\n    }\r\n\r\n    filename += date2Str(new Date()) + \".xls\";\r\n    tableToExcel(html, 'data', filename);\r\n  });\r\n\r\n  $('#che').on('ifChecked', function() { veh_type = '车' }).on('ifUnchecked', function() { veh_type = '船' });\r\n\r\n  function showIt(enabled, title, act) {\r\n    if (currentIdx >= 0) {\r\n      var row = ldata[currentIdx];\r\n      initElements(enabled);\r\n      setElementValue(dictName, row.name);\r\n      dictName.prop('disabled', true);\r\n\r\n      if (oper_object === 'brand' || oper_object === 'sale_dep') {\r\n        showHtmlElement(more, false);\r\n      } else {\r\n        showHtmlElement(more, true);\r\n        if (oper_object === 'company') {\r\n          showHtmlElement($('#customer-group'), true);\r\n          $('#customers').val(row.customers);\r\n        } else {\r\n          showHtmlElement($('#customer-group'), false);\r\n        }\r\n        if (oper_object === 'vehicle') {\r\n          showHtmlElement(addressGroup, false);\r\n          showHtmlElement(vehInput, true);\r\n          if (row.veh_category) {\r\n            setElementValue(vehCategory, row.veh_category);\r\n          } else {\r\n            unselected(vehCategory);\r\n          }\r\n\r\n          if (row.veh_type === '车') {\r\n            $('#che').iCheck('check')\r\n          } else if (row.veh_type === '船') {\r\n            $('#chuan').iCheck('check');\r\n          } else {\r\n            $('#che').iCheck('uncheck');\r\n            $('#chuan').iCheck('uncheck')\r\n          }\r\n        } else {\r\n          showHtmlElement(addressGroup, true);\r\n          showHtmlElement(vehInput, false);\r\n          setElementValue(addressInput, row.address);\r\n        }\r\n\r\n        setElementValue(contactInput, row.contact_name);\r\n        setElementValue(phoneInput, row.phone);\r\n      }\r\n\r\n      action = act;\r\n      setHtmlElementDisabled(btnOk, false);\r\n      updateLable(title);\r\n      $('#data-dialog').modal({ backdrop: 'static', keyboard: false}).modal('show');\r\n    }\r\n  }\r\n\r\n  function nameChanged(elem) {\r\n    var el_same_name = $('#same-name');\r\n    el_same_name.text('');\r\n    var name = elem.val();\r\n    if (name) {\r\n      setHtmlElementDisabled(btnOk, false);\r\n      if (ldata) {\r\n        for (var i = 0; i < ldata.length; ++i) {\r\n          if (name === ldata[i].name) {\r\n            el_same_name.text('名称已存在!');\r\n            setHtmlElementDisabled(btnOk, true);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  dictName.on('keyup paste blur', function() {\r\n    nameChanged(dictName);\r\n  });\r\n\r\n  function updateLable(title) {\r\n    if (oper_object == 'company') {\r\n      $('#lbl-name').text('开单名称');\r\n      $('#dialog-title').text(title + '开单名称');\r\n    } else if (oper_object == 'vehicle') {\r\n      $('#lbl-name').text('车船号');\r\n      $('#dialog-title').text(title + '车船号');\r\n    } else if (oper_object == 'destination') {\r\n      $('#lbl-name').text('目的地');\r\n      $('#dialog-title').text(title + '目的地');\r\n    } else if (oper_object == 'warehouse') {\r\n      $('#lbl-name').text('仓库');\r\n      $('#dialog-title').text(title + '仓库');\r\n    } else if (oper_object == 'brand') {\r\n      $('#lbl-name').text('牌号');\r\n      $('#dialog-title').text(title + '牌号');\r\n    } else if (oper_object === 'sale_dep') {\r\n      $('#lbl-name').text('销售部门');\r\n      $('#dialog-title').text(title + '销售部门');\r\n    }\r\n  }\r\n\r\n  btnOk.on('click', function() {\r\n    if (action == 'add') {\r\n      if (oper_object == 'company') {\r\n        addData('/datamgt/company_add', '添加开单名称');\r\n      } else if (oper_object == 'vehicle') {\r\n        addData('/datamgt/vehicle_add', '添加车船号');\r\n      } else if (oper_object == 'warehouse') {\r\n        addData('/datamgt/warehouse_add', '添加仓库');\r\n      } else if (oper_object == 'destination') {\r\n        addData('/datamgt/destination_add', '添加目的地');\r\n      } else if (oper_object == 'brand') {\r\n        addData('/datamgt/brand_add', '添加牌号');\r\n      } else if (oper_object == 'sale_dep') {\r\n        addData('/datamgt/sale_dep_add', '添加销售部门');\r\n      }\r\n    } else if (action == 'modify') {\r\n      var row = ldata[currentIdx];\r\n      if (oper_object === 'brand' || oper_object === 'sale_dep') {\r\n\r\n      } else {\r\n        var contact_name = getElementValue(contactInput);\r\n        var phone = getElementValue(phoneInput);\r\n        if (oper_object === 'vehicle') {\r\n          var category = getElementValue(vehCategory);\r\n          if (contact_name != row.contact_name || phone != row.phone || veh_type != row.veh_type || category != row.veh_category) {\r\n            modifyData('/datamgt/vehicle_modify', '修改车船号');\r\n          }\r\n        } else {\r\n          var address = getElementValue(addressInput);\r\n          if (oper_object == 'company') {\r\n            modifyData('/datamgt/company_modify', '修改开单名称');\r\n          } else if (address != row.address || contact_name != row.contact_name || phone != row.phone) {\r\n            if (oper_object == 'warehouse') {\r\n              modifyData('/datamgt/warehouse_modify', '修改仓库');\r\n            } else if (oper_object == 'destination') {\r\n              modifyData('/datamgt/destination_modify', '修改目的地');\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } else if (action === 'delete') {\r\n      var n = ldata[currentIdx].name;\r\n      if (oper_object === 'company') {\r\n        deleteData('/datamgt/company_delete', {name: n}, '删除开单名称');\r\n      } else if (oper_object === 'vehicle') {\r\n        deleteData('/datamgt/vehicle_delete', {name: n}, '删除车船号');\r\n      } else if (oper_object === 'warehouse') {\r\n        deleteData('/datamgt/warehouse_delete', {name: n}, '删除仓库');\r\n      } else if (oper_object === 'destination') {\r\n        deleteData('/datamgt/destination_delete', {name: n}, '删除目的地');\r\n      } else if (oper_object === 'brand') {\r\n        deleteData('/datamgt/brand_delete', {name: n}, '删除牌号');\r\n      } else if (oper_object === 'sale_dep') {\r\n        deleteData('/datamgt/sale_dep_delete', {name: n}, '删除销售部门');\r\n      }\r\n    }\r\n  });\r\n\r\n  function deleteData(route, data, msg) {\r\n    ajaxRequestHandle(route, 'POST', data, msg, function () {\r\n      ldata.remove(currentIdx);\r\n      selectedIdx = -1;\r\n      currentIdx = -1;\r\n      resetTable(null);\r\n      $('#data-dialog').modal('hide');\r\n    });\r\n  }\r\n\r\n  function getData() {\r\n    if (oper_object === 'brand' || oper_object === 'sale_dep') {\r\n      return { name : dictName.val() };\r\n    } else if (oper_object === 'vehicle') {\r\n      return {\r\n        name : dictName.val(),\r\n        veh_type : veh_type,\r\n        veh_category: vehCategory.val(),\r\n        contact_name : contactInput.val(),\r\n        phone : phoneInput.val()\r\n      }\r\n    } else if (oper_object === 'company') {\r\n      var customers = [];\r\n      var temp = $('#customers').val();\r\n      if (!isEmpty(temp)) {\r\n        customers = temp.split(/[,，\\r\\n]/);\r\n      }\r\n      return {\r\n        name : dictName.val(),\r\n        customers: customers,\r\n        contact_name : contactInput.val(),\r\n        phone : phoneInput.val(),\r\n        address : addressInput.val()\r\n      }\r\n    } else {\r\n      return {\r\n        name : dictName.val(),\r\n        contact_name : contactInput.val(),\r\n        phone : phoneInput.val(),\r\n        address : addressInput.val()\r\n      }\r\n    }\r\n  }\r\n\r\n  function addData(route, msg) {\r\n    var data = getData();\r\n    ajaxRequestHandle(route, 'POST', data, msg, function() {\r\n      if (ldata) {\r\n        ldata.push(data);\r\n        resetTable(null);\r\n      }\r\n\r\n      $('#data-dialog').modal('hide');\r\n    });\r\n  }\r\n\r\n  function modifyData(route, msg) {\r\n    var data = getData();\r\n    ajaxRequestHandle(route, 'POST', data, msg, function() {\r\n      if (ldata && currentIdx >= 0) {\r\n        ldata[currentIdx].contact_name = data.contact_name;\r\n        ldata[currentIdx].phone = data.phone;\r\n        var str = '<td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td>'.format(currentIdx + 1, data.name, data.contact_name, data.phone);\r\n        if (oper_object === 'vehicle') {\r\n          ldata[currentIdx].veh_type = data.veh_type;\r\n          ldata[currentIdx].veh_category = data.veh_category;\r\n          str = '<td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td>'.format(currentIdx + 1, data.name, data.veh_type, data.veh_category, data.contact_name, data.phone);\r\n        } else if (oper_object === 'company') {\r\n          ldata[currentIdx].customers = data.customers;\r\n          ldata[currentIdx].address = data.address;\r\n          str = '<td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td>'.format(currentIdx + 1, data.name, data.customers, data.address, data.contact_name, data.phone);\r\n        } else {\r\n          ldata[currentIdx].address = data.address;\r\n          str = '<td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td>'.format(currentIdx + 1, data.name, data.address, data.contact_name, data.phone);\r\n        }\r\n        dataBody.find('tr').eq(selectedIdx).html(str);\r\n      }\r\n\r\n      $('#data-dialog').modal('hide');\r\n    });\r\n  }\r\n\r\n  function resetTable(filter) {\r\n    dataBody.empty();\r\n    if (ldata.length > 0) {\r\n      var str = '<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td></tr>';\r\n      if (oper_object === 'brand' || oper_object === 'sale_dep') {\r\n        str = '<tr><td>{0}</td><td>{1}</td></tr>';\r\n        $.each(ldata, function (idx, row) {\r\n          if (!filter || filter === '所有记录' || row.name.indexOf(filter) >= 0) {\r\n            dataBody.append(str.format(idx + 1, row.name));\r\n          }\r\n        });\r\n      } else if (oper_object === 'company') {\r\n        str = '<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td></tr>';\r\n        $.each(ldata, function (idx, row) {\r\n          if (!filter || filter === '所有记录' || row.name.indexOf(filter) >= 0) {\r\n            dataBody.append(str.format(idx + 1, row.name, row.customers,\r\n              row.address ? row.address : '', row.contact_name ? row.contact_name : '', row.phone ? row.phone : ''));\r\n          }\r\n        });\r\n      } else if (oper_object === 'vehicle') {\r\n        str = '<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td></tr>';\r\n        $.each(ldata, function (idx, row) {\r\n          if (!filter || filter === '所有记录' || row.name.indexOf(filter) >= 0) {\r\n            dataBody.append(str.format(idx + 1, row.name, row.veh_type ? row.veh_type : '', row.veh_category ? row.veh_category : '', row.contact_name ? row.contact_name : '', row.phone ? row.phone : ''));\r\n          }\r\n        });\r\n      } else {\r\n        str = '<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td></tr>';\r\n        $.each(ldata, function (idx, row) {\r\n          if (!filter || filter === '所有记录' || row.name.indexOf(filter) >= 0) {\r\n            dataBody.append(str.format(idx + 1, row.name,\r\n              row.address ? row.address : '', row.contact_name ? row.contact_name : '', row.phone ? row.phone : ''));\r\n          }\r\n        });\r\n      }\r\n\r\n      tableBodyEventHandler();\r\n    }\r\n  }\r\n\r\n  function tableBodyEventHandler() {\r\n    tr_click(dataBody.find('tr'), function (e, index) {\r\n      selectedIdx = index;\r\n      var me = $(e.currentTarget);\r\n      currentIdx = parseInt(getTableCellChildren(me, 0).text()) - 1;\r\n      if (selectedIdx >= 0) {\r\n        setHtmlElementDisabled(btnModify, false);\r\n        setHtmlElementDisabled(btnDelete, false);\r\n      } else {\r\n        setHtmlElementDisabled(btnModify, true);\r\n        setHtmlElementDisabled(btnDelete, true);\r\n      }\r\n    });\r\n  }\r\n\r\n  function initElements(enabled) {\r\n    var el_data_input = $('#data-input');\r\n    var allInput = el_data_input.find('input');\r\n    var allTextArea = el_data_input.find('textarea');\r\n    allInput.val('');\r\n    allInput.prop('disabled', enabled);\r\n    allTextArea.val('');\r\n    allTextArea.prop('disabled', enabled);\r\n  }\r\n});"]}