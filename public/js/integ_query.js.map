{"version":3,"sources":["integ_query.js"],"names":["$","totNum","totWeight","sDate","eDate","dbDictData","local_data","bfCustomerSelect","startDateGrp","endDateGrp","iStartDate","iEndDate","iBillNo","iOrderNo","tableBody","tableHead","btnExport","ckDestForVessel","ckShowNotSent","currDBData","vehicleList","sort_pinyin","vehicles","destList","destination","billNameList","getAllList","company","billNameFilter","FilterElementD","selected","allCusters","forEach","sel_name","i","l","length","name","push","apply","customers","initSelect","vehicleFilter","destFilter","extend","tablesorter","defaults","theme","widgets","elementEventRegister","toggle","tableToExcel","html","date2Str","Date","str","len","showNotSent","bill","w","block_num","left_num","weight","format","getStrByStatus","status","getOrder","order_no","order_item_no","bill_no","billing_name","getStrValue","ship_warehouse","brand_no","thickness","width","size_type","total_weight","contract_no","sales_dep","create_date","creater","prevBill","same","settleState","settle_flag","ship_customer","sameBill","left","tWeight","veh_ves_name","ship_to","send_num","send_weight","inv_ship_date","inv_shipper","inv_no","datetimepicker","getDateTimePickerOptions","on","e","date","startOf","data","setMinDate","endOf","setMaxDate","showDestForVessel","iCheck","showNotSentButtonsEnabled","disabled","setHtmlElementDisabled","text","showHtmlElement","resetTable","bills","empty","find","append","inv_settle_flag","collection_price","price","status_2","veh_ves_price","trigger","d1","val","d2","b","isEmpty","obj","fName","fVeh","fDest","fDate1","toISOString","fDate2","fBno","fOrder","fType","fShowDestForVessel","fCustomerName","fShowUnsend","selectNone","nlApp","setTitle","showPleaseWait","get","result","jQuery","parseJSON","ok","rebuild","hidePleaseWait","ajaxRequestHandle"],"mappings":"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","file":"integ_query.js","sourcesContent":["/**\r\n * Created by ezefjia on 2015/1/2.\r\n */\r\n\r\n$(function () {\r\n  \"use strict\";\r\n\r\n  var dbDictData = local_data;\r\n  var bfCustomerSelect = $('#bf-customer');\r\n  var startDateGrp     = $('#start-date-grp');\r\n  var endDateGrp       = $('#end-date-grp');\r\n  var iStartDate       = $('#start-date');\r\n  var iEndDate         = $('#end-date');\r\n  var iBillNo          = $('#bf-bill-no');\r\n  var iOrderNo         = $('#bf-order-no');\r\n  var tableBody        = $('#table-tbody');\r\n  var tableHead        = $('#table-thead');\r\n  var btnExport        = $('#search-export');\r\n  var ckDestForVessel  = $('#to-ship-vessel');\r\n  var ckShowNotSent    = $('#show-not-sent');\r\n\r\n  var totNum, totWeight;\r\n  var currDBData = [];\r\n  var sDate, eDate;\r\n\r\n  var vehicleList = sort_pinyin(dbDictData.vehicles);\r\n  var destList = sort_pinyin(dbDictData.destination);\r\n  var billNameList = sort_pinyin(getAllList(false, dbDictData.company, \"name\"));\r\n\r\n  var billNameFilter = new FilterElementD($('#bf-bill-name'), billNameList, true, false,\r\n    function (selected) {\r\n      var allCusters = [];\r\n      selected.forEach(function (sel_name) {\r\n        for (var i = 0, l = dbDictData.company.length; i < l; ++i) {\r\n          var company = dbDictData.company[i];\r\n          if (company.name === sel_name) {\r\n            allCusters.push.apply(allCusters, company.customers);\r\n            break;\r\n          }\r\n        }\r\n      });\r\n\r\n      initSelect(bfCustomerSelect, sort_pinyin(allCusters), true);\r\n    });\r\n\r\n  var vehicleFilter = new FilterElementD($('#bf-vehicle'), vehicleList, false, true, null);\r\n  var destFilter = new FilterElementD($('#bf-destination'), destList, false, true, null);\r\n\r\n  // initialize table sorter\r\n  $.extend($.tablesorter.defaults, { theme: 'blue' });\r\n  $('#query-table').tablesorter({widgets:['stickyHeaders']});\r\n\r\n  elementEventRegister($('#filter'), 'click', function() { $('#filter-ui').toggle(); });\r\n  elementEventRegister(btnExport, 'click', function() {\r\n    tableToExcel($('#query-table').html(), \"查询结果\", \"综合查询\" + date2Str(new Date()) + \".xls\");\r\n  });\r\n\r\n  elementEventRegister($('#account-checking-export'), 'click', function() {\r\n    if (currDBData.length) {\r\n      var html = '<table><tr><th>状态</th><th>订单号</th><th>提单号</th><th>开单名称</th><th>车船号</th><th>目的地</th><th>发运块数</th><th>发运重量</th><th>总块数</th><th>总重量</th><th>发货日期</th><th>发货人</th><th>运单号</th><th>发货仓库</th><th>牌号</th><th>厚</th><th>宽</th><th>长</th><th>尺寸</th><th>合同号</th><th>销售部门</th><th>创建日期</th><th>创建人</th><th>结算状态</th></tr>';\r\n      var thead = [\"状态\",\"订单号\",\"提单号\",\"开单名称\",\"车船号\",\"目的地\",\"发运块数\",\"发运重量\",\"总块数\",\"总重量\",\"发货日期\",\"发货人\",\"运单号\",\"发货仓库\",\"牌号\",\"厚\",\"宽\",\"长\",\"尺寸\",\"合同号\",\"销售部门\",\"创建日期\",\"创建人\",\"结算状态\"];\r\n      var str = '<tr>';\r\n      for (var i = 0, len = thead.length; i < len; ++i) {\r\n        str += \"<td>{\" + i + \"}</td>\";\r\n      }\r\n      str += \"</tr>\";\r\n\r\n      if (showNotSent) {\r\n        currDBData.forEach(function (bill) {\r\n          var w = (bill.block_num > 0 ? (bill.left_num * bill.weight) : bill.left_num);\r\n          html += str.format(getStrByStatus(bill.status, bill.status), getOrder(bill.order_no, bill.order_item_no), bill.bill_no, bill.billing_name,\r\n            '', '', 0, getStrValue(w), '', '', '',\r\n            bill.ship_warehouse ? bill.ship_warehouse : '', bill.brand_no ? bill.brand_no : \"\",\r\n            getStrValue(bill.thickness), getStrValue(bill.width), getStrValue(bill.len), bill.size_type, bill.block_num, getStrValue(bill.total_weight),\r\n            bill.contract_no ? bill.contract_no : '', bill.sales_dep ? bill.sales_dep : '',\r\n            date2Str(bill.create_date), bill.creater ? bill.creater : '', '');\r\n          //totWeight += w;\r\n        });\r\n      } else {\r\n        var prevBill = null;\r\n        var same = false;\r\n        for (i = 0, len = currDBData.length; i < len; ++i) {\r\n          var bill = currDBData[i];\r\n          var settleState = \"\";\r\n          if (bill.settle_flag === 0) {\r\n            settleState = \"未结算\";\r\n          } else if (bill.settle_flag === 1) {\r\n            settleState = \"客户结算\";\r\n          } else if (bill.settle_flag === 2) {\r\n            settleState = \"代收付结算\";\r\n          } else if (bill.settle_flag === 3) {\r\n            settleState = \"客户,代收付结算\";\r\n          }\r\n\r\n          var name = (bill.ship_customer ? (bill.billing_name + \"/\" + bill.ship_customer) : bill.billing_name);\r\n          same = (!!prevBill && sameBill(prevBill, bill));\r\n\r\n          if (!same && prevBill && prevBill.left_num > 0) {\r\n            var left = prevBill.block_num > 0 ? prevBill.left_num * prevBill.weight : prevBill.left_num;\r\n            html += str.format(getStrByStatus(prevBill.status, prevBill.status), getOrder(prevBill.order_no, prevBill.order_item_no), prevBill.bill_no, name,\r\n              '', '', '0', '0', prevBill.block_num, getStrValue(left), '', '', '',\r\n              prevBill.ship_warehouse ? prevBill.ship_warehouse : '', prevBill.brand_no ? prevBill.brand_no : \"\",\r\n              getStrValue(prevBill.thickness), getStrValue(prevBill.width), getStrValue(prevBill.len), prevBill.size_type,\r\n              prevBill.contract_no ? prevBill.contract_no : '', prevBill.sales_dep ? prevBill.sales_dep : '',\r\n              date2Str(prevBill.create_date), prevBill.creater ? prevBill.creater : '', settleState);\r\n          }\r\n\r\n          var tWeight = 0;\r\n          if (!same) {\r\n            if (bill.block_num > 0) {\r\n              if (bill.left_num !== bill.block_num) {\r\n                tWeight = (bill.block_num - bill.left_num) * bill.weight;\r\n              } else {\r\n                tWeight = bill.total_weight;\r\n              }\r\n            } else {\r\n              if (bill.left_num !== bill.total_weight) {\r\n                tWeight = bill.total_weight - bill.left_num;\r\n              } else {\r\n                tWeight = bill.total_weight;\r\n              }\r\n            }\r\n          }\r\n\r\n          html += str.format(getStrByStatus(bill.status, bill.status), getOrder(bill.order_no, bill.order_item_no), bill.bill_no, name,\r\n            bill.veh_ves_name, bill.ship_to, bill.send_num, getStrValue(bill.send_weight), bill.block_num, getStrValue(tWeight),\r\n            date2Str(bill.inv_ship_date), bill.inv_shipper ? bill.inv_shipper : '', bill.inv_no ? bill.inv_no : \"\",\r\n            bill.ship_warehouse ? bill.ship_warehouse : '', bill.brand_no ? bill.brand_no : \"\",\r\n            getStrValue(bill.thickness), getStrValue(bill.width), getStrValue(bill.len), bill.size_type,\r\n            bill.contract_no ? bill.contract_no : '', bill.sales_dep ? bill.sales_dep : '',\r\n            date2Str(bill.create_date), bill.creater ? bill.creater : '', settleState);\r\n\r\n\r\n          prevBill = bill;\r\n        }\r\n      }\r\n\r\n      tableToExcel(html, '对账数据', date2Str(new Date()) + \".xls\");\r\n    }\r\n  });\r\n\r\n  startDateGrp.datetimepicker(getDateTimePickerOptions()).on('dp.change', function(e) {\r\n    sDate = e.date.startOf('day');\r\n    endDateGrp.data(\"DateTimePicker\").setMinDate(e.date);\r\n  });\r\n  endDateGrp.datetimepicker(getDateTimePickerOptions()).on('dp.change', function(e) {\r\n    eDate = e.date.endOf('day');\r\n    startDateGrp.data(\"DateTimePicker\").setMaxDate(e.date);\r\n  });\r\n\r\n  var showDestForVessel = false;\r\n  ckDestForVessel.iCheck('uncheck');\r\n  ckDestForVessel.on('ifChecked', function() { showDestForVessel = true; });\r\n  ckDestForVessel.on('ifUnchecked', function() { showDestForVessel = false; });\r\n\r\n  var showNotSent = false;\r\n  ckShowNotSent.iCheck('uncheck');\r\n  ckShowNotSent.on('ifChecked', function() {\r\n    showNotSent = true;\r\n    showNotSentButtonsEnabled();\r\n  });\r\n  ckShowNotSent.on('ifUnchecked', function() {\r\n    showNotSent = false;\r\n    showNotSentButtonsEnabled();\r\n  });\r\n\r\n  function showNotSentButtonsEnabled() {\r\n    vehicleFilter.disabled(showNotSent);\r\n    destFilter.disabled(showNotSent);\r\n    if (showNotSent) {\r\n      ckDestForVessel.iCheck('disable');\r\n      setHtmlElementDisabled(iStartDate, true);\r\n      setHtmlElementDisabled(iEndDate, true);\r\n      setHtmlElementDisabled(bfCustomerSelect, true);\r\n      $('#head-weight').text('未配发重量');\r\n      //$('#lb-send-weight').text('未配发重量');\r\n      showHtmlElement($('#lb-send-num'), false);\r\n    } else {\r\n      ckDestForVessel.iCheck('enable');\r\n      setHtmlElementDisabled(iStartDate, false);\r\n      setHtmlElementDisabled(iEndDate, true);\r\n      setHtmlElementDisabled(bfCustomerSelect, false);\r\n      $('#head-weight').text('发运重量');\r\n      //$('#lb-send-weight').text('发运重量');\r\n      showHtmlElement($('#lb-send-num'), true);\r\n    }\r\n  }\r\n\r\n  $('#query-ok').on('click', function() {\r\n    var d1 = iStartDate.val();\r\n    var d2 = iEndDate.val();\r\n    var b = !isEmpty(d1) && !isEmpty(d2);\r\n    var obj = {\r\n      fName: billNameFilter.selected,\r\n      fVeh: vehicleFilter.selected,\r\n      fDest: destFilter.selected,\r\n      fDate1: b ? sDate.toISOString() : null,\r\n      fDate2: b ? eDate.toISOString(): null,\r\n      fBno: iBillNo.val(),\r\n      fOrder: iOrderNo.val(),\r\n      fType: 'bill-first',\r\n      fShowDestForVessel: showDestForVessel ? 1 : 0,\r\n      fCustomerName: bfCustomerSelect.val(),\r\n      fShowUnsend: 0\r\n    };\r\n\r\n    if (showNotSent) {\r\n      obj.fVeh = [];\r\n      obj.fDest = [];\r\n      obj.fShowDestForVessel = 0;\r\n      obj.fCustomerName = null;\r\n      obj.fShowUnsend = 1;\r\n      obj.fDate1 = null;\r\n      obj.fDate2 = null;\r\n    } else {\r\n      if (billNameFilter.selectNone() && vehicleFilter.selectNone() && destFilter.selectNone() && !b && !obj.fBno && !obj.fOrder) {\r\n        currDBData = [];\r\n        resetTable(currDBData);\r\n        return; // Empty condition, return directly.\r\n      }\r\n    }\r\n\r\n    nlApp.setTitle('获取数据...');\r\n    nlApp.showPleaseWait();\r\n    $.get('/get_invoices_bill', obj, function(data) {\r\n      currDBData = [];\r\n      var result = jQuery.parseJSON(data);\r\n      if (result.ok) {\r\n        currDBData = result.bills;\r\n      } else {\r\n        vehicleFilter.rebuild(vehicleList, null);\r\n        destFilter.rebuild(destList, null);\r\n      }\r\n\r\n      resetTable(currDBData);\r\n      nlApp.hidePleaseWait();\r\n    })\r\n  });\r\n\r\n  function resetTable(bills) {\r\n    tableBody.empty();\r\n    totNum = 0;\r\n    totWeight = 0;\r\n\r\n    var str = '<tr>';\r\n    var len = tableHead.find(\"th\").length;\r\n    for (var i = 0; i < len; ++i) {\r\n      str += \"<td>{\" + i + \"}</td>\";\r\n    }\r\n    str += \"</tr>\";\r\n\r\n    if (showNotSent) {\r\n      bills.forEach(function (bill) {\r\n        var w = (bill.block_num > 0 ? (bill.left_num * bill.weight) : bill.left_num);\r\n        tableBody.append(str.format('', getStrByStatus(bill.status, bill.status), getOrder(bill.order_no, bill.order_item_no), bill.bill_no, bill.billing_name,\r\n          '', '', 0, getStrValue(w), '', '', '', '', '',\r\n          bill.ship_warehouse ? bill.ship_warehouse : '', bill.brand_no ? bill.brand_no : \"\",\r\n          getStrValue(bill.thickness), getStrValue(bill.width), getStrValue(bill.len), bill.size_type, bill.block_num, getStrValue(bill.total_weight),\r\n          bill.contract_no ? bill.contract_no : '', bill.sales_dep ? bill.sales_dep : '',\r\n          date2Str(bill.create_date), bill.creater ? bill.creater : ''));\r\n        totWeight += w;\r\n      });\r\n    } else {\r\n      bills.forEach(function (bill) {\r\n        var settleState = \"\";\r\n        if (bill.inv_settle_flag === 0) {\r\n          if (bill.collection_price < 0 && bill.price < 0) {\r\n            settleState = '客户,代收都不需要结算';\r\n          } else if (bill.collection_price < 0) {\r\n            settleState = '客户未结算,代收不需要结算';\r\n          } else {\r\n            settleState = '客户,代收都未结算';\r\n          }\r\n        } else if (bill.inv_settle_flag === 1) {\r\n          if (bill.collection_price < 0) {\r\n            settleState = '客户已结算,代收不需要结算 - ' + bill.status_2;\r\n          } else {\r\n            settleState = \"客户已结算,代收未结算 - \" + bill.status_2;\r\n          }\r\n        } else if (bill.inv_settle_flag === 2) {\r\n          if (bill.price < 0) {\r\n            settleState = '客户不需要结算,代收已结算 - ' + bill.status_2;\r\n          } else {\r\n            settleState = \"代收已结算,客户未结算 - \" + bill.status_2;\r\n          }\r\n        } else if (bill.inv_settle_flag === 3) {\r\n          settleState = \"客户,代收付都已结算 - \" + bill.status_2;\r\n        }\r\n\r\n        var name = (bill.ship_customer ? (bill.billing_name + \"/\" + bill.ship_customer) : bill.billing_name);\r\n        tableBody.append(str.format(settleState, getStrByStatus(bill.status, bill.status), getOrder(bill.order_no, bill.order_item_no), bill.bill_no, name,\r\n          bill.veh_ves_name, bill.ship_to, bill.send_num, getStrValue(bill.send_weight),\r\n          getStrValue(bill.price), getStrValue(bill.veh_ves_price),\r\n          date2Str(bill.inv_ship_date), bill.inv_shipper ? bill.inv_shipper : '', bill.inv_no ? bill.inv_no : \"\",\r\n          bill.ship_warehouse ? bill.ship_warehouse : '', bill.brand_no ? bill.brand_no : \"\",\r\n          getStrValue(bill.thickness), getStrValue(bill.width), getStrValue(bill.len), bill.size_type, bill.block_num, getStrValue(bill.total_weight),\r\n          bill.contract_no ? bill.contract_no : '', bill.sales_dep ? bill.sales_dep : '',\r\n          date2Str(bill.create_date), bill.creater ? bill.creater : ''));\r\n\r\n        totNum += bill.send_num;\r\n        totWeight += bill.send_weight;\r\n      });\r\n      $('#lb-total-num').text(getStrValue(totNum));\r\n    }\r\n\r\n    $('#lb-total-weight').text(getStrValue(totWeight));\r\n    $('#curr-number').text(tableBody.find(\"tr\").length);\r\n    //if (showNotSent) {\r\n    //  $.extend($.tablesorter.defaults, { theme: 'blue' });\r\n    //  $('#query-table').tablesorter({widgets:['stickyHeaders']});\r\n    //\r\n    //  $('td:nth-child(5),th:nth-child(5)').hide();\r\n    //  $('td:nth-child(6),th:nth-child(6)').hide();\r\n    //  $('td:nth-child(7),th:nth-child(7)').hide();\r\n    //  $('td:nth-child(8),th:nth-child(8)').hide();\r\n    //  $('td:nth-child(9),th:nth-child(9)').hide();\r\n    //  $('td:nth-child(10),th:nth-child(10)').hide();\r\n    //  $('td:nth-child(11),th:nth-child(11)').hide();\r\n    //} else {\r\n    //  $('td:nth-child(5),th:nth-child(5)').show();\r\n    //  $('td:nth-child(6),th:nth-child(6)').show();\r\n    //  $('td:nth-child(7),th:nth-child(7)').show();\r\n    //  $('td:nth-child(8),th:nth-child(8)').show();\r\n    //  $('td:nth-child(9),th:nth-child(9)').show();\r\n    //  $('td:nth-child(10),th:nth-child(10)').show();\r\n    //  $('td:nth-child(11),th:nth-child(11)').show();\r\n    //}\r\n    $(\"#query-table\").trigger(\"update\");\r\n  }\r\n\r\n  $('#adjust-data').on('click', function() {\r\n    ajaxRequestHandle('/initial_settle_flag', 'POST', {}, '纠正数据', null);\r\n  })\r\n});\r\n"]}