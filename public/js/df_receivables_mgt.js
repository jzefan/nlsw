$(function(){"use strict";var t=$("#data-add"),a=$("#data-modify"),l=$("#data-delete"),e=$("#data-export"),o=$("#data-btn-ok"),d=$("#data-tbody"),n=$("#i-drayage"),i=$("#i-forklift"),r=$("#month-choice-grp"),m=$("#month-choice"),c=local_data,s=-1,f="unknown",b="";setHtmlElementDisabled(a,!0),setHtmlElementDisabled(l,!0),n.ForceNumericOnly(),i.ForceNumericOnly();var u=getDateTimePickerOptions();function h(t,e,a){if(0<=s){var l=c[s];v(t),n.val(getStrValue(l.drayage)),i.val(getStrValue(l.forklift)),b=l.month,m.val(l.month),setHtmlElementDisabled(m,!0),setHtmlElementDisabled(r,!0),f=a,setHtmlElementDisabled(o,!1),$("#i-title").val(e),$("#data-dialog").modal({backdrop:"static",keyboard:!1}).modal("show")}}function v(t){n.val(""),i.val(""),n.prop("disabled",t),i.prop("disabled",t)}function k(){if(d.empty(),0<c.length){$.each(c,function(t,e){d.append("<tr><td>{0}</td><td>{1}</td><td>{2}</td></tr>".format(e.month,e.drayage,e.forklift))}),tr_click(d.find("tr"),function(t,e){0<=(s=e)?(setHtmlElementDisabled(a,!1),setHtmlElementDisabled(l,!1)):(setHtmlElementDisabled(a,!0),setHtmlElementDisabled(l,!0))})}}u.minViewMode="months",u.format="YYYY-MM",r.datetimepicker(u).on("dp.change",function(t){b=t.date.startOf("month").format("YYYY-MM"),setHtmlElementDisabled(o,!1),b?$.get("/get_one_df_data",{month:b},function(t){var e=jQuery.parseJSON(t);e.ok&&(bootbox.alert("不能增加, 记录已存在！月份:"+b),b="",m.val(""))}):v(!1)}),k(),t.on("click",function(){v(!1),b="",m.val(""),setHtmlElementDisabled(m,!1),setHtmlElementDisabled(r,!1),f="add",$("#i-title").val("短驳叉车应收款输入"),$("#data-dialog").modal({backdrop:"static",keyboard:!1}).modal("show")}),a.on("click",function(){h(!1,"短驳叉车应收款更新","update")}),l.on("click",function(){h(!0,"短驳叉车应收款删除","delete")}),e.on("click",function(){var t=$("#data-table").html(),e="download";e+=date2Str(new Date)+".xls",tableToExcel(t,"data",e)}),o.on("click",function(){if(b){var e={month:b,drayage:n.val()?parseFloat(n.val()):0,forklift:i.val()?parseFloat(i.val()):0};"delete"===f?ajaxRequestHandle("/delete_df_data","POST",e,"数据删除",function(){$("#data-dialog").modal("hide");for(var t=0;t<c.length;++t)if(c[t].month===b){c.remove(t);break}k()}):ajaxRequestHandle("/one_df_receivables","POST",e,"数据保存",function(){if($("#data-dialog").modal("hide"),"add"===f)c.push(e);else if("update"===f)for(var t=0;t<c.length;++t)c[t].month===b&&(c[t].drayage=e.drayage,c[t].forklift=e.forklift);k()})}else bootbox.alert("请选择月份")})});
//# sourceMappingURL=df_receivables_mgt.js.map
