{"version":3,"sources":["plan_list.js"],"names":["$","planTable","tableBody","btnFilter","btnExport","updatePlan","deletePlan","closePlan","unClosePlan","destination","dbPlans","local_data","plans","selectedPlans","selectedIdx","qFilter","PlanQueryFilterD","customer_name","needUpdateDbData","emptyDbData","css","cursor","obj","getQueryParams","get","data","result","jQuery","parseJSON","ok","text","getStrValue","totalWeight","leftWeight","str","forEach","p","k","length","order_no","getRowChildren","find","eq","html","trigger","enableButtons","setHtmlElementDisabled","resetTableRow","empty","html_text","plan","push","trData","append","join","prop","on","selectRow","this","e","stopImmediatePropagation","closest","me","needUpdateCheckbox","index","b","found","i","remove","removeClass","addClass","showSelectedTotalValue","weight","left","order_weight","left_weight","getStrStatus","state","tr","format","customer_code","transport_mode","consignee","ds_client","customer_saleman","consigner","contract_no","receiving_charge","date2Str","entry_time","status","select2","initSelect","datetimepicker","getDateTimePickerOptions","extend","tablesorter","defaults","theme","widgets","elementEventRegister","val","setDate","modal","backdrop","keyboard","bootbox","alert","confirm","ajaxRequestHandle","splice","ordersNo","checkBox","slice","orderNo","orderWeight","transportMode","dsClient","salesman","contractNo","charge","entryTime","getDate","w","l","tableToExcel","showFilter","toggle","options","filter","currSelected","self","uiElems","sBfOrder","sBfCustomerName","sBfTransportMode","sBfStatus","startDateGrp","endDateGrp","iStartDate","iEndDate","_selectFliterFunc","unselected","eDate","moment","sDate","subtract","startGrp","endGrp","which","isAllEmpty","_dateFilterFunc","isStart","isEnd","d1","d2","isEmpty","preventDefault","date","startOf","setMinDate","endOf","setMaxDate","prototype","order","name","mode","fOrder","fName","fTransportMode","fStatus","fDate1","toISOString","fDate2","getSelectValue","reset"],"mappings":"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","file":"plan_list.js","sourcesContent":["$(function () {\n  \"use strict\";\n\n  var planTable  = $('#table-plan-content');\n  var tableBody  = $('#table-tbody');\n  var btnFilter  = $('#filter');\n  var btnExport  = $('#search-export');\n\n  var updatePlan = $('#plan-update');\n  var deletePlan = $('#plan-delete');\n  var closePlan = $('#plan-end');\n  var unClosePlan = $('#undo-plan-end');\n  var destination = $('#m_destination');\n\n  var dbPlans = local_data.plans;\n  var selectedPlans = [];\n  var selectedIdx = 0;\n\n  var qFilter = new PlanQueryFilterD(local_data.customer_name, filterData);\n  destination.select2();\n  initSelect(destination, local_data.destination, false, '');\n\n  $('#m_entry_time_grp').datetimepicker(getDateTimePickerOptions());\n\n  $.extend($.tablesorter.defaults, {theme: 'blue'});\n  planTable.tablesorter({widgets: ['stickyHeaders']});\n\n  $('#first-th').html('<input id=\"select-all\" type=\"checkbox\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"选择所有记录\" />');\n  enableButtons();\n  resetTableRow();\n\n  elementEventRegister(updatePlan, 'click', function() { showUpdateForm() });\n\n  elementEventRegister(deletePlan, 'click', function() {\n    for (var i = 0; i < selectedPlans.length; ++i) {\n      if (selectedPlans[i].order_weight - selectedPlans[i].left_weight > 0.00001) {\n        bootbox.alert('订单已经开始配发，不能删除！' + selectedPlans.order_no);\n        return;\n      }\n    }\n\n    bootbox.confirm('危险!您确定要删除? 删除后不能恢复!', function (result) {\n      if (result) {\n        ajaxRequestHandle('/plan/delete', 'POST', selectedPlans, '删除', function () {\n          selectedPlans.forEach( function(p) {\n            for (var k = 0; k < dbPlans.length; ++k) {\n              if (p.order_no === dbPlans[k].order_no) {\n                dbPlans.splice(k, 1);\n                break;\n              }\n            }\n          });\n          resetTableRow();\n        });\n      }\n    });\n  });\n\n  elementEventRegister(closePlan, 'click', function() {\n    var ordersNo = [];\n    selectedPlans.forEach(function (plan) { ordersNo.push(plan.order_no); });\n    ajaxRequestHandle('/plan/status_close', 'POST', ordersNo, '订单终结', function() {\n      closePlan('结案');\n    })\n  });\n\n  elementEventRegister(unClosePlan, 'click', function() {\n    var ordersNo = [];\n    selectedPlans.forEach(function (plan) { ordersNo.push(plan.order_no); });\n    ajaxRequestHandle('/plan/status_unclose', 'POST', ordersNo, '取消订单终结', function() {\n      closePlan('生效');\n    })\n  });\n\n\n  function closePlan(str) {\n    selectedPlans.forEach(function (p) {\n      for (var k = 0; k < dbPlans.length; ++k) {\n        if (p.order_no === dbPlans[k].order_no) {\n          var tr = getRowChildren(tableBody, k);\n          tr.find(\"td\").eq(16).html(str);\n          break;\n        }\n      }\n    })\n    planTable.trigger(\"update\");\n  }\n\n  elementEventRegister($('#select-all'), 'click', function() {\n    if (dbPlans.length > 0) {\n      var checkBox = $('.select-order');\n      if (selectedPlans.length === dbPlans.length) { // 之前已经选择\n        checkBox.prop(\"checked\", false);\n        selectedPlans = [];\n        tableBody.find(\"tr\").removeClass('invoice-highlighted');\n      } else {\n        checkBox.prop(\"checked\", true);\n        selectedPlans = dbPlans.slice(0);\n        tableBody.find(\"tr\").addClass('invoice-highlighted');\n      }\n\n      enableButtons();\n      showSelectedTotalValue();\n    }\n  });\n\n  elementEventRegister($('#update-plan-ok'), 'click', function() {\n    var plan = selectedPlans[0]; //\n    var obj = {\n      orderNo: plan.order_no,\n      orderWeight : $('#m_order_weight').val(),\n      destination : $('#m_destination').val(),\n      transportMode : $('#m_transport_mode').val(),\n      consignee : $('#m_consignee').val(),\n      dsClient : $('#m_ds_client').val(),\n      salesman : $('#m_salesman').val(),\n      consigner : $('#m_consigner').val(),\n      contractNo : $('#m_contract_no').val(),\n      charge : $('#m_charge').val(),\n      entryTime: $('#m_entry_time_grp').data(\"DateTimePicker\").getDate()\n    };\n\n    var w = +obj.orderWeight;\n    var l = w - plan.order_weight + plan.left_weight;\n\n    ajaxRequestHandle('/plan/update', 'POST', obj, '订单更新', function() {\n      var tr = getRowChildren(tableBody, selectedIdx);\n      tr.find(\"td\").eq(2).html(getStrValue(obj.orderWeight));\n      tr.find(\"td\").eq(3).html(getStrValue(obj.orderWeight - l));\n      tr.find(\"td\").eq(4).html(getStrValue(l));\n      tr.find(\"td\").eq(7).html(obj.destination); // 7 destination\n      tr.find(\"td\").eq(8).html(obj.transportMode); // 8 transport mode\n      tr.find(\"td\").eq(9).html(obj.consignee ? obj.consignee : ''); // 9 收货人\n      tr.find(\"td\").eq(10).html(obj.dsClient ? obj.dsClient : ''); // 10 ds client\n      tr.find(\"td\").eq(11).html(obj.salesman ? obj.salesman : ''); // 11 saleman\n      tr.find(\"td\").eq(12).html(obj.consigner ? obj.consigner : ''); // 12 consigner\n      tr.find(\"td\").eq(13).html(obj.contractNo ? obj.contractNo : ''); // 13 contract no\n      tr.find(\"td\").eq(14).html(getStrValue(obj.charge)); // 14 charge\n      tr.find(\"td\").eq(15).html(date2Str(obj.entryTime)); // 14 charge\n\n      if (l === 0) {\n        plan.status = 2;\n      } else if (l === w) {\n        plan.status = 0;\n      } else {\n        plan.status = 1;\n      }\n\n      tr.find(\"td\").eq(16).html(getStrStatus(plan.status));\n\n      plan.order_weight = obj.orderWeight;\n      plan.left_weight = l;\n      plan.destination = obj.destination;\n      plan.transport_mode = obj.transportMode;\n      plan.consignee = obj.consignee;\n      plan.ds_client = obj.dsClient;\n      plan.customer_saleman = obj.salesman;\n      plan.consigner = obj.consigner;\n      plan.contract_no = obj.contractNo;\n      plan.receiving_charge = obj.charge;\n      plan.entry_time = obj.entryTime;\n\n      $('#plan-modify-dialog').modal('hide');\n      planTable.trigger(\"update\");\n    });\n  });\n\n  ////////////////////////////////////////////////////////////////////////////////////////////////////////\n  /// Function list\n  ////////////////////////////////////////////////////////////////////////////////////////////////////////\n  function enableButtons() {\n    if (dbPlans.length) {\n      setHtmlElementDisabled(btnExport, false);\n    } else {\n      setHtmlElementDisabled(btnExport, true);\n    }\n\n    if (selectedPlans.length) {\n      if (selectedPlans.length === 1) {\n        setHtmlElementDisabled(updatePlan, false);\n      } else {\n        setHtmlElementDisabled(updatePlan, true);\n      }\n      setHtmlElementDisabled(deletePlan, false);\n      setHtmlElementDisabled(closePlan, false);\n      setHtmlElementDisabled(unClosePlan, false);\n    } else {\n      setHtmlElementDisabled(updatePlan, true);\n      setHtmlElementDisabled(deletePlan, true);\n      setHtmlElementDisabled(closePlan, true);\n      setHtmlElementDisabled(unClosePlan, true);\n    }\n  }\n\n  function showUpdateForm() {\n    var plan = selectedPlans[0];\n    $('#h_order_no').text(plan.order_no);\n    $('#h_order_weight').text(plan.order_weight);\n    $('#h_left_weight').text(plan.left_weight);\n    $('#h_customer_name').text(plan.customer_name);\n    $('#h_customer_code').text(plan.customer_code);\n    $('#h_destination').text(plan.destination);\n    $('#h_transport_mode').text(plan.transport_mode);\n    $('#h_consignee').text(plan.consignee);\n    $('#h_ds_client').text(plan.ds_client);\n    $('#h_salesman').text(plan.customer_saleman);\n    $('#h_consigner').text(plan.consigner);\n    $('#h_contract_no').text(plan.contract_no);\n    $('#h_charge').text(plan.receiving_charge);\n    $('#h_entry_time').text(date2Str(plan.entry_time, true));\n    $('#h_status').text(getStrStatus(plan.status));\n\n    $('#m_order_weight').val(plan.order_weight);\n    $('#m_destination').select2('val', plan.destination);\n    $('#m_transport_mode').val(plan.transport_mode);\n    $('#m_consignee').val(plan.consignee);\n    $('#m_ds_client').val(plan.ds_client);\n    $('#m_salesman').val(plan.customer_saleman);\n    $('#m_consigner').val(plan.consigner);\n    $('#m_contract_no').val(plan.contract_no);\n    $('#m_charge').val(plan.receiving_charge);\n    $('#m_entry_time_grp').data(\"DateTimePicker\").setDate(date2Str(plan.entry_time, true));\n\n    $('#plan-modify-dialog').modal({ backdrop: 'static', keyboard: false}).modal('show');\n  }\n\n  function resetTableRow() {\n    tableBody.empty();\n\n    selectedPlans = [];\n    var html_text = [];\n    dbPlans.forEach(function (plan) {\n      html_text.push(makeTableBodyTr(plan));\n    });\n\n    tableBody.append(html_text.join('\\n'));\n\n    $('#select-all').prop(\"checked\", false);\n    enableButtons();\n\n    tableBody.find('tr').on('click', function () {\n      selectRow($(this), true);\n    });\n\n    $('.select-order').on('click', function(e) {\n      e.stopImmediatePropagation();\n      selectRow($(this).closest('tr'), false);\n    });\n\n    planTable.trigger(\"update\");\n  }\n\n  function selectRow(me, needUpdateCheckbox) {\n    selectedIdx = me.index();\n    var b = dbPlans[me.index()];\n    var found = false;\n    for (var i = 0; i < selectedPlans.length; ++i) {\n      if (selectedPlans[i].order_no === b.order_no) {\n        selectedPlans.remove(i);\n        found = true;\n        break;\n      }\n    }\n\n    if (found) {\n      me.removeClass('invoice-highlighted');\n    } else {\n      selectedPlans.push(b);\n      me.addClass('invoice-highlighted');\n    }\n\n    if (needUpdateCheckbox) {\n      me.find('input[type=\"checkbox\"]').prop(\"checked\", !found);\n    }\n\n    $('#select-all').prop(\"checked\", selectedPlans.length === tableBody.find(\"tr\").length);\n    enableButtons();\n    showSelectedTotalValue();\n  }\n\n  function showSelectedTotalValue() {\n    var weight = 0;\n    var left = 0;\n    selectedPlans.forEach(function(p) {\n      weight += p.order_weight;\n      left += p.left_weight;\n    });\n\n    $('#lb-total-weight').text(getStrValue(weight));\n    $('#lb-sent-weight').text(getStrValue(weight - left));\n    $('#lb-left-weight').text(getStrValue(left));\n  }\n\n  function getStrStatus(state) { return state === 0 ? '生效' : '结案'; }\n\n  function trData(plan, tr) {\n    var left = plan.left_weight;\n    var text = '';\n    if (left > 0.00001) {\n      text = '<code style=\"color:blue\">' + getStrValue(left) + '</code>';\n    } else {\n      text = '<code style=\"color:green\">0.00</code>';\n    }\n\n    return tr.format(\n      plan.order_no,\n      getStrValue(plan.order_weight), getStrValue(plan.order_weight - left), text,\n      plan.customer_name,\n      plan.customer_code ? plan.customer_code : '',\n      plan.destination ? plan.destination : '',\n      plan.transport_mode,\n      plan.consignee ? plan.consignee : '',\n      plan.ds_client ? plan.ds_client : '',\n      plan.customer_saleman ? plan.customer_saleman : '',\n      plan.consigner ? plan.consigner : '',\n      plan.contract_no ? plan.contract_no : '',\n      getStrValue(plan.receiving_charge),\n      date2Str(plan.entry_time, true), getStrStatus(plan.status));\n  }\n\n  function makeTableBodyTr(plan) {\n    var trHtml = '<tr><td align=\"center\"><input class=\"select-order\" type=\"checkbox\"></td>' +\n      '<td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td><td>{6}</td>' +\n      '<td>{7}</td><td>{8}</td><td>{9}</td><td>{10}</td><td>{11}</td><td>{12}</td><td>{13}</td><td>{14}</td><td style=\"text-align: center\">{15}</td></tr>';\n    return trData(plan, trHtml);\n  }\n\n  elementEventRegister(btnExport, 'click', function() {\n    var html_text = [ '<thead><tr><th>订单号</th><th>订单量</th><th>已发量</th><th>未发量</th><th>客户名称</th><th>客户代码</th><th>发运目的地</th><th>运输方式</th><th>收货人</th><th>下游客户</th><th>客户业务员</th><th>业务员</th><th>合同号</th><th>接单价</th><th>录单时间</th><th>订单状态</th></tr></thead><tbody>' ];\n    var trHtml = '<tr><td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td><td>{6}</td>' +\n      '<td>{7}</td><td>{8}</td><td>{9}</td><td>{10}</td><td>{11}</td><td>{12}</td><td>{13}</td><td>{14}</td><td>{15}</td></tr>';\n    dbPlans.forEach(function (plan) {\n      html_text.push(trData(plan, trHtml));\n    });\n    html_text.push('</tbody>');\n\n    tableToExcel(html_text.join('\\n'), 'data');\n  });\n\n  var showFilter = false;\n  elementEventRegister(btnFilter, 'click', function() {\n    $('#filter-ui').toggle();\n    showFilter = !showFilter;\n  });\n\n  elementEventRegister($('#show-data'), 'click', function() {\n    resetTableRow();\n  });\n\n  function filterData(needUpdateDbData, emptyDbData) {\n    if (needUpdateDbData) {\n      $('body').css({'cursor':'wait'});\n      var obj = qFilter.getQueryParams();\n      $.get('/search_plans', obj, function (data) {\n        var result = jQuery.parseJSON(data);\n        dbPlans = [];\n        if (result.ok) {\n          dbPlans = result.plans;\n          $('#lb-total-weight').text(getStrValue(result.totalWeight));\n          $('#lb-sent-weight').text(getStrValue(result.totalWeight - result.leftWeight));\n          $('#lb-left-weight').text(getStrValue(result.leftWeight));\n        } else {\n          $('#lb-total-weight').text('0.00');\n          $('#lb-sent-weight').text('0.00');\n          $('#lb-left-weight').text('0.00');\n        }\n\n        $('body').css({'cursor':'default'});\n      });\n    } else {\n      if (emptyDbData) {\n        dbPlans = [];\n        $('#lb-total-weight').text('0.00');\n        $('#lb-sent-weight').text('0.00');\n        $('#lb-left-weight').text('0.00');\n      }\n    }\n  }\n});\n\n///////////////////////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////////\nvar PlanQueryFilterD = function(options, filter) {\n  this.currSelected = 0;\n  var self = this;\n\n  this.uiElems = {\n    sBfOrder : $('#order-no'),\n    sBfCustomerName :  $('#customer-name'),\n    sBfTransportMode : $('#transport-mode'),\n    sBfStatus :    $('#status'),\n    startDateGrp : $('#start-date-grp'),\n    endDateGrp :   $('#end-date-grp'),\n    iStartDate :   $('#start-date'),\n    iEndDate :     $('#end-date')\n  };\n\n  this.options = options;\n  this.uiElems.sBfCustomerName.select2();\n  initSelect(this.uiElems.sBfCustomerName, options, true, '');\n\n  this.uiElems.sBfOrder.on('blur', function() { self._selectFliterFunc(1, filter); });\n  this.uiElems.sBfCustomerName.on('change', function() { self._selectFliterFunc(1, filter); });\n  this.uiElems.sBfTransportMode.on('change', function() { self._selectFliterFunc(1, filter); });\n  this.uiElems.sBfStatus.on('change', function() { self._selectFliterFunc(1, filter); });\n  unselected(this.uiElems.sBfCustomerName);\n  unselected(this.uiElems.sBfTransportMode);\n  unselected(this.uiElems.sBfStatus);\n\n  this.eDate = moment();\n  this.sDate = moment().subtract(1, 'months');\n  var startGrp = self.uiElems.startDateGrp.datetimepicker(getDateTimePickerOptions());\n  var endGrp = self.uiElems.endDateGrp.datetimepicker(getDateTimePickerOptions());\n  this.uiElems.endDateGrp.data(\"DateTimePicker\").setDate(this.eDate);\n  this.uiElems.startDateGrp.data(\"DateTimePicker\").setDate(this.sDate);\n\n  this._selectFliterFunc = function(which, filter) {\n    this.currSelected = which;\n    if (this.isAllEmpty()) {\n      filter(false, true);       // return to initial state\n    }\n    else {\n      filter(true, false);\n    }\n  };\n\n  this._dateFilterFunc = function(isStart, isEnd, filter) {\n    var d1 = this.uiElems.iStartDate.val();\n    var d2 = this.uiElems.iEndDate.val();\n    var b = false;\n    if (isStart && isEnd) {\n      b = !isEmpty(d1) && !isEmpty(d2);\n    } else if (isStart) {\n      b = isEmpty(this.uiElems.iStartDate.val());\n    } else if (isEnd) {\n      b = isEmpty(this.uiElems.iEndDate.val());\n    }\n\n    if (b) {\n      this.currSelected = 5;\n      filter(true, false);\n    }\n  };\n\n  startGrp.on('dp.change', function(e) {\n    e.preventDefault();\n    e.stopImmediatePropagation();\n    self.sDate = e.date.startOf('day');\n    self.uiElems.endDateGrp.data(\"DateTimePicker\").setMinDate(e.date);\n    self._dateFilterFunc(true, true, filter);\n  });\n  endGrp.on('dp.change', function(e) {\n    e.preventDefault();\n    e.stopImmediatePropagation();\n    self.eDate = e.date.endOf('day');\n    self.uiElems.startDateGrp.data(\"DateTimePicker\").setMaxDate(e.date);\n    self._dateFilterFunc(true, true, filter);\n  });\n  self.uiElems.iStartDate.on('change', function(e) {\n    e.stopImmediatePropagation();\n    self._dateFilterFunc(true, false, filter);\n  });\n  self.uiElems.iEndDate.on('change', function(e) {\n    e.stopImmediatePropagation();\n    self._dateFilterFunc(false, true, filter);\n  });\n\n};\n\nPlanQueryFilterD.prototype.getQueryParams = function() {\n  var order = this.uiElems.sBfOrder.val();\n  var name = this.uiElems.sBfCustomerName.val();\n  var mode = this.uiElems.sBfTransportMode.val();\n  var status = this.uiElems.sBfStatus.val();\n  var d1 = this.uiElems.iStartDate.val();\n  var d2 = this.uiElems.iEndDate.val();\n  var b = !isEmpty(d1) && !isEmpty(d2);\n\n  return {\n    fOrder: isEmpty(order) ? null : order,\n    fName: isEmpty(name) ? null : name,\n    fTransportMode: isEmpty(mode) ? null : mode,\n    fStatus: isEmpty(status) ? null : status,\n    fDate1: b ? this.sDate.toISOString() : null,\n    fDate2: b ? this.eDate.toISOString() : null\n  };\n};\n\nPlanQueryFilterD.prototype.isAllEmpty = function() {\n  var order = this.uiElems.sBfOrder.val();\n  var name = getSelectValue(this.uiElems.sBfCustomerName);\n  var transportMode = this.uiElems.sBfTransportMode.val();\n  var status = this.uiElems.sBfStatus.val();\n  var d1 = this.uiElems.iStartDate.val();\n  var d2 = this.uiElems.iEndDate.val();\n\n  return isEmpty(order) && isEmpty(transportMode) && isEmpty(status) &&\n    isEmpty(name) && isEmpty(d1) && isEmpty(d2);\n};\n\nPlanQueryFilterD.prototype.reset = function() {\n  this.uiElems.sBfCustomerName.select2('val', '');\n  this.uiElems.sBfOrder.val('');\n  this.uiElems.sBfTransportMode.val('');\n  this.uiElems.sBfStatus.val('');\n  this.uiElems.iStartDate.val('');\n  this.uiElems.iEndDate.val('');\n};"]}